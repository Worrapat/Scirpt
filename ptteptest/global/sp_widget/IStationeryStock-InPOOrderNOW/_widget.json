{
    "instance": {
        "name": "ptteptest",
        "url": "https://ptteptest.service-now.com",
        "g_ck": "fa7087379785fa10f86b34b71153afe51635fd5f06c5ed83b80a50e0196e4c71d30dae98"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "IStationery Stock-In PO Order NOW",
    "sys_id": "64b171b0dbaa7150d63d06a5f3961948",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<!DOCTYPE html>\n<html>\n<head>\n    \n</head>\n<body>\n  \n   \t<div class=\"row\">\n        <div class=\"column\" style=\"float: left; padding-left: 15px; padding-right: 20px; padding-bottom: 20px; margin-top: -10px;\" dir=\"ltr\">\n            <button type=\"button\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPoModal\" ng-click=\"c.copyArray()\">Order Now</button>\n        </div>\n      \t<div class=\"column\" style=\"float: right; padding-right: 15px; padding-bottom: 20px; margin-top: -10px;\" dir=\"rtl\" >\n            <button type=\"button\" id=\"istationary_stock_in_item_list_cart\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPreviewPoModal\" ng-click=\"c.fetchObjectValue()\">Preview Order</button>\n        </div>\n    </div>\n    \n    <div id=\"myPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          <!---<tr dir-paginate=\"item in filteredItems = c.copyArr | itemsPerPage:15\" current-page=\"c.currentPage\" pagination-id=\"active\">--->\n                            <tr ng-repeat=\"item in c.copyArr\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td>{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n\t\t\t\t</div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary\" ng-click=\"c.generateArray()\">${Add}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n\n    <div id=\"myPreviewPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In (Order Summary)</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          \t<tr ng-if=\"c.previewOBJ.length <= 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n                              <td colspan=\"6\" style=\"text-align:center;\">Empty Item</td>\n                          \t</tr>\n                            <tr ng-repeat=\"item in c.previewOBJ\" *ngIf=\"c.previewOBJ.length > 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td style=\"text-align:left;\">{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n                    <p style = \"text-align: right; padding-right: 18px;\">Grand Price: ฿{{c.total_display}}</p>\n                </div>\n                <div class=\"modal-footer\">\n                  \t<button class=\"btn btn-primary\" ng-click=\"c.updateCart()\">${Update}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</html>",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<!DOCTYPE html>\n<html>\n<head>\n    \n</head>\n<body>\n  \n   \t<div class=\"row\">\n        <div class=\"column\" style=\"float: left; padding-left: 15px; padding-right: 20px; padding-bottom: 20px; margin-top: -10px;\" dir=\"ltr\">\n            <button type=\"button\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPoModal\" ng-click=\"c.copyArray()\">Order Now</button>\n        </div>\n      \t<div class=\"column\" style=\"float: right; padding-right: 15px; padding-bottom: 20px; margin-top: -10px;\" dir=\"rtl\" >\n            <button type=\"button\" id=\"istationary_stock_in_item_list_cart\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPreviewPoModal\" ng-click=\"c.fetchObjectValue()\">Preview Order</button>\n        </div>\n    </div>\n    \n    <div id=\"myPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          <!---<tr dir-paginate=\"item in filteredItems = c.copyArr | itemsPerPage:15\" current-page=\"c.currentPage\" pagination-id=\"active\">--->\n                            <tr ng-repeat=\"item in c.copyArr\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td>{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n\t\t\t\t</div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary\" ng-click=\"c.generateArray()\">${Add}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n\n    <div id=\"myPreviewPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In (Order Summary)</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          \t<tr ng-if=\"c.previewOBJ.length <= 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n                              <td colspan=\"6\" style=\"text-align:center;\">Empty Item</td>\n                          \t</tr>\n                            <tr ng-repeat=\"item in c.previewOBJ\" *ngIf=\"c.previewOBJ.length > 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td style=\"text-align:left;\">{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n                    <p style = \"text-align: right; padding-right: 18px;\">Grand Price: ฿{{c.total_display}}</p>\n                </div>\n                <div class=\"modal-footer\">\n                  \t<button class=\"btn btn-primary\" ng-click=\"c.updateCart()\">${Update}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</html>",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "internal": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Internal",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "",
            "name": "internal",
            "attributes": {},
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "internal"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".modal-dialog {\n    width: 70%;\n    margin: auto auto;\n} \n.my-custom-scrollbar {\n  position: relative;\n  overflow-x: scroll;\n  overflow-y: hidden;\n\n}\n.table-wrapper-scroll-y {\ndisplay: block;\n}\n.table-paginator{\n    position: relative;\n    height: 75px;\n     //float: right;\n    color: #646262;\n}\n.align-right{\n    position: absolute;\n    top:0;\n    right:2rem;\n}\n.rpp{\n    display: inline-block;\n    margin-right: 4rem;\n}\n.rpp h4{\n    font-size: 14px;\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-control{\n    display: inline-block;\n}\n.page-control .current-page{\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-prev{\n    margin-right: 2rem;\n}\n.page-next{\n    margin-left: 2rem;\n}\nth{\nbackground-color: #F5F5F5;\n}\n.form-input-control {\n  height:35px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-fixed-control{\n  height:35px;\n  width:60px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-photo-control{\n  height:35px;\n  width:80px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.form-extra-control{\n  height:35px;\n  width:90px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.po {\n  width: 20px;\n  height: 20px;\n  background-color:#B2F5EE;\n}\n\n.pr{\n  width: 20px;\n  height: 20px;\n  background-color:#DAF7A6;\n}\n\n.column{\n  width: 40%;\n}\n\n.column1{\n\twidth: 75%;\n}\n\n.column2{\n  margin-left: auto;\n}\n\n.row {\n  margin-bottom: 20px;\n  display: flex;\n}\n\n.row .row {\n  margin: 0;\n}\n\n.row > * {\n  padding: 15px;\n  flex: 1;\n}\n\n.example1 {\n  border: 2px solid #66CC99;\n  padding: 5px;\n  border-radius: 20px;\n}\n\n.tablecolumn {\n\tbackground-color: #cce6ff;\n}\n",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".modal-dialog {\n    width: 70%;\n    margin: auto auto;\n} \n.my-custom-scrollbar {\n  position: relative;\n  overflow-x: scroll;\n  overflow-y: hidden;\n\n}\n.table-wrapper-scroll-y {\ndisplay: block;\n}\n.table-paginator{\n    position: relative;\n    height: 75px;\n     //float: right;\n    color: #646262;\n}\n.align-right{\n    position: absolute;\n    top:0;\n    right:2rem;\n}\n.rpp{\n    display: inline-block;\n    margin-right: 4rem;\n}\n.rpp h4{\n    font-size: 14px;\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-control{\n    display: inline-block;\n}\n.page-control .current-page{\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-prev{\n    margin-right: 2rem;\n}\n.page-next{\n    margin-left: 2rem;\n}\nth{\nbackground-color: #F5F5F5;\n}\n.form-input-control {\n  height:35px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-fixed-control{\n  height:35px;\n  width:60px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-photo-control{\n  height:35px;\n  width:80px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.form-extra-control{\n  height:35px;\n  width:90px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.po {\n  width: 20px;\n  height: 20px;\n  background-color:#B2F5EE;\n}\n\n.pr{\n  width: 20px;\n  height: 20px;\n  background-color:#DAF7A6;\n}\n\n.column{\n  width: 40%;\n}\n\n.column1{\n\twidth: 75%;\n}\n\n.column2{\n  margin-left: auto;\n}\n\n.row {\n  margin-bottom: 20px;\n  display: flex;\n}\n\n.row .row {\n  margin: 0;\n}\n\n.row > * {\n  padding: 15px;\n  flex: 1;\n}\n\n.example1 {\n  border: 2px solid #66CC99;\n  padding: 5px;\n  border-radius: 20px;\n}\n\n.tablecolumn {\n\tbackground-color: #cce6ff;\n}\n",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function link(scope, element, attrs, controller) { \n\n }",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function link(scope, element, attrs, controller) { \n\n }",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "(function () {\r\n\tvar arr = [];\r\n\tif (input.action == 'referencevalue' && input.filterData != '') {\r\n\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\tpo_item.addEncodedQuery(\r\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\r\n\t\t);\r\n\t\tpo_item.query();\r\n\t\twhile (po_item.next()) {\r\n\r\n\t\t\tconsole.log(\"po_item Count \" + po_item.getRowCount());\r\n\t\t\t// get MRV request QTY\r\n\t\t\tvar master_item = po_item.u_master_item.getRefRecord();\r\n\t\t\tvar img = ' ';\r\n\t\t\tif (\r\n\t\t\t\tmaster_item.getValue('picture') != '' ||\r\n\t\t\t\tmaster_item.getValue('picture') != ' ' ||\r\n\t\t\t\tmaster_item.getValue('picture') != null\r\n\t\t\t) {\r\n\t\t\t\timg = master_item.getValue('picture') + '.iix';\r\n\t\t\t}\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\r\n\t\t\t);\r\n\t\t\tline_item.query();\r\n\t\t\tif (line_item.next()) {\r\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t}\r\n\r\n\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\r\n\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\r\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\r\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\r\n\t\t\t}\r\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\r\n\t\t\t\tvar obj = {\r\n\t\t\t\t\tphoto1: img,\r\n\t\t\t\t\tdescription: master_item.getValue('name'),\r\n\t\t\t\t\tunit_type: master_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(master_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\r\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\r\n\t\t\t\t\tqty: 0,\r\n\t\t\t\t\ttotalPrice: 0.0,\r\n\t\t\t\t\titem_id: master_item.getUniqueValue(),\r\n\t\t\t\t};\r\n\t\t\t\tarr.push(obj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(JSON.stringify(arr));\r\n\t\tdata.finalObject = arr;\r\n\t} else if (input.action == 'referencepreviewvalue') {\r\n\t\t//gs.log('SIT Case : B');\r\n\t\tarr = [];\r\n\t\tfor (var i = 0; i < input.mrv.length; i++) {\r\n\t\t\t//gs.log('Preview po old-pack : '+JSON.stringify(input.mrv));\r\n\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\t\tpo_item.addQuery('u_po=' + input.po + '^u_master_item=' + input.mrv[i].u_description_sin);\r\n\t\t\tpo_item.query();\r\n\t\t\tif (po_item.next()) {\r\n\t\t\t\t// get MRV request QTY\r\n\t\t\t\tvar mrv_item = po_item.u_master_item.getRefRecord();\r\n\t\t\t\tvar mrv_item_id = mrv_item.getUniqueValue();\r\n\t\t\t\tvar imgPreview = ' ';\r\n\t\t\t\tif (\r\n\t\t\t\t\tmrv_item.getValue('picture') != '' ||\r\n\t\t\t\t\tmrv_item.getValue('picture') != ' ' ||\r\n\t\t\t\t\tmrv_item.getValue('picture') != null\r\n\t\t\t\t) {\r\n\t\t\t\t\timgPreview = mrv_item.getValue('picture') + '.iix';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// get Submitted request QTY\r\n\t\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t\t'u_order=' + input.ref + '^u_item=' + mrv_item.sys_id + '^active=true',\r\n\t\t\t\t);\r\n\t\t\t\tline_item.query();\r\n\t\t\t\tif (line_item.next()) {\r\n\t\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\r\n\t\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\r\n\t\t\t\tif (request_qty != '0' || request_qty != 0) {\r\n\t\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\t\tpo_rem = parseInt(po_rem);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar qty = input.mrv[i].u_qty.replace(/,/g, '');\r\n\r\n\t\t\t\tvar ref = input.ref != '';\r\n\t\t\t\tvar objPreview = {\r\n\t\t\t\t\tphoto1: imgPreview,\r\n\t\t\t\t\tdescription: mrv_item.name.getDisplayValue(),\r\n\t\t\t\t\tunit_type: mrv_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(mrv_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty: ref ? po_max_rem : parseInt(po_item.u_po_remaining),\r\n\t\t\t\t\tremaining_qty: ref\r\n\t\t\t\t\t\t? po_max_rem - parseInt(qty)\r\n\t\t\t\t\t\t: parseInt(po_item.u_po_remaining) - parseInt(qty),\r\n\t\t\t\t\tqty: parseInt(qty),\r\n\t\t\t\t\ttotalPrice: input.mrv[i].u_total_price,\r\n\t\t\t\t\titem_id: mrv_item_id,\r\n\t\t\t\t};\r\n\t\t\t\tarr.push(objPreview);\r\n\t\t\t\t//gs.log('Preview po re-pack : '+JSON.stringify(objPreview));\r\n\t\t\t}\r\n\t\t\tdata.finalPreviewObject = arr;\r\n\t\t\t//gs.log(JSON.stringify(data.finalPreviewObject));\r\n\t\t\tvar totalAmnt = 0;\r\n\t\t\tfor (var j = 0; j < data.finalPreviewObject.length; j++) {\r\n\t\t\t\t//gs.log(\"total_amount : \" + data.finalArray[i].total_amount.replace(/,/g, \"\"));\r\n\t\t\t\ttotalAmnt =\r\n\t\t\t\t\tparseFloat(totalAmnt) +\r\n\t\t\t\t\tparseFloat(data.finalPreviewObject[j].totalPrice.replace(/,/g, ''));\r\n\t\t\t}\r\n\t\t\tdata.grand_price = totalAmnt;\r\n\t\t}\r\n\t} else if (input.action == 'referenceoldvalue' && input.filterData != '') {\r\n\t\tarr = [];\r\n\t\tvar mrv_po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\tmrv_po_item.addEncodedQuery(\r\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\r\n\t\t);\r\n\t\tmrv_po_item.query();\r\n\t\twhile (mrv_po_item.next()) {\r\n\t\t\tvar mas_item = mrv_po_item.u_master_item.getRefRecord();\r\n\t\t\t// if (mrv_po_item.u_po_remaining != 0 || mrv_po_item.u_po_remaining != '0') {\r\n\t\t\tvar imgs = ' ';\r\n\t\t\t// gs.info(parse[i].u_description_sin)\r\n\t\t\tif (\r\n\t\t\t\tmas_item.getValue('picture') != '' ||\r\n\t\t\t\tmas_item.getValue('picture') != ' ' ||\r\n\t\t\t\tmas_item.getValue('picture') != null\r\n\t\t\t) {\r\n\t\t\t\timgs = mas_item.getValue('picture') + '.iix';\r\n\t\t\t}\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\r\n\t\t\t);\r\n\t\t\tline_item.query();\r\n\t\t\tif (line_item.next()) {\r\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t}\r\n\t\t\tvar po_max_rem = mrv_po_item.u_po_remaining.getValue();\r\n\t\t\tvar po_rem = mrv_po_item.u_po_remaining.getValue();\r\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\r\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\r\n\t\t\t}\r\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\r\n\t\t\t\tvar objOld = {\r\n\t\t\t\t\tphoto1: imgs,\r\n\t\t\t\t\tdescription: mas_item.getValue('name'),\r\n\t\t\t\t\tunit_type: mas_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(mas_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty:\r\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\r\n\t\t\t\t\t\t\t? 0\r\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\r\n\t\t\t\t\tremaining_qty:\r\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\r\n\t\t\t\t\t\t\t? 0\r\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\r\n\t\t\t\t\tqty: 0,\r\n\t\t\t\t\ttotalPrice: 0.0,\r\n\t\t\t\t\titem_id: mas_item.getUniqueValue(),\r\n\t\t\t\t};\r\n\t\t\t\tfor (var s = 0; s < input.mrvsvalue.length; s++) {\r\n\t\t\t\t\tif (input.mrvsvalue[s].u_description_sin === objOld.item_id) {\r\n\t\t\t\t\t\tvar qty = input.mrvsvalue[s].u_qty.replace(/,/g, '');\r\n\t\t\t\t\t\tobjOld.qty = parseInt(qty);\r\n\t\t\t\t\t\tobjOld.totalPrice = input.mrvsvalue[s].u_total_price;\r\n\t\t\t\t\t\tobjOld.po_remaining_qty = parseInt(mrv_po_item.u_po_remaining);\r\n\t\t\t\t\t\tobjOld.remaining_qty = parseInt(mrv_po_item.u_po_remaining) - parseInt(qty);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tarr.push(objOld);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.finalSubObject = arr;\r\n\t} else if (input.action == 'checkmultirow') {\r\n\t\tvar arrayUtil = new ArrayUtil();\r\n\t\tvar finalmvrs = [];\r\n\t\tvar oldArr = input.oldArr;\r\n\t\tvar newArr = input.newArr;\r\n\r\n\t\tfor (var v = 0; v < newArr.length; v++) {\r\n\t\t\t//check loop\r\n\t\t\tvar foundIndex = -1;\r\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\r\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\r\n\t\t\t\t\tfoundIndex = x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (foundIndex != -1) {\r\n\t\t\t\t//gs.log('A');\r\n\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t//gs.log('A - A');\r\n\t\t\t\t\toldArr[foundIndex].u_qty = newArr[v].u_qty;\r\n\t\t\t\t\toldArr[foundIndex].u_total_price = newArr[v].u_total_price;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//gs.log('A - B');\r\n\t\t\t\t\toldArr.splice(foundIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//gs.log('B');\r\n\t\t\t\tif (foundIndex == -1) {\r\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t\t//gs.log('B - A');\r\n\t\t\t\t\t\toldArr.push(newArr[v]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//gs.log('B - B');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.oldArr = oldArr;\r\n\t} else if (input.action == 'previewUpdate') {\r\n\t\tvar oldArr = input.oldArr;\r\n\t\tvar newArr = input.newArr;\r\n\r\n\t\tfor (var v = 0; v < newArr.length; v++) {\r\n\t\t\t//check loop\r\n\t\t\tvar indexFound = -1;\r\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\r\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\r\n\t\t\t\t\tindexFound = x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (indexFound != -1) {\r\n\t\t\t\t//gs.log('A');\r\n\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t//gs.log('A - A');\r\n\t\t\t\t\toldArr[indexFound].u_qty = newArr[v].u_qty;\r\n\t\t\t\t\toldArr[indexFound].u_total_price = newArr[v].u_total_price;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//gs.log('A - B');\r\n\t\t\t\t\toldArr.splice(indexFound, 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//gs.log('B');\r\n\t\t\t\tif (indexFound == -1) {\r\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t\t//gs.log('B - A');\r\n\t\t\t\t\t\toldArr.push(newArr[v]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//gs.log('B - B');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.oldArr = oldArr;\r\n\t} else if (input.action == 'checkreferencevalue') {\r\n\t\tarr = [];\r\n\t\tvar mrvs_po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\tmrvs_po_item.addEncodedQuery(\r\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\r\n\t\t);\r\n\t\tmrvs_po_item.query();\r\n\t\twhile (mrvs_po_item.next()) {\r\n\t\t\tvar mast_item = mrvs_po_item.u_master_item.getRefRecord();\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + mast_item.sys_id + '^active=true',\r\n\t\t\t);\r\n\t\t\tline_item.query();\r\n\t\t\tif (line_item.next()) {\r\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t}\r\n\t\t\tvar imgg = ' ';\r\n\t\t\tif (\r\n\t\t\t\tmast_item.getValue('picture') != '' ||\r\n\t\t\t\tmast_item.getValue('picture') != ' ' ||\r\n\t\t\t\tmast_item.getValue('picture') != null\r\n\t\t\t) {\r\n\t\t\t\timgg = mast_item.getValue('picture') + '.iix';\r\n\t\t\t}\r\n\t\t\tvar po_max_rem = mrvs_po_item.u_po_remaining.getValue();\r\n\t\t\tvar po_rem = mrvs_po_item.u_po_remaining.getValue();\r\n\t\t\tif (request_qty != '0' || request_qty != 0) {\r\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\tpo_rem = parseInt(po_rem);\r\n\t\t\t}\r\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\r\n\t\t\t\tvar oldObj = {\r\n\t\t\t\t\tphoto1: imgg,\r\n\t\t\t\t\tdescription: mast_item.getValue('name'),\r\n\t\t\t\t\tunit_type: mast_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(mast_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\r\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\r\n\t\t\t\t\tqty: 0,\r\n\t\t\t\t\ttotalPrice: 0.0,\r\n\t\t\t\t\titem_id: mast_item.getUniqueValue(),\r\n\t\t\t\t};\r\n\t\t\t\tfor (var k = 0; k < input.mrvsvalue.length; k++) {\r\n\t\t\t\t\tif (input.mrvsvalue[k].u_description_sin === oldObj.item_id) {\r\n\t\t\t\t\t\tvar qty = input.mrvsvalue[k].u_qty.replace(/,/g, '');\r\n\t\t\t\t\t\toldObj.qty = parseInt(qty);\r\n\t\t\t\t\t\toldObj.totalPrice = input.mrvsvalue[k].u_total_price;\r\n\t\t\t\t\t\toldObj.po_remaining_qty = po_max_rem;\r\n\t\t\t\t\t\toldObj.remaining_qty = parseInt(po_max_rem) - parseInt(qty);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tarr.push(oldObj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.finalReSubObject = arr;\r\n\t}\r\n})();\r\n",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "(function () {\r\n\tvar arr = [];\r\n\tif (input.action == 'referencevalue' && input.filterData != '') {\r\n\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\tpo_item.addEncodedQuery(\r\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\r\n\t\t);\r\n\t\tpo_item.query();\r\n\t\twhile (po_item.next()) {\r\n\r\n\t\t\tconsole.log(\"po_item Count \" + po_item.getRowCount());\r\n\t\t\t// get MRV request QTY\r\n\t\t\tvar master_item = po_item.u_master_item.getRefRecord();\r\n\t\t\tvar img = ' ';\r\n\t\t\tif (\r\n\t\t\t\tmaster_item.getValue('picture') != '' ||\r\n\t\t\t\tmaster_item.getValue('picture') != ' ' ||\r\n\t\t\t\tmaster_item.getValue('picture') != null\r\n\t\t\t) {\r\n\t\t\t\timg = master_item.getValue('picture') + '.iix';\r\n\t\t\t}\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\r\n\t\t\t);\r\n\t\t\tline_item.query();\r\n\t\t\tif (line_item.next()) {\r\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t}\r\n\r\n\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\r\n\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\r\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\r\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\r\n\t\t\t}\r\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\r\n\t\t\t\tvar obj = {\r\n\t\t\t\t\tphoto1: img,\r\n\t\t\t\t\tdescription: master_item.getValue('name'),\r\n\t\t\t\t\tunit_type: master_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(master_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\r\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\r\n\t\t\t\t\tqty: 0,\r\n\t\t\t\t\ttotalPrice: 0.0,\r\n\t\t\t\t\titem_id: master_item.getUniqueValue(),\r\n\t\t\t\t};\r\n\t\t\t\tarr.push(obj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(JSON.stringify(arr));\r\n\t\tdata.finalObject = arr;\r\n\t} else if (input.action == 'referencepreviewvalue') {\r\n\t\t//gs.log('SIT Case : B');\r\n\t\tarr = [];\r\n\t\tfor (var i = 0; i < input.mrv.length; i++) {\r\n\t\t\t//gs.log('Preview po old-pack : '+JSON.stringify(input.mrv));\r\n\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\t\tpo_item.addQuery('u_po=' + input.po + '^u_master_item=' + input.mrv[i].u_description_sin);\r\n\t\t\tpo_item.query();\r\n\t\t\tif (po_item.next()) {\r\n\t\t\t\t// get MRV request QTY\r\n\t\t\t\tvar mrv_item = po_item.u_master_item.getRefRecord();\r\n\t\t\t\tvar mrv_item_id = mrv_item.getUniqueValue();\r\n\t\t\t\tvar imgPreview = ' ';\r\n\t\t\t\tif (\r\n\t\t\t\t\tmrv_item.getValue('picture') != '' ||\r\n\t\t\t\t\tmrv_item.getValue('picture') != ' ' ||\r\n\t\t\t\t\tmrv_item.getValue('picture') != null\r\n\t\t\t\t) {\r\n\t\t\t\t\timgPreview = mrv_item.getValue('picture') + '.iix';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// get Submitted request QTY\r\n\t\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t\t'u_order=' + input.ref + '^u_item=' + mrv_item.sys_id + '^active=true',\r\n\t\t\t\t);\r\n\t\t\t\tline_item.query();\r\n\t\t\t\tif (line_item.next()) {\r\n\t\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\r\n\t\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\r\n\t\t\t\tif (request_qty != '0' || request_qty != 0) {\r\n\t\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\t\tpo_rem = parseInt(po_rem);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar qty = input.mrv[i].u_qty.replace(/,/g, '');\r\n\r\n\t\t\t\tvar ref = input.ref != '';\r\n\t\t\t\tvar objPreview = {\r\n\t\t\t\t\tphoto1: imgPreview,\r\n\t\t\t\t\tdescription: mrv_item.name.getDisplayValue(),\r\n\t\t\t\t\tunit_type: mrv_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(mrv_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty: ref ? po_max_rem : parseInt(po_item.u_po_remaining),\r\n\t\t\t\t\tremaining_qty: ref\r\n\t\t\t\t\t\t? po_max_rem - parseInt(qty)\r\n\t\t\t\t\t\t: parseInt(po_item.u_po_remaining) - parseInt(qty),\r\n\t\t\t\t\tqty: parseInt(qty),\r\n\t\t\t\t\ttotalPrice: input.mrv[i].u_total_price,\r\n\t\t\t\t\titem_id: mrv_item_id,\r\n\t\t\t\t};\r\n\t\t\t\tarr.push(objPreview);\r\n\t\t\t\t//gs.log('Preview po re-pack : '+JSON.stringify(objPreview));\r\n\t\t\t}\r\n\t\t\tdata.finalPreviewObject = arr;\r\n\t\t\t//gs.log(JSON.stringify(data.finalPreviewObject));\r\n\t\t\tvar totalAmnt = 0;\r\n\t\t\tfor (var j = 0; j < data.finalPreviewObject.length; j++) {\r\n\t\t\t\t//gs.log(\"total_amount : \" + data.finalArray[i].total_amount.replace(/,/g, \"\"));\r\n\t\t\t\ttotalAmnt =\r\n\t\t\t\t\tparseFloat(totalAmnt) +\r\n\t\t\t\t\tparseFloat(data.finalPreviewObject[j].totalPrice.replace(/,/g, ''));\r\n\t\t\t}\r\n\t\t\tdata.grand_price = totalAmnt;\r\n\t\t}\r\n\t} else if (input.action == 'referenceoldvalue' && input.filterData != '') {\r\n\t\tarr = [];\r\n\t\tvar mrv_po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\tmrv_po_item.addEncodedQuery(\r\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\r\n\t\t);\r\n\t\tmrv_po_item.query();\r\n\t\twhile (mrv_po_item.next()) {\r\n\t\t\tvar mas_item = mrv_po_item.u_master_item.getRefRecord();\r\n\t\t\t// if (mrv_po_item.u_po_remaining != 0 || mrv_po_item.u_po_remaining != '0') {\r\n\t\t\tvar imgs = ' ';\r\n\t\t\t// gs.info(parse[i].u_description_sin)\r\n\t\t\tif (\r\n\t\t\t\tmas_item.getValue('picture') != '' ||\r\n\t\t\t\tmas_item.getValue('picture') != ' ' ||\r\n\t\t\t\tmas_item.getValue('picture') != null\r\n\t\t\t) {\r\n\t\t\t\timgs = mas_item.getValue('picture') + '.iix';\r\n\t\t\t}\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\r\n\t\t\t);\r\n\t\t\tline_item.query();\r\n\t\t\tif (line_item.next()) {\r\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t}\r\n\t\t\tvar po_max_rem = mrv_po_item.u_po_remaining.getValue();\r\n\t\t\tvar po_rem = mrv_po_item.u_po_remaining.getValue();\r\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\r\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\r\n\t\t\t}\r\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\r\n\t\t\t\tvar objOld = {\r\n\t\t\t\t\tphoto1: imgs,\r\n\t\t\t\t\tdescription: mas_item.getValue('name'),\r\n\t\t\t\t\tunit_type: mas_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(mas_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty:\r\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\r\n\t\t\t\t\t\t\t? 0\r\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\r\n\t\t\t\t\tremaining_qty:\r\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\r\n\t\t\t\t\t\t\t? 0\r\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\r\n\t\t\t\t\tqty: 0,\r\n\t\t\t\t\ttotalPrice: 0.0,\r\n\t\t\t\t\titem_id: mas_item.getUniqueValue(),\r\n\t\t\t\t};\r\n\t\t\t\tfor (var s = 0; s < input.mrvsvalue.length; s++) {\r\n\t\t\t\t\tif (input.mrvsvalue[s].u_description_sin === objOld.item_id) {\r\n\t\t\t\t\t\tvar qty = input.mrvsvalue[s].u_qty.replace(/,/g, '');\r\n\t\t\t\t\t\tobjOld.qty = parseInt(qty);\r\n\t\t\t\t\t\tobjOld.totalPrice = input.mrvsvalue[s].u_total_price;\r\n\t\t\t\t\t\tobjOld.po_remaining_qty = parseInt(mrv_po_item.u_po_remaining);\r\n\t\t\t\t\t\tobjOld.remaining_qty = parseInt(mrv_po_item.u_po_remaining) - parseInt(qty);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tarr.push(objOld);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.finalSubObject = arr;\r\n\t} else if (input.action == 'checkmultirow') {\r\n\t\tvar arrayUtil = new ArrayUtil();\r\n\t\tvar finalmvrs = [];\r\n\t\tvar oldArr = input.oldArr;\r\n\t\tvar newArr = input.newArr;\r\n\r\n\t\tfor (var v = 0; v < newArr.length; v++) {\r\n\t\t\t//check loop\r\n\t\t\tvar foundIndex = -1;\r\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\r\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\r\n\t\t\t\t\tfoundIndex = x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (foundIndex != -1) {\r\n\t\t\t\t//gs.log('A');\r\n\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t//gs.log('A - A');\r\n\t\t\t\t\toldArr[foundIndex].u_qty = newArr[v].u_qty;\r\n\t\t\t\t\toldArr[foundIndex].u_total_price = newArr[v].u_total_price;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//gs.log('A - B');\r\n\t\t\t\t\toldArr.splice(foundIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//gs.log('B');\r\n\t\t\t\tif (foundIndex == -1) {\r\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t\t//gs.log('B - A');\r\n\t\t\t\t\t\toldArr.push(newArr[v]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//gs.log('B - B');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.oldArr = oldArr;\r\n\t} else if (input.action == 'previewUpdate') {\r\n\t\tvar oldArr = input.oldArr;\r\n\t\tvar newArr = input.newArr;\r\n\r\n\t\tfor (var v = 0; v < newArr.length; v++) {\r\n\t\t\t//check loop\r\n\t\t\tvar indexFound = -1;\r\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\r\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\r\n\t\t\t\t\tindexFound = x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (indexFound != -1) {\r\n\t\t\t\t//gs.log('A');\r\n\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t//gs.log('A - A');\r\n\t\t\t\t\toldArr[indexFound].u_qty = newArr[v].u_qty;\r\n\t\t\t\t\toldArr[indexFound].u_total_price = newArr[v].u_total_price;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//gs.log('A - B');\r\n\t\t\t\t\toldArr.splice(indexFound, 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//gs.log('B');\r\n\t\t\t\tif (indexFound == -1) {\r\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\r\n\t\t\t\t\t\t//gs.log('B - A');\r\n\t\t\t\t\t\toldArr.push(newArr[v]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//gs.log('B - B');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.oldArr = oldArr;\r\n\t} else if (input.action == 'checkreferencevalue') {\r\n\t\tarr = [];\r\n\t\tvar mrvs_po_item = new GlideRecord('u_ist_look_up_po_item');\r\n\t\tmrvs_po_item.addEncodedQuery(\r\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\r\n\t\t);\r\n\t\tmrvs_po_item.query();\r\n\t\twhile (mrvs_po_item.next()) {\r\n\t\t\tvar mast_item = mrvs_po_item.u_master_item.getRefRecord();\r\n\t\t\tvar request_qty = 0;\r\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\r\n\t\t\tline_item.addEncodedQuery(\r\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + mast_item.sys_id + '^active=true',\r\n\t\t\t);\r\n\t\t\tline_item.query();\r\n\t\t\tif (line_item.next()) {\r\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\r\n\t\t\t}\r\n\t\t\tvar imgg = ' ';\r\n\t\t\tif (\r\n\t\t\t\tmast_item.getValue('picture') != '' ||\r\n\t\t\t\tmast_item.getValue('picture') != ' ' ||\r\n\t\t\t\tmast_item.getValue('picture') != null\r\n\t\t\t) {\r\n\t\t\t\timgg = mast_item.getValue('picture') + '.iix';\r\n\t\t\t}\r\n\t\t\tvar po_max_rem = mrvs_po_item.u_po_remaining.getValue();\r\n\t\t\tvar po_rem = mrvs_po_item.u_po_remaining.getValue();\r\n\t\t\tif (request_qty != '0' || request_qty != 0) {\r\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\r\n\t\t\t\tpo_rem = parseInt(po_rem);\r\n\t\t\t}\r\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\r\n\t\t\t\tvar oldObj = {\r\n\t\t\t\t\tphoto1: imgg,\r\n\t\t\t\t\tdescription: mast_item.getValue('name'),\r\n\t\t\t\t\tunit_type: mast_item.u_stock_in_unit.getDisplayValue(),\r\n\t\t\t\t\tunit_price: parseFloat(mast_item.getValue('u_stock_in_unit_cost'))\r\n\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\r\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\r\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\r\n\t\t\t\t\tqty: 0,\r\n\t\t\t\t\ttotalPrice: 0.0,\r\n\t\t\t\t\titem_id: mast_item.getUniqueValue(),\r\n\t\t\t\t};\r\n\t\t\t\tfor (var k = 0; k < input.mrvsvalue.length; k++) {\r\n\t\t\t\t\tif (input.mrvsvalue[k].u_description_sin === oldObj.item_id) {\r\n\t\t\t\t\t\tvar qty = input.mrvsvalue[k].u_qty.replace(/,/g, '');\r\n\t\t\t\t\t\toldObj.qty = parseInt(qty);\r\n\t\t\t\t\t\toldObj.totalPrice = input.mrvsvalue[k].u_total_price;\r\n\t\t\t\t\t\toldObj.po_remaining_qty = po_max_rem;\r\n\t\t\t\t\t\toldObj.remaining_qty = parseInt(po_max_rem) - parseInt(qty);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tarr.push(oldObj);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.finalReSubObject = arr;\r\n\t}\r\n})();\r\n",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "api.controller = function ($scope, $rootScope) {\r\n\tvar c = this;\r\n\tc.searchText = '';\r\n\tc.currentPage = 1;\r\n\tc.copyArr = [];\r\n\tc.previewOBJ = [];\r\n\tc.orderedItems = [];\r\n\tc.copyObjectArr = [];\r\n\tc.oldData = [];\r\n\tc.checkObj = [];\r\n\tc.tempData = [];\r\n\tc.newArrData = [];\r\n\t$scope.status = $scope.data.status;\r\n\r\n\t// c.filterResult = {\r\n\t//     'category': '',\r\n\t//     'sub_category': ''\r\n\t// };\r\n\tc.filterResult = '';\r\n\tc.oldResult = null;\r\n\r\n\r\n\tfunction parseNumber(value) {\r\n\t\treturn parseFloat((value || 0).toString().replace(/,/g, '')) || 0;\r\n\t}\r\n\r\n\tfunction formatCurrency(value) {\r\n\t\treturn parseNumber(value).toLocaleString('en-US', {\r\n\t\t\tminimumFractionDigits: 2,\r\n\t\t\tmaximumFractionDigits: 2\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\t// ===== Update UC Code Table =====\r\n\tc.updateUCCode = function (items) {\r\n\t\t// console.log('items :', items);\r\n\r\n\t\t// --- 1. Validate input ---\r\n\t\tif (!Array.isArray(items) || items.length === 0) {\r\n\t\t\t// แสดงข้อความ default ถ้าไม่มีข้อมูลใน items\r\n\t\t\t$scope.page.g_form.setValue(\r\n\t\t\t\t'u_ticket_summary',\r\n\t\t\t\t'<div style=\"background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px 14px; font-family: Segoe UI, Arial, sans-serif; font-size: 14px; color: #374151; line-height: 1.5; box-shadow: 0 1px 4px rgba(0,0,0,0.05);\">This field is used to store the <strong style=\"color: #2563eb;\">UC Code</strong>, which indicates the system’s behavior under different conditions. Use the table below as a quick reference.</div>'\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// --- 2. Initialize HTML structure ---\r\n\t\tvar tableHTML =\r\n\t\t\t'<table style=\"width:100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;\">' +\r\n\t\t\t'<thead>' +\r\n\t\t\t'<tr style=\"background-color: #297bd8; color:#ffffff;\">' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:35%;\">Description</th>' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">Use Case</th>' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">User Edit Price</th>' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">Stock-In Unit Cost (Excl. VAT)</th>' +\r\n\t\t\t'</tr>' +\r\n\t\t\t'</thead><tbody>';\r\n\r\n\t\t// --- 3. Loop through each item to build rows ---\r\n\t\titems.forEach((item) => {\r\n\t\t\tconst description = item.description;\r\n\t\t\tconst ucCode = item.uc_code;\r\n\t\t\tconst userEditPrice = item.u_unit_price;\r\n\t\t\tconst stockInUnitCost = item.oldPrice;\r\n\r\n\t\t\ttableHTML +=\r\n\t\t\t\t`<tr>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; width:35%;\">` +\r\n\t\t\t\tdescription +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">` +\r\n\t\t\t\tucCode +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\r\n\t\t\t\tuserEditPrice +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\r\n\t\t\t\tstockInUnitCost +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`</tr>`;\r\n\t\t});\r\n\r\n\t\t// --- 4. Close table and set value back to form field ---\r\n\t\ttableHTML += '</tbody></table>';\r\n\r\n\t\t$scope.page.g_form.setValue('u_ticket_summary', tableHTML);\r\n\t};\r\n\r\n\t// Copy Array //\r\n\r\n\tc.copyArray = function () {\r\n\t\t// c.filterResult.category = $scope.page.g_form.getValue('u_category');\r\n\t\t// c.filterResult.sub_category = $scope.page.g_form.getValue('u_sub_category');\r\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\r\n\t\tc.filterResult = $scope.page.g_form.getValue('u_so_po_no_');\r\n\t\t//alert(c.filterResult.category);\r\n\t\t// if (c.oldResult == null) {\r\n\t\tc.oldResult = c.filterResult;\r\n\t\tc.fetchValue(ref);\r\n\t\t// } else {\r\n\t\t//     c.oldResult = c.filterResult;\r\n\t\t//     c.fetchValue();\r\n\t\t// }\r\n\t};\r\n\r\n\t// Fetch Value //\r\n\r\n\tc.fetchValue = function (ref) {\r\n\t\t//alert(c.filterResult.category);\r\n\t\tvar reference = '';\r\n\t\tvar checkmvrs = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\r\n\t\tif (checkmvrs != '' && ref == '') {\r\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\r\n\t\t\treference = 'referenceoldvalue';\r\n\t\t} else if (checkmvrs != '' && ref != '') {\r\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\r\n\t\t\treference = 'checkreferencevalue';\r\n\t\t} else {\r\n\t\t\treference = 'referencevalue';\r\n\t\t}\r\n\t\tc.server\r\n\t\t\t.get({\r\n\t\t\t\taction: reference,\r\n\t\t\t\tfilterData: c.filterResult,\r\n\t\t\t\tpreviewData: c.previewData,\r\n\t\t\t\tmrvsvalue: checkmvrs,\r\n\t\t\t\tref: ref,\r\n\t\t\t})\r\n\t\t\t.then(function (r) {\r\n\t\t\t\t//alert(JSON.stringify(r.data));\r\n\t\t\t\tif (r.data) {\r\n\t\t\t\t\tc.data.finalSubObject = r.data.finalSubObject;\r\n\t\t\t\t\tc.data.finalObject = r.data.finalObject;\r\n\t\t\t\t\tc.data.finalReSubObject = r.data.finalReSubObject;\r\n\t\t\t\t\t//c.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\r\n\t\t\t\t\tif (reference == 'referencevalue') {\r\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\r\n\t\t\t\t\t} else if (reference == 'checkreferencevalue') {\r\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalReSubObject));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalSubObject));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//console.log(JSON.stringify(c.copyArr));\r\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t};\r\n\r\n\t// Generate Array //\r\n\r\n\tc.generateArray = function () {\r\n\t\tc.finalData = [];\r\n\t\tc.previewData = [];\r\n\t\tc.newArr = [];\r\n\t\tc.olddataArr = [];\r\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\r\n\t\t// console.log('oldata : ' + oldDataStr + ' ; type : ' + typeof(oldDataStr));\r\n\t\tif (oldDataStr != '') {\r\n\t\t\tc.oldData = JSON.parse(oldDataStr);\r\n\t\t}\r\n\t\tfor (var y = 0; y < c.copyArr.length; y++) {\r\n\t\t\tif (oldDataStr == '') {\r\n\t\t\t\t// console.log('if = empty');\r\n\t\t\t\tif (c.copyArr[y].qty != 0) {\r\n\t\t\t\t\tvar newData = {\r\n\t\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\r\n\t\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\r\n\t\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\r\n\t\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\r\n\t\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tc.newArr.push(newData);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// console.log('else != empty');\r\n\t\t\t\tvar newData = {\r\n\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\r\n\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\r\n\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\r\n\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\r\n\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\r\n\t\t\t\t};\r\n\t\t\t\tc.newArr.push(newData);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (oldDataStr != '') {\r\n\t\t\t// console.log('if oldDataStr != empty')\r\n\t\t\tc.server\r\n\t\t\t\t.get({\r\n\t\t\t\t\taction: 'checkmultirow',\r\n\t\t\t\t\tnewArr: c.newArr,\r\n\t\t\t\t\toldArr: c.oldData,\r\n\t\t\t\t})\r\n\t\t\t\t.then(function (r) {\r\n\t\t\t\t\t// console.log(r.data.oldArr);\r\n\t\t\t\t\tc.olddataArr = r.data.oldArr;\r\n\t\t\t\t\tc.newDataArr = c.olddataArr;\r\n\r\n\t\t\t\t\t// Prepare items for UC code table\r\n\t\t\t\t\tconst itemsForUC = oldArr.map((item) => {\r\n\t\t\t\t\t\t// console.log('**** oldArr =>: ' + JSON.stringify(item) + '****');\r\n\t\t\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tu_description_sin: item.u_description_sin,\r\n\t\t\t\t\t\t\tdescription: copyItem\r\n\t\t\t\t\t\t\t\t? copyItem.description\r\n\t\t\t\t\t\t\t\t: item.description || item.u_description_sin,\r\n\t\t\t\t\t\t\tu_unit_price: item.u_unit_price,\r\n\t\t\t\t\t\t\toldPrice: '-',\r\n\t\t\t\t\t\t\tuc_code: '-',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tc.updateUCCode(itemsForUC);\r\n\r\n\t\t\t\t\tc.updatMRV(c.newDataArr);\r\n\t\t\t\t\t//console.log(c.newDataArr);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\t// console.log('else oldDataStr == empty')\r\n\t\t\tc.olddataArr = c.newArr;\r\n\t\t\tc.newDataArr = c.olddataArr;\r\n\t\t\tc.finalData = c.newDataArr;\r\n\r\n\t\t\tconst itemsForUC = c.newArr.map((item) => {\r\n\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tu_description_sin: item.u_description_sin,\r\n\t\t\t\t\tdescription: copyItem ? copyItem.description : item.description || item.u_description_sin,\r\n\t\t\t\t\tu_unit_price: item.u_unit_price,\r\n\t\t\t\t\toldPrice: '-',\r\n\t\t\t\t\tuc_code: '-',\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t// console.log('✅ itemsForUC (from backend oldPrice):', JSON.stringify(itemsForUC, null, 2));\r\n\r\n\t\t\tc.updateUCCode(itemsForUC);\r\n\t\t\tc.updatMRV(c.newDataArr);\r\n\t\t}\r\n\t};\r\n\r\n\tc.updatMRV = function (finalData) {\r\n\t\t//console.log('updateMRV : ' + finalData);\r\n\t\tc.total = 0;\r\n\t\tfor (var v = 0; v < finalData.length; v++) {\r\n\t\t\tif (parseFloat(finalData[v].u_qty) > 0) {\r\n\t\t\t\tc.total = c.total + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\r\n\t\t\t\t$scope.data.sumPrice =\r\n\t\t\t\t\t$scope.data.sumPrice + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\r\n\t\t\t}\r\n\t\t\tc.total_display = c.total\r\n\t\t\t\t.toFixed(2)\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\r\n\t\t\t// console.log('updateMRV c.total_display : ' + c.total_display);\r\n\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total);\r\n\t\t\t// console.log('updateMRV c.total : ' + c.total);\r\n\t\t}\r\n\r\n\t\t$('#myPoModal').modal('hide');\r\n\t\t$('#myPreviewPoModal').modal('hide');\r\n\r\n\t\tif (finalData.length != 0) {\r\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', JSON.stringify(finalData));\r\n\t\t\tc.data.finalObject = c.copyArr;\r\n\t\t\t//alert('Preview Data : ' + JSON.stringify(c.previewData));\r\n\t\t\t//c.previewOBJ += JSON.parse(JSON.stringify(c.previewData));\r\n\t\t} else {\r\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', '');\r\n\t\t}\r\n\t};\r\n\r\n\tc.fetchObjectValue = function () {\r\n\t\tvar mrv = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\r\n\t\tvar po = $scope.page.g_form.getValue('u_so_po_no_');\r\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\r\n\t\tif (mrv != '') {\r\n\t\t\tmrv = JSON.parse(mrv);\r\n\t\t}\r\n\t\tc.server\r\n\t\t\t.get({\r\n\t\t\t\taction: 'referencepreviewvalue',\r\n\t\t\t\tmrv: mrv,\r\n\t\t\t\tpo: po,\r\n\t\t\t\tref: ref,\r\n\t\t\t})\r\n\t\t\t.then(function (item) {\r\n\t\t\t\tif (item.data) {\r\n\t\t\t\t\tc.data.finalPreviewObject = item.data.finalPreviewObject;\r\n\r\n\t\t\t\t\tif (c.copyObjectArr.length == 0) {\r\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\r\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\r\n\t\t\t\t\t\tc.total_display = item.data.grand_price\r\n\t\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\r\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\r\n\t\t\t\t\t\tc.total_display = item.data.grand_price\r\n\t\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc.previewOBJ = c.copyObjectArr;\r\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t};\r\n\t// ShowImage //\r\n\r\n\t$scope.showLargeImage = function (imgUrl) {\r\n\t\tvar html = '<div align=\"center\">';\r\n\t\tif (imgUrl == '') {\r\n\t\t\thtml += '<img ng-src=\"No%20Image.png\" height=\"500\" />';\r\n\t\t} else {\r\n\t\t\thtml +=\r\n\t\t\t\t'<img ng-src=\"' +\r\n\t\t\t\timgUrl +\r\n\t\t\t\t'\" height=\"500\" onclick=\"window.open(' +\r\n\t\t\t\timgUrl +\r\n\t\t\t\t', _blank);\"/>';\r\n\t\t}\r\n\t\thtml += '</div>';\r\n\t\tc.largeImage = $uibModal\r\n\t\t\t.open({\r\n\t\t\t\ttemplate: html,\r\n\t\t\t})\r\n\t\t\t.then(function () { });\r\n\t};\r\n\r\n\t// Update Price //\r\n\r\n\t$scope.updatePrice = function (item) {\r\n\t\t//--- Dynamic Po Rem ---//\r\n\t\tvar price = item.unit_price.toString();\r\n\t\tvar actualPrice = 0;\r\n\t\tc.total = 0;\r\n\t\t//--- cal change in preview ---\r\n\t\t// console.log(c.total_display + ' : ' + typeof(c.total_display));\r\n\t\tif (c.total_display == '0' || c.total_display == undefined) {\r\n\t\t\tc.total_display = 0;\r\n\t\t} else {\r\n\t\t\tif (item.totalPrice == '0' || item.totalPrice == undefined) {\r\n\t\t\t\t// console.log('if');\r\n\t\t\t\titem.totalPrice = 0;\r\n\t\t\t} else {\r\n\t\t\t\titem.totalPrice = item.totalPrice.replaceAll(',', '');\r\n\t\t\t\titem.totalPrice = parseFloat(item.totalPrice);\r\n\t\t\t}\r\n\t\t\tc.total_display = c.total_display.toString();\r\n\t\t\tc.total_display = c.total_display.replaceAll(',', '');\r\n\t\t\tc.total_display = parseFloat(c.total_display);\r\n\t\t\tc.total_display = c.total_display - item.totalPrice;\r\n\t\t\t// console.log('base : ' + c.total_display);\t\r\n\t\t}\r\n\t\tvar summary = '';\r\n\t\tvar orderSummary = '';\r\n\t\tif (parseFloat(item.qty) == 0 || parseFloat(item.qty) == '0' || item.qty == '') {\r\n\t\t\titem.totalPrice = 0.0;\r\n\t\t\t//--- Dynamic Po Rem ---//\r\n\t\t\titem.remaining_qty = item.po_remaining_qty;\r\n\t\t\t//console.log('if rem : ' + item.remaining_qty)\r\n\t\t} else {\r\n\t\t\t// console.log('else')\r\n\t\t\tactualPrice = price.replace(/[^0-9.-]+/g, '');\r\n\t\t\titem.totalPrice = parseFloat(item.qty) * parseFloat(actualPrice);\r\n\t\t\tvar item_total_price = item.totalPrice;\r\n\t\t\t// console.log('plus : ' + item_total_price);\r\n\t\t\titem.totalPrice = item.totalPrice\r\n\t\t\t\t.toFixed(2)\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\tvar new_total = c.total_display + parseFloat(item_total_price);\r\n\t\t\tc.total_display = new_total\r\n\t\t\t\t.toFixed(2)\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t// console.log('final : ' + c.total_display);\r\n\t\t\t//--- Dynamic Po Rem ---//\r\n\t\t\titem.remaining_qty = parseFloat(item.po_remaining_qty) - parseFloat(item.qty);\r\n\t\t\titem.remaining_qty = item.remaining_qty.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t//console.log('else rem : ' + item.remaining_qty)\r\n\t\t}\r\n\t};\r\n\r\n\tc.updateCart = function () {\r\n\t\tc.finalData = [];\r\n\t\tc.previewData = [];\r\n\t\tc.newArr = [];\r\n\t\tc.olddataArr = [];\r\n\r\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart') || '[]';\r\n\t\ttry {\r\n\t\t\tc.oldData = JSON.parse(oldDataStr);\r\n\t\t\tif (!Array.isArray(c.oldData)) c.oldData = [];\r\n\t\t} catch (e) {\r\n\t\t\tc.oldData = [];\r\n\t\t}\r\n\r\n\t\tc.previewOBJ = Array.isArray(c.previewOBJ) ? c.previewOBJ : [];\r\n\r\n\t\tc.newArr = c.previewOBJ.map((p) => ({\r\n\t\t\tu_description_sin: p.item_id,\r\n\t\t\tu_unit_type: p.unit_type,\r\n\t\t\tu_unit_price: p.unit_price,\r\n\t\t\tu_qty: p.qty ? p.qty.toString() : '0',\r\n\t\t\tu_total_price: p.totalPrice || '0',\r\n\t\t}));\r\n\r\n\t\tc.server\r\n\t\t\t.get({\r\n\t\t\t\taction: 'previewUpdate',\r\n\t\t\t\tnewArr: c.newArr,\r\n\t\t\t\toldArr: c.oldData,\r\n\t\t\t})\r\n\t\t\t.then(function (r) {\r\n\t\t\t\tconst oldArr = Array.isArray(r.data.oldArr) ? r.data.oldArr : [];\r\n\t\t\t\tc.olddataArr = oldArr;\r\n\t\t\t\tc.newDataArr = oldArr;\r\n\r\n\t\t\t\tconst itemsForUC = c.newArr.map((item) => {\r\n\t\t\t\t\tconsole.log(\"item : \" + JSON.stringify(item));\r\n\t\t\t\t\tconst copyItem = (c.copyArr || []).find((ci) => ci.item_id === item.u_description_sin) || {};\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tu_description_sin: item.item_id,\r\n\t\t\t\t\t\tdescription: copyItem.description || item.description || item.u_description_sin,\r\n\t\t\t\t\t\tu_unit_price: item.u_unit_price || '-',\r\n\t\t\t\t\t\toldPrice: copyItem.oldPrice || '-',\r\n\t\t\t\t\t\tuc_code: copyItem.uc_code || '-',\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\r\n\t\t\t\tc.updateUCCode(itemsForUC);\r\n\t\t\t\tc.updatMRV(c.newDataArr);\r\n\t\t\t});\r\n\t};\r\n\r\n};\r\n",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "api.controller = function ($scope, $rootScope) {\r\n\tvar c = this;\r\n\tc.searchText = '';\r\n\tc.currentPage = 1;\r\n\tc.copyArr = [];\r\n\tc.previewOBJ = [];\r\n\tc.orderedItems = [];\r\n\tc.copyObjectArr = [];\r\n\tc.oldData = [];\r\n\tc.checkObj = [];\r\n\tc.tempData = [];\r\n\tc.newArrData = [];\r\n\t$scope.status = $scope.data.status;\r\n\r\n\t// c.filterResult = {\r\n\t//     'category': '',\r\n\t//     'sub_category': ''\r\n\t// };\r\n\tc.filterResult = '';\r\n\tc.oldResult = null;\r\n\r\n\r\n\tfunction parseNumber(value) {\r\n\t\treturn parseFloat((value || 0).toString().replace(/,/g, '')) || 0;\r\n\t}\r\n\r\n\tfunction formatCurrency(value) {\r\n\t\treturn parseNumber(value).toLocaleString('en-US', {\r\n\t\t\tminimumFractionDigits: 2,\r\n\t\t\tmaximumFractionDigits: 2\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\t// ===== Update UC Code Table =====\r\n\tc.updateUCCode = function (items) {\r\n\t\t// console.log('items :', items);\r\n\r\n\t\t// --- 1. Validate input ---\r\n\t\tif (!Array.isArray(items) || items.length === 0) {\r\n\t\t\t// แสดงข้อความ default ถ้าไม่มีข้อมูลใน items\r\n\t\t\t$scope.page.g_form.setValue(\r\n\t\t\t\t'u_ticket_summary',\r\n\t\t\t\t'<div style=\"background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px 14px; font-family: Segoe UI, Arial, sans-serif; font-size: 14px; color: #374151; line-height: 1.5; box-shadow: 0 1px 4px rgba(0,0,0,0.05);\">This field is used to store the <strong style=\"color: #2563eb;\">UC Code</strong>, which indicates the system’s behavior under different conditions. Use the table below as a quick reference.</div>'\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// --- 2. Initialize HTML structure ---\r\n\t\tvar tableHTML =\r\n\t\t\t'<table style=\"width:100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;\">' +\r\n\t\t\t'<thead>' +\r\n\t\t\t'<tr style=\"background-color: #297bd8; color:#ffffff;\">' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:35%;\">Description</th>' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">Use Case</th>' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">User Edit Price</th>' +\r\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">Stock-In Unit Cost (Excl. VAT)</th>' +\r\n\t\t\t'</tr>' +\r\n\t\t\t'</thead><tbody>';\r\n\r\n\t\t// --- 3. Loop through each item to build rows ---\r\n\t\titems.forEach((item) => {\r\n\t\t\tconst description = item.description;\r\n\t\t\tconst ucCode = item.uc_code;\r\n\t\t\tconst userEditPrice = item.u_unit_price;\r\n\t\t\tconst stockInUnitCost = item.oldPrice;\r\n\r\n\t\t\ttableHTML +=\r\n\t\t\t\t`<tr>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; width:35%;\">` +\r\n\t\t\t\tdescription +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">` +\r\n\t\t\t\tucCode +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\r\n\t\t\t\tuserEditPrice +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\r\n\t\t\t\tstockInUnitCost +\r\n\t\t\t\t`</td>` +\r\n\t\t\t\t`</tr>`;\r\n\t\t});\r\n\r\n\t\t// --- 4. Close table and set value back to form field ---\r\n\t\ttableHTML += '</tbody></table>';\r\n\r\n\t\t$scope.page.g_form.setValue('u_ticket_summary', tableHTML);\r\n\t};\r\n\r\n\t// Copy Array //\r\n\r\n\tc.copyArray = function () {\r\n\t\t// c.filterResult.category = $scope.page.g_form.getValue('u_category');\r\n\t\t// c.filterResult.sub_category = $scope.page.g_form.getValue('u_sub_category');\r\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\r\n\t\tc.filterResult = $scope.page.g_form.getValue('u_so_po_no_');\r\n\t\t//alert(c.filterResult.category);\r\n\t\t// if (c.oldResult == null) {\r\n\t\tc.oldResult = c.filterResult;\r\n\t\tc.fetchValue(ref);\r\n\t\t// } else {\r\n\t\t//     c.oldResult = c.filterResult;\r\n\t\t//     c.fetchValue();\r\n\t\t// }\r\n\t};\r\n\r\n\t// Fetch Value //\r\n\r\n\tc.fetchValue = function (ref) {\r\n\t\t//alert(c.filterResult.category);\r\n\t\tvar reference = '';\r\n\t\tvar checkmvrs = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\r\n\t\tif (checkmvrs != '' && ref == '') {\r\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\r\n\t\t\treference = 'referenceoldvalue';\r\n\t\t} else if (checkmvrs != '' && ref != '') {\r\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\r\n\t\t\treference = 'checkreferencevalue';\r\n\t\t} else {\r\n\t\t\treference = 'referencevalue';\r\n\t\t}\r\n\t\tc.server\r\n\t\t\t.get({\r\n\t\t\t\taction: reference,\r\n\t\t\t\tfilterData: c.filterResult,\r\n\t\t\t\tpreviewData: c.previewData,\r\n\t\t\t\tmrvsvalue: checkmvrs,\r\n\t\t\t\tref: ref,\r\n\t\t\t})\r\n\t\t\t.then(function (r) {\r\n\t\t\t\t//alert(JSON.stringify(r.data));\r\n\t\t\t\tif (r.data) {\r\n\t\t\t\t\tc.data.finalSubObject = r.data.finalSubObject;\r\n\t\t\t\t\tc.data.finalObject = r.data.finalObject;\r\n\t\t\t\t\tc.data.finalReSubObject = r.data.finalReSubObject;\r\n\t\t\t\t\t//c.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\r\n\t\t\t\t\tif (reference == 'referencevalue') {\r\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\r\n\t\t\t\t\t} else if (reference == 'checkreferencevalue') {\r\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalReSubObject));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalSubObject));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//console.log(JSON.stringify(c.copyArr));\r\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t};\r\n\r\n\t// Generate Array //\r\n\r\n\tc.generateArray = function () {\r\n\t\tc.finalData = [];\r\n\t\tc.previewData = [];\r\n\t\tc.newArr = [];\r\n\t\tc.olddataArr = [];\r\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\r\n\t\t// console.log('oldata : ' + oldDataStr + ' ; type : ' + typeof(oldDataStr));\r\n\t\tif (oldDataStr != '') {\r\n\t\t\tc.oldData = JSON.parse(oldDataStr);\r\n\t\t}\r\n\t\tfor (var y = 0; y < c.copyArr.length; y++) {\r\n\t\t\tif (oldDataStr == '') {\r\n\t\t\t\t// console.log('if = empty');\r\n\t\t\t\tif (c.copyArr[y].qty != 0) {\r\n\t\t\t\t\tvar newData = {\r\n\t\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\r\n\t\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\r\n\t\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\r\n\t\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\r\n\t\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tc.newArr.push(newData);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// console.log('else != empty');\r\n\t\t\t\tvar newData = {\r\n\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\r\n\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\r\n\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\r\n\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\r\n\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\r\n\t\t\t\t};\r\n\t\t\t\tc.newArr.push(newData);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (oldDataStr != '') {\r\n\t\t\t// console.log('if oldDataStr != empty')\r\n\t\t\tc.server\r\n\t\t\t\t.get({\r\n\t\t\t\t\taction: 'checkmultirow',\r\n\t\t\t\t\tnewArr: c.newArr,\r\n\t\t\t\t\toldArr: c.oldData,\r\n\t\t\t\t})\r\n\t\t\t\t.then(function (r) {\r\n\t\t\t\t\t// console.log(r.data.oldArr);\r\n\t\t\t\t\tc.olddataArr = r.data.oldArr;\r\n\t\t\t\t\tc.newDataArr = c.olddataArr;\r\n\r\n\t\t\t\t\t// Prepare items for UC code table\r\n\t\t\t\t\tconst itemsForUC = oldArr.map((item) => {\r\n\t\t\t\t\t\t// console.log('**** oldArr =>: ' + JSON.stringify(item) + '****');\r\n\t\t\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tu_description_sin: item.u_description_sin,\r\n\t\t\t\t\t\t\tdescription: copyItem\r\n\t\t\t\t\t\t\t\t? copyItem.description\r\n\t\t\t\t\t\t\t\t: item.description || item.u_description_sin,\r\n\t\t\t\t\t\t\tu_unit_price: item.u_unit_price,\r\n\t\t\t\t\t\t\toldPrice: '-',\r\n\t\t\t\t\t\t\tuc_code: '-',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tc.updateUCCode(itemsForUC);\r\n\r\n\t\t\t\t\tc.updatMRV(c.newDataArr);\r\n\t\t\t\t\t//console.log(c.newDataArr);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\t// console.log('else oldDataStr == empty')\r\n\t\t\tc.olddataArr = c.newArr;\r\n\t\t\tc.newDataArr = c.olddataArr;\r\n\t\t\tc.finalData = c.newDataArr;\r\n\r\n\t\t\tconst itemsForUC = c.newArr.map((item) => {\r\n\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tu_description_sin: item.u_description_sin,\r\n\t\t\t\t\tdescription: copyItem ? copyItem.description : item.description || item.u_description_sin,\r\n\t\t\t\t\tu_unit_price: item.u_unit_price,\r\n\t\t\t\t\toldPrice: '-',\r\n\t\t\t\t\tuc_code: '-',\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t// console.log('✅ itemsForUC (from backend oldPrice):', JSON.stringify(itemsForUC, null, 2));\r\n\r\n\t\t\tc.updateUCCode(itemsForUC);\r\n\t\t\tc.updatMRV(c.newDataArr);\r\n\t\t}\r\n\t};\r\n\r\n\tc.updatMRV = function (finalData) {\r\n\t\t//console.log('updateMRV : ' + finalData);\r\n\t\tc.total = 0;\r\n\t\tfor (var v = 0; v < finalData.length; v++) {\r\n\t\t\tif (parseFloat(finalData[v].u_qty) > 0) {\r\n\t\t\t\tc.total = c.total + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\r\n\t\t\t\t$scope.data.sumPrice =\r\n\t\t\t\t\t$scope.data.sumPrice + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\r\n\t\t\t}\r\n\t\t\tc.total_display = c.total\r\n\t\t\t\t.toFixed(2)\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\r\n\t\t\t// console.log('updateMRV c.total_display : ' + c.total_display);\r\n\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total);\r\n\t\t\t// console.log('updateMRV c.total : ' + c.total);\r\n\t\t}\r\n\r\n\t\t$('#myPoModal').modal('hide');\r\n\t\t$('#myPreviewPoModal').modal('hide');\r\n\r\n\t\tif (finalData.length != 0) {\r\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', JSON.stringify(finalData));\r\n\t\t\tc.data.finalObject = c.copyArr;\r\n\t\t\t//alert('Preview Data : ' + JSON.stringify(c.previewData));\r\n\t\t\t//c.previewOBJ += JSON.parse(JSON.stringify(c.previewData));\r\n\t\t} else {\r\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', '');\r\n\t\t}\r\n\t};\r\n\r\n\tc.fetchObjectValue = function () {\r\n\t\tvar mrv = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\r\n\t\tvar po = $scope.page.g_form.getValue('u_so_po_no_');\r\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\r\n\t\tif (mrv != '') {\r\n\t\t\tmrv = JSON.parse(mrv);\r\n\t\t}\r\n\t\tc.server\r\n\t\t\t.get({\r\n\t\t\t\taction: 'referencepreviewvalue',\r\n\t\t\t\tmrv: mrv,\r\n\t\t\t\tpo: po,\r\n\t\t\t\tref: ref,\r\n\t\t\t})\r\n\t\t\t.then(function (item) {\r\n\t\t\t\tif (item.data) {\r\n\t\t\t\t\tc.data.finalPreviewObject = item.data.finalPreviewObject;\r\n\r\n\t\t\t\t\tif (c.copyObjectArr.length == 0) {\r\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\r\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\r\n\t\t\t\t\t\tc.total_display = item.data.grand_price\r\n\t\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\r\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\r\n\t\t\t\t\t\tc.total_display = item.data.grand_price\r\n\t\t\t\t\t\t\t.toFixed(2)\r\n\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\r\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc.previewOBJ = c.copyObjectArr;\r\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t};\r\n\t// ShowImage //\r\n\r\n\t$scope.showLargeImage = function (imgUrl) {\r\n\t\tvar html = '<div align=\"center\">';\r\n\t\tif (imgUrl == '') {\r\n\t\t\thtml += '<img ng-src=\"No%20Image.png\" height=\"500\" />';\r\n\t\t} else {\r\n\t\t\thtml +=\r\n\t\t\t\t'<img ng-src=\"' +\r\n\t\t\t\timgUrl +\r\n\t\t\t\t'\" height=\"500\" onclick=\"window.open(' +\r\n\t\t\t\timgUrl +\r\n\t\t\t\t', _blank);\"/>';\r\n\t\t}\r\n\t\thtml += '</div>';\r\n\t\tc.largeImage = $uibModal\r\n\t\t\t.open({\r\n\t\t\t\ttemplate: html,\r\n\t\t\t})\r\n\t\t\t.then(function () { });\r\n\t};\r\n\r\n\t// Update Price //\r\n\r\n\t$scope.updatePrice = function (item) {\r\n\t\t//--- Dynamic Po Rem ---//\r\n\t\tvar price = item.unit_price.toString();\r\n\t\tvar actualPrice = 0;\r\n\t\tc.total = 0;\r\n\t\t//--- cal change in preview ---\r\n\t\t// console.log(c.total_display + ' : ' + typeof(c.total_display));\r\n\t\tif (c.total_display == '0' || c.total_display == undefined) {\r\n\t\t\tc.total_display = 0;\r\n\t\t} else {\r\n\t\t\tif (item.totalPrice == '0' || item.totalPrice == undefined) {\r\n\t\t\t\t// console.log('if');\r\n\t\t\t\titem.totalPrice = 0;\r\n\t\t\t} else {\r\n\t\t\t\titem.totalPrice = item.totalPrice.replaceAll(',', '');\r\n\t\t\t\titem.totalPrice = parseFloat(item.totalPrice);\r\n\t\t\t}\r\n\t\t\tc.total_display = c.total_display.toString();\r\n\t\t\tc.total_display = c.total_display.replaceAll(',', '');\r\n\t\t\tc.total_display = parseFloat(c.total_display);\r\n\t\t\tc.total_display = c.total_display - item.totalPrice;\r\n\t\t\t// console.log('base : ' + c.total_display);\t\r\n\t\t}\r\n\t\tvar summary = '';\r\n\t\tvar orderSummary = '';\r\n\t\tif (parseFloat(item.qty) == 0 || parseFloat(item.qty) == '0' || item.qty == '') {\r\n\t\t\titem.totalPrice = 0.0;\r\n\t\t\t//--- Dynamic Po Rem ---//\r\n\t\t\titem.remaining_qty = item.po_remaining_qty;\r\n\t\t\t//console.log('if rem : ' + item.remaining_qty)\r\n\t\t} else {\r\n\t\t\t// console.log('else')\r\n\t\t\tactualPrice = price.replace(/[^0-9.-]+/g, '');\r\n\t\t\titem.totalPrice = parseFloat(item.qty) * parseFloat(actualPrice);\r\n\t\t\tvar item_total_price = item.totalPrice;\r\n\t\t\t// console.log('plus : ' + item_total_price);\r\n\t\t\titem.totalPrice = item.totalPrice\r\n\t\t\t\t.toFixed(2)\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\tvar new_total = c.total_display + parseFloat(item_total_price);\r\n\t\t\tc.total_display = new_total\r\n\t\t\t\t.toFixed(2)\r\n\t\t\t\t.toString()\r\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t// console.log('final : ' + c.total_display);\r\n\t\t\t//--- Dynamic Po Rem ---//\r\n\t\t\titem.remaining_qty = parseFloat(item.po_remaining_qty) - parseFloat(item.qty);\r\n\t\t\titem.remaining_qty = item.remaining_qty.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\r\n\t\t\t//console.log('else rem : ' + item.remaining_qty)\r\n\t\t}\r\n\t};\r\n\r\n\tc.updateCart = function () {\r\n\t\tc.finalData = [];\r\n\t\tc.previewData = [];\r\n\t\tc.newArr = [];\r\n\t\tc.olddataArr = [];\r\n\r\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart') || '[]';\r\n\t\ttry {\r\n\t\t\tc.oldData = JSON.parse(oldDataStr);\r\n\t\t\tif (!Array.isArray(c.oldData)) c.oldData = [];\r\n\t\t} catch (e) {\r\n\t\t\tc.oldData = [];\r\n\t\t}\r\n\r\n\t\tc.previewOBJ = Array.isArray(c.previewOBJ) ? c.previewOBJ : [];\r\n\r\n\t\tc.newArr = c.previewOBJ.map((p) => ({\r\n\t\t\tu_description_sin: p.item_id,\r\n\t\t\tu_unit_type: p.unit_type,\r\n\t\t\tu_unit_price: p.unit_price,\r\n\t\t\tu_qty: p.qty ? p.qty.toString() : '0',\r\n\t\t\tu_total_price: p.totalPrice || '0',\r\n\t\t}));\r\n\r\n\t\tc.server\r\n\t\t\t.get({\r\n\t\t\t\taction: 'previewUpdate',\r\n\t\t\t\tnewArr: c.newArr,\r\n\t\t\t\toldArr: c.oldData,\r\n\t\t\t})\r\n\t\t\t.then(function (r) {\r\n\t\t\t\tconst oldArr = Array.isArray(r.data.oldArr) ? r.data.oldArr : [];\r\n\t\t\t\tc.olddataArr = oldArr;\r\n\t\t\t\tc.newDataArr = oldArr;\r\n\r\n\t\t\t\tconst itemsForUC = c.newArr.map((item) => {\r\n\t\t\t\t\tconsole.log(\"item : \" + JSON.stringify(item));\r\n\t\t\t\t\tconst copyItem = (c.copyArr || []).find((ci) => ci.item_id === item.u_description_sin) || {};\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tu_description_sin: item.item_id,\r\n\t\t\t\t\t\tdescription: copyItem.description || item.description || item.u_description_sin,\r\n\t\t\t\t\t\tu_unit_price: item.u_unit_price || '-',\r\n\t\t\t\t\t\toldPrice: copyItem.oldPrice || '-',\r\n\t\t\t\t\t\tuc_code: copyItem.uc_code || '-',\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\r\n\t\t\t\tc.updateUCCode(itemsForUC);\r\n\t\t\t\tc.updatMRV(c.newDataArr);\r\n\t\t\t});\r\n\t};\r\n\r\n};\r\n",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "IStationery Stock-In PO Order NOW",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "IStationery Stock-In PO Order NOW",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_scope",
            "reference_type": "table",
            "displayValue": "Global",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "global",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "istationery_stock_in_po_order_now",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "istationery_stock_in_po_order_now",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}