{
    "instance": {
        "name": "ptteptest",
        "url": "https://ptteptest.service-now.com",
        "g_ck": "8891147297e2be50f86b34b71153af0c6bf4d2682e11238f94e219a6c875a0c30bf9bbbb"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "PTTEP SC Catalog Item v4",
    "sys_id": "223b1097db1e3910d63d06a5f396199d",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<div id=\"sc_cat_item\" ng-if=\"::(data.recordFound && !data.not_for_mobile)\" sn-atf-blacklist=\"IS_SERVICE_CATALOG\">\n  <sp-widget widget=\"c.orderItemModal\" ng-if=\"c.orderItemModal\"></sp-widget>\n  <div class=\"row\" ng-if=\"::data.sc_cat_item\" ng-class=\"{'native-mobile': options.native_mobile == 'true'}\">\n    <div class=\"col-sm-12\" ng-class=\"{'col-md-8': options.display_cart_on_right === 'true', 'col-md-12': options.display_cart_on_right !== 'true', 'no-padder': options.native_mobile == 'true'}\" id=\"catItemTop\">\n      <!-- Info Message Box -->\n      <div ng-if=\"data.show_wishlist_msg\" class=\"alert alert-info\">\n        \t{{::m.itemWishlistMsg}}\n      </div>\n      <!--\tSuccess Message Box\t-->\n      <div class=\"alert alert-success\" ng-if=\"data.showMsg\" sc-bind-html-compile=\"m.actionMsg\">\n      </div>\n     <div class=\"panel panel-default\">\n        <!-- Title Section -->\n        <div class=\"wrapper-md b-b break-word item-header\" ng-class=\"{true: '', false: 'sc-sticky-item-header'}[!c.data.sc_cat_item.short_description]\" style=\"top: {{stickyHeaderTop}};\">\n        \t<h1 class=\"h2 m-t-none m-b-sm font-thin\" ng-if=\"::data.sc_cat_item.name && options.native_mobile != 'true'\" style=\"transform:translateX(70px);\">{{::data.sc_cat_item.name}}</h1>\n        \t<div class=\"text-muted sc-cat-item-short-description\" ng-if=\"::data.sc_cat_item.short_description\" style=\"transform:translateX(70px);\">{{::data.sc_cat_item.short_description}}</div>\n      \t\t<div class=\"side-icon\">\n            <img class=\"img-responsive catalog-item-image\" alt=\"{{::data.sc_cat_item.name}}\" style=\"display: inline-block;width:100px;height:100px\" ng-src=\"{{::data.sc_cat_item.picture}}?t=medium\" />\n          </div>\n       \t</div>\n <!--       <div class=\"row b-b no-margin\" ng-if=\"c.data.sc_cat_item.picture || c.data.sc_cat_item.description\" ng-class=\"{'wrapper-md': options.native_mobile != 'true', 'wrapper-sm': options.native_mobile == 'true'}\">\n          <div class=\"col-sm-4 col-xs-12 no-padder\" ng-if=\"c.data.sc_cat_item.picture\">\n            <div class=\"wrapper-md text-center\">\n              <i class=\"fa fa-chevron-left pointer\" style=\"position:absolute; top:50%; left:4%; color:#CECECE\" ng-if=\"options.image_gallery\"></i>\n              <img class=\"img-responsive catalog-item-image\" alt=\"{{::data.sc_cat_item.name}}\" style=\"display: inline\" ng-src=\"{{::data.sc_cat_item.picture}}?t=medium\" />\n              <i class=\"fa fa-chevron-right pointer\" style=\"position:absolute; top:50%; right:4%; color:#CECECE\" ng-if=\"options.image_gallery\"></i>\n              <div class=\"image-gallery padding-top\" ng-if=\"options.image_gallery\">\n                <i class=\"fa fa-circle active\"></i>\n                <i class=\"fa fa-circle\"></i>\n                <i class=\"fa fa-circle\"></i>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-xs-12 break-word col-sm-12\"\n               ng-class=\"{true: 'col-sm-12 no-padder', false: 'col-sm-8'}[!c.data.sc_cat_item.picture]\">\n            <div class=\"visible-md visible-lg\" ng-class=\"{false : 'visible-xs visible-sm', true : 'hidden-xs hidden-sm'}[c.options.show_less_description === 'true']\">\n              <div ng-bind-html=\"::data.sc_cat_item.description\" class=\"sc-item-description\"></div>\n            </div>\n            <div class=\"col-xs-12 col-sm-12 visible-xs visible-sm\" ng-if=\"c.options.show_less_description === 'true'\">\n              <sc-toggle-data sn-data=\"::data.sc_cat_item.description\"></sc-toggle-data>\n        \t\t</div>\n          </div>\n        </div>  -->\n        <div class=\"\" ng-class=\"{'b-b wrapper-md': !data.no_fields}\">\n          <sp-cat-item item=\"::data.sc_cat_item\" ></sp-cat-item>\n          <form>\n            <!-- display view and model -->\n            <sp-model form-model=\"::data.sc_cat_item\" mandatory=\"c.mandatory\"></sp-model>\n          </form>\n        </div>\n        <!-- Bottom cart -->\n        <div class=\"inline-cart\" ng-if=\"::options.display_cart_on_right !== 'true'\">\n          <div ng-if=\"data.can_create_cart_item\" class=\"wrapper-md b-b\">\n              <div class=\"m-b text-right\" ng-if=\"data.showPrices  && (data.sc_cat_item.price || data.sc_cat_item.recurring_price)\" >\n              <b>${Price}:</b> {{data.sc_cat_item.price_display}}<em ng-if=\"data.sc_cat_item.recurring_price\" class=\"cat_item_price\"> {{data.sc_cat_item.price ? '+' : ''}} {{data.sc_cat_item.recurring_price_display + ' ' + data.sc_cat_item.recurring_price_frequency}}</em>\n              </div>\n              <div class=\"m-b text-right\" ng-if=\"!data.hideDeliveryTime && !data.sc_cat_item.no_delivery_time && data.sc_cat_item.estimated_delivery_time\">\n                <b>${Delivery Time}:</b> {{::data.sc_cat_item.estimated_delivery_time}}\n            \t</div>\n              <div ng-if=\"::c.allowOrder()\" class=\"text-right\">\n                <select id=\"catItemQuantity\"\n                        ng-if=\"c.showQuantitySelector()\"\n                        ng-disabled=\"submitting || submitted\"\n                            class=\"m-r-xs sn-select-basic inline\"\n                        ng-model=\"c.quantity\"\n                         \t\tsn-select-width=\"65px\"\n                            aria-label=\"${Quantity}\">\n                   <option ng-repeat=\"num in data.choiceListQuantity\" value={{::num.value}}>{{::num.label}}</option>\n                </select>\n                <button tabindex=\"0\" ng-if=\"c.showAddCartBtn()\" name=\"add_to_cart\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerAddToCart()\" class=\"btn btn-default m-r-xs\">\n                  <i class=\"fa fa fa-shopping-cart m-r-xs\"></i>\n                  ${Add to Cart}\n                </button>\n                <button tabindex=\"0\" ng-if=\"data.is_cart_item\" name=\"update\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerUpdateCart()\" class=\"btn btn-default\">\n                  <i class=\"fa fa fa-shopping-cart m-r-xs\"></i>\n                  ${Update Cart}\n                </button>\n                <span class=\"form-group relative\" ng-if=\"c.showAddToWishlist()\">\n                  <button ng-if=\"!data.is_wishlist_item\" name=\"add_to_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default m-r-xs\">\n                    <i class=\"icon icon-sp-wishlist m-r-xs\" style=\"vertical-align: text-bottom;\"></i>\n                    ${Add to Wish List}\n                  </button>\n                  <button ng-if=\"data.is_wishlist_item\" name=\"update_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default m-r-xs\">\n                    <i class=\"icon icon-sp-wishlist m-r-xs\" style=\"vertical-align: text-bottom;\"></i>\n                    ${Update Wish List}\n                  </button>\n                </span>\n\t\t\t\t\t\t\t\t<button ng-if=\"::c.showOrderNowButton()\" tabindex=\"0\" name=\"submit\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerOnSubmit()\" class=\"btn btn-primary\">{{submitButtonMsg}}</button>\n                <span ng-if=\"submitting\" style=\"padding-left:4px\">${Submitting...}</span>\n                <span ng-if=\"validating\" style=\"padding-left:4px\">${Validating...}</span>\n              </div>\n              <div ng-show=\"hasMandatory(c.mandatory)\" class=\"alert alert-info\" style=\"margin-top: .5em\" ng-if=\"c.options.show_field_validation_messages === 'true'\">\n                <div ng-if=\"hasMandatory(mandatory)\">${Required information} </div>\n                <label ng-repeat=\"f in c.mandatory\" class=\"label sc-field-error-label\" style=\"margin-right: .5em; display: inline-block;\" ng-click=\"getFocus(f)\">{{::f.label}}</label>\n              </div>\n            </div>\n        </div>\n        <div ng-if=\"c.showAttachments()\" class=\"wrapper-md row no-margin\">\n          <now-attachments-list template=\"sp_attachment_single_line\" ></now-attachments-list>\n          <div ng-class=\"{'flex-center attachment-height': options.native_mobile == 'true', 'flex-end': options.native_mobile != 'true'}\">\n            <label ng-if=\"!submitting && !submitted\" style=\"font-weight:normal;cursor:pointer;\">\n              <sp-attachment-button></sp-attachment-button>\n              <span class=\"fa fa-asterisk mandatory\" \n                    ng-if=\"data.sc_cat_item.mandatory_attachment\" \n                    ng-class=\"{'mandatory-filled': data.sc_cat_item.mandatory_attachment && (data.sc_cat_item.attachment_submitted || attachments.length > 0)}\"\n                    style=\"vertical-align:super\"></span>\n              <span>${Add attachments}</span>\n            </label>\n     \t\t </div>\n        </div>\n      </div>\n      <div ng-if=\"::data.sc_cat_item.content_type == 'external'\" class=\"wrapper-md\">\n        <a ng-href=\"{{::data.sc_cat_item.url}}\" target={{::data.sc_cat_item.target}}>{{::data.sc_cat_item.url}} ➚</a>\n      </div>\n\t\t\t<div ng-if=\"::data.sc_cat_item.content_type == 'kb'\" class=\"wrapper-md\">\n        <a  ng-href=\"?id=kb_article&sys_id={{::data.sc_cat_item.kb_article}}\">${Go to KB Article:} {{::data.sc_cat_item.kb_article_description}}</a>\n      </div>\n    </div>\n    <!-- Right side content -->\n    <div class=\"col-sm-12 col-md-4 right-side-cart\" ng-show=\"::options.display_cart_on_right === 'true'\" ng-class=\"{'no-padder': options.native_mobile == 'true'}\">\n      <!-- Right side cart( If you are chaning anything here, please change in bottom cart section also) -->\n      <div ng-class=\"{true:'sc-fixed', false:'' }[options.display_cart_on_right === 'true']\">\n        <div ng-if=\"data.can_create_cart_item\" class=\"panel panel-{{::options.color}} b\" ng-class=\"{'wrapper-md': options.native_mobile != 'true', 'wrapper-sm': options.native_mobile == 'true'}\">\n           <div ng-if=\"::c.allowOrder()\" ng-class=\"{'form-group': options.native_mobile == 'true'}\">\n             <select id=\"catItemQuantity\"\n                     ng-if=\"c.showQuantitySelector()\"\n                     ng-disabled=\"submitting || submitted\"\n                     class=\"m-b sn-select-basic\"\n                     ng-model=\"c.quantity\"\n                     aria-label=\"${Quantity}\">\n               <option ng-repeat=\"num in data.choiceListQuantity\" value={{::num.value}}>{{::num.label}}</option>\n             </select>\n           </div>\n          \t<div class=\"form-group relative\" ng-if=\"c.options.native_mobile == 'true'\">\n             <div class=\"\" ng-if=\"data.showPrices && (data.sc_cat_item.price || data.sc_cat_item.recurring_price)\">\n               <b>{{data.sc_cat_item.price_display}}</b> <em ng-if=\"data.sc_cat_item.recurring_price\" class=\"cat_item_price\"> {{data.sc_cat_item.price ? '+' : ''}} {{data.sc_cat_item.recurring_price_display + ' ' + data.sc_cat_item.recurring_price_frequency}}</em>\n             </div>\n             <div class=\"text-muted\" ng-if=\"!data.hideDeliveryTime && !data.sc_cat_item.no_delivery_time && data.sc_cat_item.estimated_delivery_time\">\n               ${Delivery Time}: {{::data.sc_cat_item.estimated_delivery_time}}\n             </div>\n           </div>\n           <div class=\"form-group relative\" ng-if=\"c.options.native_mobile != 'true'\">\n             <div class=\"form-group\" ng-if=\"data.showPrices && (data.sc_cat_item.price || data.sc_cat_item.recurring_price)\">\n               <b>${Price}:</b> {{data.sc_cat_item.price_display}}<em ng-if=\"data.sc_cat_item.recurring_price\" class=\"cat_item_price\"> {{data.sc_cat_item.price ? '+' : ''}} {{data.sc_cat_item.recurring_price_display + ' ' + data.sc_cat_item.recurring_price_frequency}}</em>\n             </div>\n             <div class=\"form-group\" ng-if=\"!data.hideDeliveryTime && !data.sc_cat_item.no_delivery_time && data.sc_cat_item.estimated_delivery_time\">\n               <b>${Delivery Time}:</b> {{::data.sc_cat_item.estimated_delivery_time}}\n             </div>\n             <button tabindex=\"0\" ng-if=\"c.showAddCartBtn()\" name=\"add_to_cart\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerAddToCart()\" class=\"btn btn-default sc-btn form-control\">\n               <i class=\"fa fa fa-shopping-cart sc-order-widget-btn pull-left\"></i>\n               ${Add to Cart}\n             </button>\n             <button tabindex=\"0\" ng-if=\"data.is_cart_item\" name=\"update\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerUpdateCart()\" class=\"btn btn-default sc-btn form-control\">\n               <i class=\"fa fa fa-shopping-cart sc-order-widget-btn pull-left\"></i>\n               ${Update Cart}\n             </button>\n           </div>\n           <div class=\"form-group relative\" ng-if=\"c.showAddToWishlist()\">\n             <button ng-if=\"!data.is_wishlist_item\" name=\"add_to_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default sc-btn form-control\">\n               <i class=\"icon icon-sp-wishlist sc-order-widget-btn pull-left\" style=\"top:5px\"></i>\n               ${Add to Wish List}\n             </button>\n             <button ng-if=\"data.is_wishlist_item\" name=\"update_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default sc-btn form-control\">\n             \t<i class=\"icon icon-sp-wishlist sc-order-widget-btn pull-left\" style=\"top:5px\"></i>\n             \t${Update Wish List}\n             </button>\n           </div>\n           <div class=\"form-group m-b-xs\" ng-if=\"c.options.native_mobile != 'true'\">\n             <button ng-if=\"::c.showOrderNowButton()\" tabindex=\"0\" name=\"submit\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerOnSubmit()\" sn-focus=\"true\" class=\"btn btn-primary btn-block\">{{submitButtonMsg}}</button>\n             <span ng-if=\"submitting\" style=\"padding-left:4px\">${Submitting...}</span>\n             <span ng-if=\"validating\" style=\"padding-left:4px\">${Validating...}</span>\n           </div>\n           <div class=\"form-group m-b-xs flex-center\" ng-if=\"c.options.native_mobile == 'true' && 1==2\">\n\t\t\t\t\t\t\t\t<button tabindex=\"0\" ng-if=\"c.showAddCartBtn()\" name=\"add_to_cart\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerAddToCart()\" class=\"btn btn-default sc-btn native-btn rounded m-r-lg padder-xl\">\n               \t\t\t${Add to Cart}\n\t\t\t\t\t\t\t\t</button>\n             \t\t<button tabindex=\"0\" ng-if=\"data.is_cart_item\" name=\"update\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerUpdateCart()\" class=\"btn btn-default sc-btn native-btn rounded m-r-lg padder-xl\">\n                    <i class=\"fa fa fa-shopping-cart sc-order-widget-btn pull-left\"></i>\n                    ${Update Cart}\n               </button>\n             \t  <div class=\"form-group m-b-xs\">\n                    <button ng-if=\"::c.showOrderNowButton()\" tabindex=\"0\" name=\"submit\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerOnSubmit()\" class=\"btn btn-primary rounded m-l-lg padder-xl\">{{submitButtonMsg}}</button>\n                    <span ng-if=\"submitting\" style=\"padding-left:4px\">${Submitting...}</span>\n               </div>\n          </div>\n         </div>\n      \t<div class=\"sc-item-error-messages\" ng-if=\"c.options.show_field_validation_messages === 'true'\">\n            <div class=\"row\" ng-if=\"hasMandatory(c.mandatory)\" class=\" row alert alert-info-border\" style=\"margin-top: .5em\">\n              <div class=\"col-sm-12\">\n                <div ng-if=\"hasMandatory(c.mandatory)\">${Required information} </div>\n                 <label ng-repeat=\"f in c.mandatory\" class=\"label sc-field-error-label\" ng-click=\"getFocus(f)\">{{::f.label}}</label>\n              </div>\n           </div>\n         </div>\n        \n        \n         <div  class=\"panel panel-{{::options.color}} b\" style=\"overflow-y: scroll\" ng-if=\"c.data.sc_cat_item.description\" ng-class=\"{'wrapper-md': options.native_mobile != 'true', 'wrapper-sm': options.native_mobile == 'true'}\">\n         \n           \n              <div ng-bind-html=\"::data.sc_cat_item.description\" class=\"sc-item-description\" ></div>\n           \n            \n        </div> \n      \n      \n        \n       \n     </div>\n      \n     \n      \n    </div>\n  \n      \n \n  \n  \n  </div>\n  \n  <div ng-if=\"::!data.sc_cat_item\" >\n    <div class=\"panel panel-default\">\n      <div class=\"panel-heading\"><h4 class=\"panel-title\">${Item not found}</h4></div>\n      <div class=\"panel-body wrapper\">\n        <p>${This item is not found or currently not available}</p>\n        <p>${Suggestions}:</p>\n        <ul>\n          <li>${Try searching for the item}</li>\n          <li>${Go to the Service Catalog homepage}</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\"sr-only\" aria-live=\"assertive\">{{::c.status}}</div>\n</div>\n<div ng-if=\"::!data.recordFound\" class=\"alert alert-info\">{{::m.invalidRecordMsg}}</div>\n<div ng-if=\"::data.not_for_mobile\">\n  <div class=\"wrapper-lg flex-center\">\n    ${We're sorry, this item isn't available on mobile}\n  </div>\n  <div class=\"flex-center\">\n  \t<img src=\"not_viewable.png\" width=\"300\"/>  \n  </div>\n</div>\n<now-message key=\"Added item to shopping cart\" value=\"${Added item to shopping cart}\"/>\n<now-message key=\"Attachment(s) are not added\" value=\"${Attachment(s) are not added}\"/>\n<now-message key=\"Leave page?\" value=\"${Leave page?}\"/>\n<now-message key=\"Changes you made will be lost.\" value=\"${Changes you made will be lost.}\"/>\n<now-message key=\"Cancel\" value=\"${Cancel}\"/>\n<now-message key=\"Leave\" value=\"${Leave}\"/>",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<div id=\"sc_cat_item\" ng-if=\"::(data.recordFound && !data.not_for_mobile)\" sn-atf-blacklist=\"IS_SERVICE_CATALOG\">\n  <sp-widget widget=\"c.orderItemModal\" ng-if=\"c.orderItemModal\"></sp-widget>\n  <div class=\"row\" ng-if=\"::data.sc_cat_item\" ng-class=\"{'native-mobile': options.native_mobile == 'true'}\">\n    <div class=\"col-sm-12\" ng-class=\"{'col-md-8': options.display_cart_on_right === 'true', 'col-md-12': options.display_cart_on_right !== 'true', 'no-padder': options.native_mobile == 'true'}\" id=\"catItemTop\">\n      <!-- Info Message Box -->\n      <div ng-if=\"data.show_wishlist_msg\" class=\"alert alert-info\">\n        \t{{::m.itemWishlistMsg}}\n      </div>\n      <!--\tSuccess Message Box\t-->\n      <div class=\"alert alert-success\" ng-if=\"data.showMsg\" sc-bind-html-compile=\"m.actionMsg\">\n      </div>\n     <div class=\"panel panel-default\">\n        <!-- Title Section -->\n        <div class=\"wrapper-md b-b break-word item-header\" ng-class=\"{true: '', false: 'sc-sticky-item-header'}[!c.data.sc_cat_item.short_description]\" style=\"top: {{stickyHeaderTop}};\">\n        \t<h1 class=\"h2 m-t-none m-b-sm font-thin\" ng-if=\"::data.sc_cat_item.name && options.native_mobile != 'true'\" style=\"transform:translateX(70px);\">{{::data.sc_cat_item.name}}</h1>\n        \t<div class=\"text-muted sc-cat-item-short-description\" ng-if=\"::data.sc_cat_item.short_description\" style=\"transform:translateX(70px);\">{{::data.sc_cat_item.short_description}}</div>\n      \t\t<div class=\"side-icon\">\n            <img class=\"img-responsive catalog-item-image\" alt=\"{{::data.sc_cat_item.name}}\" style=\"display: inline-block;width:100px;height:100px\" ng-src=\"{{::data.sc_cat_item.picture}}?t=medium\" />\n          </div>\n       \t</div>\n <!--       <div class=\"row b-b no-margin\" ng-if=\"c.data.sc_cat_item.picture || c.data.sc_cat_item.description\" ng-class=\"{'wrapper-md': options.native_mobile != 'true', 'wrapper-sm': options.native_mobile == 'true'}\">\n          <div class=\"col-sm-4 col-xs-12 no-padder\" ng-if=\"c.data.sc_cat_item.picture\">\n            <div class=\"wrapper-md text-center\">\n              <i class=\"fa fa-chevron-left pointer\" style=\"position:absolute; top:50%; left:4%; color:#CECECE\" ng-if=\"options.image_gallery\"></i>\n              <img class=\"img-responsive catalog-item-image\" alt=\"{{::data.sc_cat_item.name}}\" style=\"display: inline\" ng-src=\"{{::data.sc_cat_item.picture}}?t=medium\" />\n              <i class=\"fa fa-chevron-right pointer\" style=\"position:absolute; top:50%; right:4%; color:#CECECE\" ng-if=\"options.image_gallery\"></i>\n              <div class=\"image-gallery padding-top\" ng-if=\"options.image_gallery\">\n                <i class=\"fa fa-circle active\"></i>\n                <i class=\"fa fa-circle\"></i>\n                <i class=\"fa fa-circle\"></i>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-xs-12 break-word col-sm-12\"\n               ng-class=\"{true: 'col-sm-12 no-padder', false: 'col-sm-8'}[!c.data.sc_cat_item.picture]\">\n            <div class=\"visible-md visible-lg\" ng-class=\"{false : 'visible-xs visible-sm', true : 'hidden-xs hidden-sm'}[c.options.show_less_description === 'true']\">\n              <div ng-bind-html=\"::data.sc_cat_item.description\" class=\"sc-item-description\"></div>\n            </div>\n            <div class=\"col-xs-12 col-sm-12 visible-xs visible-sm\" ng-if=\"c.options.show_less_description === 'true'\">\n              <sc-toggle-data sn-data=\"::data.sc_cat_item.description\"></sc-toggle-data>\n        \t\t</div>\n          </div>\n        </div>  -->\n        <div class=\"\" ng-class=\"{'b-b wrapper-md': !data.no_fields}\">\n          <sp-cat-item item=\"::data.sc_cat_item\" ></sp-cat-item>\n          <form>\n            <!-- display view and model -->\n            <sp-model form-model=\"::data.sc_cat_item\" mandatory=\"c.mandatory\"></sp-model>\n          </form>\n        </div>\n        <!-- Bottom cart -->\n        <div class=\"inline-cart\" ng-if=\"::options.display_cart_on_right !== 'true'\">\n          <div ng-if=\"data.can_create_cart_item\" class=\"wrapper-md b-b\">\n              <div class=\"m-b text-right\" ng-if=\"data.showPrices  && (data.sc_cat_item.price || data.sc_cat_item.recurring_price)\" >\n              <b>${Price}:</b> {{data.sc_cat_item.price_display}}<em ng-if=\"data.sc_cat_item.recurring_price\" class=\"cat_item_price\"> {{data.sc_cat_item.price ? '+' : ''}} {{data.sc_cat_item.recurring_price_display + ' ' + data.sc_cat_item.recurring_price_frequency}}</em>\n              </div>\n              <div class=\"m-b text-right\" ng-if=\"!data.hideDeliveryTime && !data.sc_cat_item.no_delivery_time && data.sc_cat_item.estimated_delivery_time\">\n                <b>${Delivery Time}:</b> {{::data.sc_cat_item.estimated_delivery_time}}\n            \t</div>\n              <div ng-if=\"::c.allowOrder()\" class=\"text-right\">\n                <select id=\"catItemQuantity\"\n                        ng-if=\"c.showQuantitySelector()\"\n                        ng-disabled=\"submitting || submitted\"\n                            class=\"m-r-xs sn-select-basic inline\"\n                        ng-model=\"c.quantity\"\n                         \t\tsn-select-width=\"65px\"\n                            aria-label=\"${Quantity}\">\n                   <option ng-repeat=\"num in data.choiceListQuantity\" value={{::num.value}}>{{::num.label}}</option>\n                </select>\n                <button tabindex=\"0\" ng-if=\"c.showAddCartBtn()\" name=\"add_to_cart\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerAddToCart()\" class=\"btn btn-default m-r-xs\">\n                  <i class=\"fa fa fa-shopping-cart m-r-xs\"></i>\n                  ${Add to Cart}\n                </button>\n                <button tabindex=\"0\" ng-if=\"data.is_cart_item\" name=\"update\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerUpdateCart()\" class=\"btn btn-default\">\n                  <i class=\"fa fa fa-shopping-cart m-r-xs\"></i>\n                  ${Update Cart}\n                </button>\n                <span class=\"form-group relative\" ng-if=\"c.showAddToWishlist()\">\n                  <button ng-if=\"!data.is_wishlist_item\" name=\"add_to_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default m-r-xs\">\n                    <i class=\"icon icon-sp-wishlist m-r-xs\" style=\"vertical-align: text-bottom;\"></i>\n                    ${Add to Wish List}\n                  </button>\n                  <button ng-if=\"data.is_wishlist_item\" name=\"update_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default m-r-xs\">\n                    <i class=\"icon icon-sp-wishlist m-r-xs\" style=\"vertical-align: text-bottom;\"></i>\n                    ${Update Wish List}\n                  </button>\n                </span>\n\t\t\t\t\t\t\t\t<button ng-if=\"::c.showOrderNowButton()\" tabindex=\"0\" name=\"submit\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerOnSubmit()\" class=\"btn btn-primary\">{{submitButtonMsg}}</button>\n                <span ng-if=\"submitting\" style=\"padding-left:4px\">${Submitting...}</span>\n                <span ng-if=\"validating\" style=\"padding-left:4px\">${Validating...}</span>\n              </div>\n              <div ng-show=\"hasMandatory(c.mandatory)\" class=\"alert alert-info\" style=\"margin-top: .5em\" ng-if=\"c.options.show_field_validation_messages === 'true'\">\n                <div ng-if=\"hasMandatory(mandatory)\">${Required information} </div>\n                <label ng-repeat=\"f in c.mandatory\" class=\"label sc-field-error-label\" style=\"margin-right: .5em; display: inline-block;\" ng-click=\"getFocus(f)\">{{::f.label}}</label>\n              </div>\n            </div>\n        </div>\n        <div ng-if=\"c.showAttachments()\" class=\"wrapper-md row no-margin\">\n          <now-attachments-list template=\"sp_attachment_single_line\" ></now-attachments-list>\n          <div ng-class=\"{'flex-center attachment-height': options.native_mobile == 'true', 'flex-end': options.native_mobile != 'true'}\">\n            <label ng-if=\"!submitting && !submitted\" style=\"font-weight:normal;cursor:pointer;\">\n              <sp-attachment-button></sp-attachment-button>\n              <span class=\"fa fa-asterisk mandatory\" \n                    ng-if=\"data.sc_cat_item.mandatory_attachment\" \n                    ng-class=\"{'mandatory-filled': data.sc_cat_item.mandatory_attachment && (data.sc_cat_item.attachment_submitted || attachments.length > 0)}\"\n                    style=\"vertical-align:super\"></span>\n              <span>${Add attachments}</span>\n            </label>\n     \t\t </div>\n        </div>\n      </div>\n      <div ng-if=\"::data.sc_cat_item.content_type == 'external'\" class=\"wrapper-md\">\n        <a ng-href=\"{{::data.sc_cat_item.url}}\" target={{::data.sc_cat_item.target}}>{{::data.sc_cat_item.url}} ➚</a>\n      </div>\n\t\t\t<div ng-if=\"::data.sc_cat_item.content_type == 'kb'\" class=\"wrapper-md\">\n        <a  ng-href=\"?id=kb_article&sys_id={{::data.sc_cat_item.kb_article}}\">${Go to KB Article:} {{::data.sc_cat_item.kb_article_description}}</a>\n      </div>\n    </div>\n    <!-- Right side content -->\n    <div class=\"col-sm-12 col-md-4 right-side-cart\" ng-show=\"::options.display_cart_on_right === 'true'\" ng-class=\"{'no-padder': options.native_mobile == 'true'}\">\n      <!-- Right side cart( If you are chaning anything here, please change in bottom cart section also) -->\n      <div ng-class=\"{true:'sc-fixed', false:'' }[options.display_cart_on_right === 'true']\">\n        <div ng-if=\"data.can_create_cart_item\" class=\"panel panel-{{::options.color}} b\" ng-class=\"{'wrapper-md': options.native_mobile != 'true', 'wrapper-sm': options.native_mobile == 'true'}\">\n           <div ng-if=\"::c.allowOrder()\" ng-class=\"{'form-group': options.native_mobile == 'true'}\">\n             <select id=\"catItemQuantity\"\n                     ng-if=\"c.showQuantitySelector()\"\n                     ng-disabled=\"submitting || submitted\"\n                     class=\"m-b sn-select-basic\"\n                     ng-model=\"c.quantity\"\n                     aria-label=\"${Quantity}\">\n               <option ng-repeat=\"num in data.choiceListQuantity\" value={{::num.value}}>{{::num.label}}</option>\n             </select>\n           </div>\n          \t<div class=\"form-group relative\" ng-if=\"c.options.native_mobile == 'true'\">\n             <div class=\"\" ng-if=\"data.showPrices && (data.sc_cat_item.price || data.sc_cat_item.recurring_price)\">\n               <b>{{data.sc_cat_item.price_display}}</b> <em ng-if=\"data.sc_cat_item.recurring_price\" class=\"cat_item_price\"> {{data.sc_cat_item.price ? '+' : ''}} {{data.sc_cat_item.recurring_price_display + ' ' + data.sc_cat_item.recurring_price_frequency}}</em>\n             </div>\n             <div class=\"text-muted\" ng-if=\"!data.hideDeliveryTime && !data.sc_cat_item.no_delivery_time && data.sc_cat_item.estimated_delivery_time\">\n               ${Delivery Time}: {{::data.sc_cat_item.estimated_delivery_time}}\n             </div>\n           </div>\n           <div class=\"form-group relative\" ng-if=\"c.options.native_mobile != 'true'\">\n             <div class=\"form-group\" ng-if=\"data.showPrices && (data.sc_cat_item.price || data.sc_cat_item.recurring_price)\">\n               <b>${Price}:</b> {{data.sc_cat_item.price_display}}<em ng-if=\"data.sc_cat_item.recurring_price\" class=\"cat_item_price\"> {{data.sc_cat_item.price ? '+' : ''}} {{data.sc_cat_item.recurring_price_display + ' ' + data.sc_cat_item.recurring_price_frequency}}</em>\n             </div>\n             <div class=\"form-group\" ng-if=\"!data.hideDeliveryTime && !data.sc_cat_item.no_delivery_time && data.sc_cat_item.estimated_delivery_time\">\n               <b>${Delivery Time}:</b> {{::data.sc_cat_item.estimated_delivery_time}}\n             </div>\n             <button tabindex=\"0\" ng-if=\"c.showAddCartBtn()\" name=\"add_to_cart\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerAddToCart()\" class=\"btn btn-default sc-btn form-control\">\n               <i class=\"fa fa fa-shopping-cart sc-order-widget-btn pull-left\"></i>\n               ${Add to Cart}\n             </button>\n             <button tabindex=\"0\" ng-if=\"data.is_cart_item\" name=\"update\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerUpdateCart()\" class=\"btn btn-default sc-btn form-control\">\n               <i class=\"fa fa fa-shopping-cart sc-order-widget-btn pull-left\"></i>\n               ${Update Cart}\n             </button>\n           </div>\n           <div class=\"form-group relative\" ng-if=\"c.showAddToWishlist()\">\n             <button ng-if=\"!data.is_wishlist_item\" name=\"add_to_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default sc-btn form-control\">\n               <i class=\"icon icon-sp-wishlist sc-order-widget-btn pull-left\" style=\"top:5px\"></i>\n               ${Add to Wish List}\n             </button>\n             <button ng-if=\"data.is_wishlist_item\" name=\"update_wishlist\" ng-click=\"addToWishlist()\" ng-disabled=\"submitting || submitted\" class=\"btn btn-default sc-btn form-control\">\n             \t<i class=\"icon icon-sp-wishlist sc-order-widget-btn pull-left\" style=\"top:5px\"></i>\n             \t${Update Wish List}\n             </button>\n           </div>\n           <div class=\"form-group m-b-xs\" ng-if=\"c.options.native_mobile != 'true'\">\n             <button ng-if=\"::c.showOrderNowButton()\" tabindex=\"0\" name=\"submit\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerOnSubmit()\" sn-focus=\"true\" class=\"btn btn-primary btn-block\">{{submitButtonMsg}}</button>\n             <span ng-if=\"submitting\" style=\"padding-left:4px\">${Submitting...}</span>\n             <span ng-if=\"validating\" style=\"padding-left:4px\">${Validating...}</span>\n           </div>\n           <div class=\"form-group m-b-xs flex-center\" ng-if=\"c.options.native_mobile == 'true' && 1==2\">\n\t\t\t\t\t\t\t\t<button tabindex=\"0\" ng-if=\"c.showAddCartBtn()\" name=\"add_to_cart\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerAddToCart()\" class=\"btn btn-default sc-btn native-btn rounded m-r-lg padder-xl\">\n               \t\t\t${Add to Cart}\n\t\t\t\t\t\t\t\t</button>\n             \t\t<button tabindex=\"0\" ng-if=\"data.is_cart_item\" name=\"update\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerUpdateCart()\" class=\"btn btn-default sc-btn native-btn rounded m-r-lg padder-xl\">\n                    <i class=\"fa fa fa-shopping-cart sc-order-widget-btn pull-left\"></i>\n                    ${Update Cart}\n               </button>\n             \t  <div class=\"form-group m-b-xs\">\n                    <button ng-if=\"::c.showOrderNowButton()\" tabindex=\"0\" name=\"submit\" ng-disabled=\"submitting || submitted\" ng-click=\"triggerOnSubmit()\" class=\"btn btn-primary rounded m-l-lg padder-xl\">{{submitButtonMsg}}</button>\n                    <span ng-if=\"submitting\" style=\"padding-left:4px\">${Submitting...}</span>\n               </div>\n          </div>\n         </div>\n      \t<div class=\"sc-item-error-messages\" ng-if=\"c.options.show_field_validation_messages === 'true'\">\n            <div class=\"row\" ng-if=\"hasMandatory(c.mandatory)\" class=\" row alert alert-info-border\" style=\"margin-top: .5em\">\n              <div class=\"col-sm-12\">\n                <div ng-if=\"hasMandatory(c.mandatory)\">${Required information} </div>\n                 <label ng-repeat=\"f in c.mandatory\" class=\"label sc-field-error-label\" ng-click=\"getFocus(f)\">{{::f.label}}</label>\n              </div>\n           </div>\n         </div>\n        \n        \n         <div  class=\"panel panel-{{::options.color}} b\" style=\"overflow-y: scroll\" ng-if=\"c.data.sc_cat_item.description\" ng-class=\"{'wrapper-md': options.native_mobile != 'true', 'wrapper-sm': options.native_mobile == 'true'}\">\n         \n           \n              <div ng-bind-html=\"::data.sc_cat_item.description\" class=\"sc-item-description\" ></div>\n           \n            \n        </div> \n      \n      \n        \n       \n     </div>\n      \n     \n      \n    </div>\n  \n      \n \n  \n  \n  </div>\n  \n  <div ng-if=\"::!data.sc_cat_item\" >\n    <div class=\"panel panel-default\">\n      <div class=\"panel-heading\"><h4 class=\"panel-title\">${Item not found}</h4></div>\n      <div class=\"panel-body wrapper\">\n        <p>${This item is not found or currently not available}</p>\n        <p>${Suggestions}:</p>\n        <ul>\n          <li>${Try searching for the item}</li>\n          <li>${Go to the Service Catalog homepage}</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\"sr-only\" aria-live=\"assertive\">{{::c.status}}</div>\n</div>\n<div ng-if=\"::!data.recordFound\" class=\"alert alert-info\">{{::m.invalidRecordMsg}}</div>\n<div ng-if=\"::data.not_for_mobile\">\n  <div class=\"wrapper-lg flex-center\">\n    ${We're sorry, this item isn't available on mobile}\n  </div>\n  <div class=\"flex-center\">\n  \t<img src=\"not_viewable.png\" width=\"300\"/>  \n  </div>\n</div>\n<now-message key=\"Added item to shopping cart\" value=\"${Added item to shopping cart}\"/>\n<now-message key=\"Attachment(s) are not added\" value=\"${Attachment(s) are not added}\"/>\n<now-message key=\"Leave page?\" value=\"${Leave page?}\"/>\n<now-message key=\"Changes you made will be lost.\" value=\"${Changes you made will be lost.}\"/>\n<now-message key=\"Cancel\" value=\"${Cancel}\"/>\n<now-message key=\"Leave\" value=\"${Leave}\"/>",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "internal": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Internal",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "",
            "name": "internal",
            "attributes": {},
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "internal"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".btn-group.attachment-mobile > button {\n  padding: 1px 6px;\n}\n\n.panel-button {\n  float: none;\n}\n\n.sp-attachment-add {\n  padding: 5px;\n}\n\n.p-t-none {\n  padding-top: 0 !important;\n}\n\n.file-list-wrap {\n\tmargin-bottom: 10px;\n}\n\n.sc-btn {\n  color: $text-color;\n}\n\n.dismiss-button {\n  position: absolute;\n  top: 1rem;\n\tright: 10px;\n\tcolor: $text-color;\n\tcursor: pointer;\n}\n\n.item-header {\n  padding-top: 10px !important;\n  padding-bottom: 10px !important;\n}\n\n.sc-item-description img {\n  max-width: 100%;\n  height: auto;\n}\n.sc-sticky-item-header {\n  position: sticky;\n  position: -webkit-sticky;\n  position: -ms-sticky;\n  top: -($font-size-h2 + $font-size-base);\n  z-index: 10;\n  background-color: inherit;\n  border-radius: 4px 4px 0 0;\n}\n.sc-fixed {\n  //position: fixed;\n  //max-height: 100%;\n  //width: 17.67777%;\n      position: relative;\n    width: 100%;\n}\n.no-margin {\n\tmargin: 0px; \n}\n.sc-item-error-messages {\n  max-height: 100%;\n // position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  width: 100%; \n}\n.sc-field-error-label {\n  margin-right: .5em; \n  display: inline-block;\n  cursor: pointer;\n  background-color: $sc-field-error-color;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n.image-gallery {\n  font-size: 8px;\n  color: #CECECE;\n  .active {\n    color: #717171;\n  }\n  i {\n    padding: 0 5px;\n  }\n}\n.relative {\n  position: relative;\n}\n.sc-order-widget-btn {\n   position: absolute;\n   left: 9%;\n}\n\n.close-notification {\n  \tposition: absolute;\n  \ttop: 10px;\n  \tright: 18px;\n}\n.help-tag-icon {\n  \tcolor: $sc-field-error-color;\n}\n@media only screen and (max-width : 992px) {\n  .sc-fixed {\n    position: relative;\n    width: 100%;\n  }\n  .wishlist-update-message {\n    display : block;\n  }\n  .sc-item-error-messages {\n    position: relative;\n  }\n  .read-more, .read-less {\n    font-size: 15px;\n    cursor: pointer;\n  }\n  .more-text {\n    display: none;\n  }\n  .inline-cart {\n    display: none;\n  }\n  .right-side-cart {\n    display: inherit !important;\n  }\n}\n@media only screen and (max-width : 768px) {\n  .sc-sticky-item-header {\n     position: inherit;\n  }\n  \n}\n.inline-cart {\n  .quantity-selector {\n    display: inline-block;\n    width: 65px;\n    padding-top: 2px;\n  }\n}\n.alert-success .link {\n    text-decoration: underline;\n}\n\n.alert-info-border {\n\tborder-color: $alert-info-border;\n}\n\n.native-mobile {\n  \t.panel {\n      \tborder-left: 0;\n      \tborder-right: 0;\n    }\n}\n\n.flex-center {\n  \tdisplay: flex;\n  \tjustify-content: center;\n  \talign-items: center;\n}\n\n.flex-end {\n  \tdisplay: flex;\n  \tjustify-content: flex-end;\n}\n\n.attachment-height {\n \t\t height: 80px;\n}\n\n.side-icon{\n \tposition:absolute;\n  top:-5px;\n  left:0px;\n  transform:scale(0.5,0.5);\n  padding:0;\n}",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".btn-group.attachment-mobile > button {\n  padding: 1px 6px;\n}\n\n.panel-button {\n  float: none;\n}\n\n.sp-attachment-add {\n  padding: 5px;\n}\n\n.p-t-none {\n  padding-top: 0 !important;\n}\n\n.file-list-wrap {\n\tmargin-bottom: 10px;\n}\n\n.sc-btn {\n  color: $text-color;\n}\n\n.dismiss-button {\n  position: absolute;\n  top: 1rem;\n\tright: 10px;\n\tcolor: $text-color;\n\tcursor: pointer;\n}\n\n.item-header {\n  padding-top: 10px !important;\n  padding-bottom: 10px !important;\n}\n\n.sc-item-description img {\n  max-width: 100%;\n  height: auto;\n}\n.sc-sticky-item-header {\n  position: sticky;\n  position: -webkit-sticky;\n  position: -ms-sticky;\n  top: -($font-size-h2 + $font-size-base);\n  z-index: 10;\n  background-color: inherit;\n  border-radius: 4px 4px 0 0;\n}\n.sc-fixed {\n  //position: fixed;\n  //max-height: 100%;\n  //width: 17.67777%;\n      position: relative;\n    width: 100%;\n}\n.no-margin {\n\tmargin: 0px; \n}\n.sc-item-error-messages {\n  max-height: 100%;\n // position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  width: 100%; \n}\n.sc-field-error-label {\n  margin-right: .5em; \n  display: inline-block;\n  cursor: pointer;\n  background-color: $sc-field-error-color;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n.image-gallery {\n  font-size: 8px;\n  color: #CECECE;\n  .active {\n    color: #717171;\n  }\n  i {\n    padding: 0 5px;\n  }\n}\n.relative {\n  position: relative;\n}\n.sc-order-widget-btn {\n   position: absolute;\n   left: 9%;\n}\n\n.close-notification {\n  \tposition: absolute;\n  \ttop: 10px;\n  \tright: 18px;\n}\n.help-tag-icon {\n  \tcolor: $sc-field-error-color;\n}\n@media only screen and (max-width : 992px) {\n  .sc-fixed {\n    position: relative;\n    width: 100%;\n  }\n  .wishlist-update-message {\n    display : block;\n  }\n  .sc-item-error-messages {\n    position: relative;\n  }\n  .read-more, .read-less {\n    font-size: 15px;\n    cursor: pointer;\n  }\n  .more-text {\n    display: none;\n  }\n  .inline-cart {\n    display: none;\n  }\n  .right-side-cart {\n    display: inherit !important;\n  }\n}\n@media only screen and (max-width : 768px) {\n  .sc-sticky-item-header {\n     position: inherit;\n  }\n  \n}\n.inline-cart {\n  .quantity-selector {\n    display: inline-block;\n    width: 65px;\n    padding-top: 2px;\n  }\n}\n.alert-success .link {\n    text-decoration: underline;\n}\n\n.alert-info-border {\n\tborder-color: $alert-info-border;\n}\n\n.native-mobile {\n  \t.panel {\n      \tborder-left: 0;\n      \tborder-right: 0;\n    }\n}\n\n.flex-center {\n  \tdisplay: flex;\n  \tjustify-content: center;\n  \talign-items: center;\n}\n\n.flex-end {\n  \tdisplay: flex;\n  \tjustify-content: flex-end;\n}\n\n.attachment-height {\n \t\t height: 80px;\n}\n\n.side-icon{\n \tposition:absolute;\n  top:-5px;\n  left:0px;\n  transform:scale(0.5,0.5);\n  padding:0;\n}",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "snc_external,snc_internal",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "snc_external,snc_internal",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function(scope, elem){\n    scope.setFocusToAttachment = function () {\n\t\tsetTimeout(function () {\n\t\t\tvar inboxArray = elem.find(\"a.view-attachment\");\n\t\t\tinboxArray.focus();\n\t\t}, 100);\n\t}\n\tscope.setFocusToAttachmentButton = function () {\n\t\telem.find('.sp-attachment-add')[0].focus();\n\t}\n}\n\t",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function(scope, elem){\n    scope.setFocusToAttachment = function () {\n\t\tsetTimeout(function () {\n\t\t\tvar inboxArray = elem.find(\"a.view-attachment\");\n\t\t\tinboxArray.focus();\n\t\t}, 100);\n\t}\n\tscope.setFocusToAttachmentButton = function () {\n\t\telem.find('.sp-attachment-add')[0].focus();\n\t}\n}\n\t",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "[{\"name\":\"show_add_cart_button\",\"section\":\"other\",\"label\":\"Show Add Cart Button\",\"type\":\"boolean\"},{\"hint\":\"If you turn on this, you will be able to see field validation messages on right side\",\"name\":\"show_field_validation_messages\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Show field validation messages\",\"type\":\"boolean\"},{\"hint\":\"Show Add/Update Wish List buttons\",\"name\":\"show_add_to_wishlist_button\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Show Add/Update Wish List buttons\",\"type\":\"boolean\"},{\"hint\":\"Order item section on top. If you uncheck this, order section will be displayed at bottom of screen\",\"name\":\"display_cart_on_right\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Order Item Section On Top\",\"type\":\"boolean\"},{\"hint\":\"Show item description in few words with an option to read more\",\"name\":\"show_less_description\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Enable Show More/Less for Item description on Mobile\",\"type\":\"boolean\"},{\"hint\":\"Hide the Delivery Time in the widget\",\"name\":\"hide_delivery_time\",\"section\":\"other\",\"default_value\":\"false\",\"label\":\"Hide Delivery Time\",\"type\":\"boolean\"}]",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "[{\"name\":\"show_add_cart_button\",\"section\":\"other\",\"label\":\"Show Add Cart Button\",\"type\":\"boolean\"},{\"hint\":\"If you turn on this, you will be able to see field validation messages on right side\",\"name\":\"show_field_validation_messages\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Show field validation messages\",\"type\":\"boolean\"},{\"hint\":\"Show Add/Update Wish List buttons\",\"name\":\"show_add_to_wishlist_button\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Show Add/Update Wish List buttons\",\"type\":\"boolean\"},{\"hint\":\"Order item section on top. If you uncheck this, order section will be displayed at bottom of screen\",\"name\":\"display_cart_on_right\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Order Item Section On Top\",\"type\":\"boolean\"},{\"hint\":\"Show item description in few words with an option to read more\",\"name\":\"show_less_description\",\"default_value\":\"true\",\"section\":\"other\",\"label\":\"Enable Show More/Less for Item description on Mobile\",\"type\":\"boolean\"},{\"hint\":\"Hide the Delivery Time in the widget\",\"name\":\"hide_delivery_time\",\"section\":\"other\",\"default_value\":\"false\",\"label\":\"Hide Delivery Time\",\"type\":\"boolean\"}]",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "// populate the 'data' variable with catalog item, variables, and variable view\n(function() {\n\tvar localInput = input; //to safeguard pullution of \"input\" via BR or other scripts\n\n\tvar draftID = $sp.getParameter(\"draft_id\");\n\tdata.draft_id = draftID;\n\t\n\tvar embeddedWidgetOptions = ['auto_redirect', 'requested_for_id', 'requested_for_display'];\n\tif (localInput && localInput.action == \"from_attachment\")\n\t\treturn;\n\n\tif (localInput && localInput.action == 'init_item') {\n\t\tdata._generatedItemGUID = gs.generateGUID();\n\t\treturn;\n\t}\n\telse if (localInput && localInput.action === \"order_one_step\") {\n\n\t}\n\telse if (localInput && localInput.action === \"order_item\") {\n\t\t//Minimum set of widget options supported for Embedded widget\n\t\tembeddedWidgetOptions.forEach(function (embeddedWidgetOption) {\n\t\t\tif (typeof localInput[embeddedWidgetOption] != 'undefined')\n\t\t\t\toptions[embeddedWidgetOption] = localInput[embeddedWidgetOption];\n\t\t});\n\t\tdata.orderItemModal = $sp.getWidget('widget-modal', {\n\t\t\tembeddedWidgetId: 'sc-checkout', \n\t\t\tembeddedWidgetOptions: {\n\t\t\t\tcart: {name: localInput.cart}, \n\t\t\t\taction: 'order_now', \n\t\t\t\titem: localInput.itemDetails, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequested_for: {id:options.requested_for_id, displayValue:options.requested_for_display},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauto_redirect: options.auto_redirect,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tparentParams: localInput.workspaceParams\n\t\t\t}, \n\t\t\tbackdrop: 'static', \n\t\t\tkeyboard: false, \n\t\t\tsize: 'md'\n\t\t});\n\t\treturn;\n\t} else if (localInput && localInput.action == \"order_wishlist_item\") {\n\t\t//Minimum set of widget options supported for Embedded widget\n\t\tembeddedWidgetOptions.forEach(function (embeddedWidgetOption) {\n\t\t\tif (typeof localInput[embeddedWidgetOption] != 'undefined')\n\t\t\t\toptions[embeddedWidgetOption] = localInput[embeddedWidgetOption];\n\t\t});\n\t\tdata.orderItemModal = $sp.getWidget('widget-modal', {\n\t\t\tembeddedWidgetId: 'sc-checkout', \n\t\t\tembeddedWidgetOptions: {\n\t\t\t\tcart: {name: localInput.cart}, \n\t\t\t\taction: 'order_now_wishlisted_item', \n\t\t\t\titem: localInput.itemDetails, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequested_for: {id:options.requested_for_id, displayValue:options.requested_for_display},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauto_redirect: options.auto_redirect,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tparentParams: localInput.workspaceParams\n\t\t\t}, \n\t\t\tbackdrop: 'static', \n\t\t\tkeyboard: false, \n\t\t\tsize: 'md'\n\t\t});\n\t\treturn;\n\t} else if (localInput && localInput.action === 'log_request') {\n\t\t $sp.logStat('Cat Item Request', localInput.itemDetails.sys_class_name, localInput.itemDetails.sys_id, localInput.itemDetails.name, $sp.getPortalRecord().getUniqueValue());\n\t\t return;\n\t}\n\t// portal can specify a catalog and catalog category home page\n\tvar catalogID = $sp.getParameter(\"catalog_id\") ? $sp.getParameter(\"catalog_id\") + \"\" : \"-1\";\n\tdata.sc_catalog_page = $sp.getDisplayValue(\"sc_catalog_page\") || \"sc_home\";\n\tdata.sc_category_page = $sp.getDisplayValue(\"sc_category_page\") || \"sc_category\";\n\tvar edit_parm = $sp.getParameter('edit');\n\tdata.is_cart_item = edit_parm == 'cart';\n\tdata.is_wishlist_item = edit_parm == 'wishlist';\n\tdata.show_wishlist_msg = false;\n\tdata.recordFound = true;\n\toptions.show_add_cart_button = (options.show_add_cart_button == \"true\");\n\tvar clGenerator = new GlideChoiceList();\n\tvar choiceListQuantity = clGenerator.getChoiceList(\"sc_cart_item\", \"quantity\");\n\tvar choicelistQuantityData = [];\n\tfor (var i = 0; i < choiceListQuantity.size(); i++) {\n\t\tvar choice = choiceListQuantity.get(i);\n\t\tif (!isNaN(choice.getValue()))\n\t\t\tchoicelistQuantityData.push({value : parseInt(choice.getValue()), label : choice.getLabel()});\n\t}\n\tdata.choiceListQuantity = choicelistQuantityData;\n\tdata.quantity = choicelistQuantityData[0].value;\n\tif (options.page) {\n\t\tvar pageGR = new GlideRecord(\"sp_page\");\n\t\toptions.page = (pageGR.get(options.page)) ? pageGR.getValue(\"id\") : null;\n\t}\n\tif (options.table) {\n\t\tvar tableGR = new GlideRecord(\"sys_db_object\");\n\t\toptions.table = (tableGR.get(options.table)) ? tableGR.getValue(\"name\") : null;\n\t}\n\toptions.url = options.url || \"id={page}&is_new_order=true&table={table}&sys_id={sys_id}\";\n\t\n\tdata.showPrices = $sp.showCatalogPrices();\n\tvar m = data.msgs = {};\n\tm.submitMsg = gs.getMessage(\"Submit\");\n\tm.requestMsg = gs.getMessage(\"Request\");\n\tm.orderNowMsg = gs.getMessage(\"Order Now\");\n\tm.submittedMsg = gs.getMessage(\"Submitted\");\n\tm.submittingMsg = gs.getMessage(\"Submitting\");\n\tm.createdMsg = gs.getMessage(\"Created\");\n\tm.trackMsg = gs.getMessage(\"track using 'Requests' in the header or\");\n\tm.clickMsg = gs.getMessage(\"click here to view\");\n\tm.dialogTitle = gs.getMessage(\"Delete Attachment\");\n\tm.dialogMessage = gs.getMessage(\"Are you sure?\");\n\tm.dialogOK = gs.getMessage(\"OK\");\n\tm.dialogCancel = gs.getMessage(\"Cancel\");\n\tm.addToCart = gs.getMessage(\"Add to Cart\");\n\tm.updateCart = gs.getMessage(\"Update Cart\");\n\t\n\tm.renameSuccessMsg = gs.getMessage(\"Attachment renamed successfully\");\n\tm.deleteSuccessMsg = gs.getMessage(\"Attachment deleted successfully\");\n\tm.wishlistMsg = gs.getMessage('Wish List');\n\tm.cartMsg = gs.getMessage('Cart');\n\tm.itemWishlistMsg = gs.getMessage('This item is already in your Wish List. If you attempt to add this item to your Wish List it will overwrite the existing item.');\n\tm.invalidRecordMsg = gs.getMessage('You are either not authorized or record is not valid.');\n\tm.wishlistUpdateMsg = gs.getMessage('Your Wish List has been updated.');\n\tm.wishlistAddMsg = gs.getMessage('Your item has been added to your Wish List.');\n\tm.cartAddMsg = gs.getMessage('Your item has been added to your Cart. To make changes to the items in your cart, click ');\n\tm.viewWishListMsg = gs.getMessage('View Wish List');\n\tm.viewCartMsg = gs.getMessage('View Cart');\n\tm.delete_attachment = gs.getMessage(\"Delete Attachment?\");\n\tm.regexError = gs.getMessage(\"Item with invalid variable can't be saved\");\n\tm.requestSubmitted = gs.getMessage(\"Thank you, your request has been submitted.\");\n\tdata.maxAttachmentSize = parseInt(gs.getProperty(\"com.glide.attachment.max_size\", 1024));\n\tif (isNaN(data.maxAttachmentSize))\n\t\tdata.maxAttachmentSize = 24;\n\tm.largeAttachmentMsg = gs.getMessage(\"Attached files must be smaller than {0} - please try again\", \"\" + data.maxAttachmentSize + \"MB\");\n\t\n\tm.notForMobileMsg = gs.getMessage('Not viewable in mobile');\n\t\n\t// var cartName = data.is_cart_item ? 'DEFAULT' : 'saved_items';\n\tvar cartName = 'draft_0374f689db63951c1814586dd39619c2';\n\tvar cart = new sn_sc.CartJS(cartName);\n\t\n\tif (edit_parm) {\n\t\tvar cart_item_id = $sp.getParameter(\"sys_id\");\n\t\tvar gr = new GlideRecord(\"sc_cart_item\");\n\t\tif (!gr.get(cart_item_id) || /* gr.cart != cart.getCartID() || */\n\t\t\t\t(!new sn_sc.CatItem(gr.getValue('cat_item')).canView())) {\n\t\t\tdata.recordFound = false;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tdata.showWishlist = data.is_wishlist_item;\n\t\tvar catItemData = {};\n\t\tcatItemData.sys_id = gr.getValue('cat_item');\n\t\tcatItemData.cart_item_id = gr.getUniqueValue();\n\t\tcatItemData.table = \"sc_cart_item\";\n\t\tcatItemData.is_ordering = true;\n\t\tdata.sc_cat_item = $sp.getCatalogItem(catItemData);\n\t\tdata.sc_cat_item.isCartItem = true;\n\t\tdata.sc_cat_item.cart_guide = gr.getValue('order_guide');\n\t\tdata.hideDeliveryTime = data.sc_cat_item.no_delivery_time;\n\t\tif (!data.hideDeliveryTime)\n\t\tdata.hideDeliveryTime = (options.hide_delivery_time == \"true\" || data.sc_cat_item.sys_class_name == 'sc_cat_item_producer' || data.sc_cat_item.sys_class_name == 'sc_cat_item_guide' || data.sc_cat_item.sys_class_name == 'std_change_record_producer');\n\n\t\tvar values = getValues(cart_item_id);\n\t\tfor(var f in data.sc_cat_item._fields) {\n\t\t\t// Put the values into the cat item fields\n\t\t\tvar field = data.sc_cat_item._fields[f];\n\t\t\tif (typeof values[f] != \"undefined\" && typeof values[f].value != \"undefined\") {\n\t\t\t\tif (values[f].type == 9 || values[f].type == 10)\n\t\t\t\t\tfield.value = values[f].displayValue;\n\t\t\t\telse if (values[f].type == 25)\n\t\t\t\t\tfield.value = values[f].decrypted_value;\n\t\t\t\telse\n\t\t\t\t\tfield.value = values[f].value;\n\t\t\t\tfield.displayValue = values[f].displayValue;\n\t\t\t\tfield.display_value_list = values[f].display_value_list;\n\t\t\t}\n\t\t\tupdatePriceOnField(field);\n\t\t\t\t\n\t\t}\n\t\tdata._generatedItemGUID = cart_item_id;\n\t\tdata.quantity = '' + gr.quantity;\n\t} else {\n\t\tif (localInput)\n\t\t\tdata.sys_id = localInput.sys_id;\n\t\telse if (options.sys_id)\n\t\t\tdata.sys_id = options.sys_id;\n\t\telse\n\t\t\tdata.sys_id = $sp.getParameter(\"sys_id\") || $sp.getParameter('sl_sys_id');\n\t\n\t\tif (!data.sys_id) {\n\t\t\tdata.recordFound = false;\n\t\t\treturn;\n\t\t}\n\t\n\t\tdata._generatedItemGUID = gs.generateGUID();\n\t\tvar validatedItem = new sn_sc.CatItem('' + data.sys_id);\n\t\tif (!validatedItem.canView() || !validatedItem.isVisibleServicePortal()) {\n\t\t\tdata.recordFound = false;\n\t\t\treturn;\n\t\t}\n\t\n\t\tdata.sc_cat_item = $sp.getCatalogItem({\n\t\t\tsys_id: data.sys_id + '',\n\t\t\tis_ordering: true\n\t\t});\n\t\t\n\t\tvar catRec = new GlideRecord('sc_cat_item');\n\t\tif (catRec.get(data.sys_id)) {\n\t\t\tdata.sc_cat_item.custom_url = catRec.getValue('u_custom_redirect_link');\n\t\t}\n\t\t\n\t\tif (options.native_mobile == 'true') {\n\t\t\t\tif (data.sc_cat_item.sys_class_name == 'std_change_record_producer' ||\n\t\t\t\t\t\tdata.sc_cat_item.sys_class_name == 'sc_cat_item_content' ||\n\t\t\t\t\t  data.sc_cat_item.sys_class_name == 'sc_cat_item_producer_service') {\n\t\t\t\t\tdata.not_for_mobile = true;\n\t\t\t\t\tdata.sc_cat_item = {};\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t}\n\t\t\n\t\tdata.hideDeliveryTime = data.sc_cat_item.no_delivery_time;\n\t\tif (!data.hideDeliveryTime) \n\t\tdata.hideDeliveryTime = (options.hide_delivery_time == \"true\" || data.sc_cat_item.sys_class_name == 'sc_cat_item_producer' || data.sc_cat_item.sys_class_name == 'sc_cat_item_guide' || data.sc_cat_item.sys_class_name == 'std_change_record_producer');\n\n\t\tif (data.sc_cat_item.category) {\n\t\t\tvar categoryJS;\n\t\t\tvar categoryID = validatedItem.getFirstAccessibleCategoryForSearch((catalogID && catalogID != \"-1\") ? catalogID : $sp.getCatalogs().value + \"\");\n\t\t\tif (GlideStringUtil.isEligibleSysID($sp.getParameter(\"sysparm_category\"))) {\n\t\t\t\tcategoryJS = new sn_sc.CatCategory($sp.getParameter(\"sysparm_category\") + \"\");\n\t\t\t\tcategoryID = $sp.getParameter(\"sysparm_category\") + \"\";\n\t\t\t}\n\t\t\telse if(categoryID) {\n\t\t\t\tcategoryJS = new sn_sc.CatCategory(categoryID);\n\t\t\t}\n\t\t\tif (categoryJS && GlideStringUtil.isEligibleSysID(categoryJS.getID())) {\n\t\t\t\tif (categoryJS.getCatalog()) {\n\t\t\t\t\tcatalogID = categoryJS.getCatalog();\n\t\t\t\t\tdata.catalog_id = catalogID;\n\t\t\t\t\tvar catalogObj = new sn_sc.Catalog(catalogID);\n\t\t\t\t\tdata.sc_catalog = catalogObj.getTitle();\n\t\t\t\t\tdata.showWishlist = new sn_sc.Catalog('' + catalogID).isWishlistEnabled();\n\t\t\t\t}\n\t\t\t\tdata.category = {\n\t\t\t\t\tname: categoryJS.getTitle(),\n\t\t\t\t\turl: '?id=' + data.sc_category_page + '&sys_id=' + categoryID\n\t\t\t\t}\n\t\t\t\tdata.categories = [];\n\t\t\t\tdata.categories.push({\n\t\t\t\t\tlabel: categoryJS.getTitle(),\n\t\t\t\t\turl: '?id=' + data.sc_category_page + '&sys_id=' + categoryID\n\t\t\t\t});\n\t\t\t\twhile(categoryJS.getParent()) {\n\t\t\t\t\tvar parentId =  categoryJS.getParent();\n\t\t\t\t\tcategoryJS = new sn_sc.CatCategory(parentId);\n\t\t\t\t\tvar category = {\n\t\t\t\t\t\tlabel: categoryJS.getTitle(),\n\t\t\t\t\t\turl: '?id=' + data.sc_category_page + '&sys_id=' + parentId\n\t\t\t\t\t};\n\t\t\t\t\tdata.categories.unshift(category);\n\t\t\t\t}\n\t\t\t\tif ((($sp.getCatalogs().value + \"\").split(\",\")).length > 1) {\n\t\t\t\t\tdata.all_catalog_msg = gs.getMessage(\"All Catalogs\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar gr = new GlideRecord('sc_cart_item');\n\t\tgr.addQuery('cart', cart.getCartID());\n\t\tgr.addQuery('cat_item', data.sys_id);\n\t\tgr.query();\n\t\tif (gr.next() && !options.isServiceWorkspace)\n\t\t\tdata.show_wishlist_msg = true;\n\t}\n\n\tdata.sys_properties = {\n\t\ttwostep: gs.getProperty(\"glide.sc.sp.twostep\", \"true\") == 'true',\n\t\tmobileNativeColor: gs.getProperty(\"glide.sc.mobile.primary_color\", \"#1f8476\"),\n\t\tcartEnabled: gs.getProperty(\"glide.sc.cart.enabled\", \"false\") == \"true\"\n\t};\n\t\n\tvar className = data.sc_cat_item.sys_class_name;\n\tdata.can_create_cart_item = canCreateCartItem(className) && !gs.hasRole('snc_read_only');\n\t\n\tfunction canCreateCartItem(className) {\n\t\tvar cart_item = true;\n\t\tvar list_of_class_names = gs.getProperty('glide.sc.item.not_normal_cart_item', '').split(',');\n\t\tfor (var i = 0; i < list_of_class_names.length; i++) {\n\t\t\t\tif (className != 'sc_cat_item_producer' && className != 'std_change_record_producer' && className != 'sc_cat_item_producer_service' && className == 'sc_cat_item_content' && list_of_class_names[i] == className)\n\t\t\t\t\tcart_item = false;\n\t\t}\n\t\treturn cart_item;\n\t}\n\n\tvar athTblName = 'sc_cart_item';\n\tif (!new global.CatalogItemTypeProcessor().canCreateNormalCartItem(className)) {\n\t\tif (className == 'sc_cat_item_producer' || className == 'std_change_record_producer') {\n\t\t\t\tvar gr = new GlideRecord(className);\n\t\t\t\tgr.get(data.sc_cat_item.sys_id);\n\t\t\t\tif (gr.isValidRecord())\n\t\t\t\t\tathTblName = gr.getValue('table_name');\n\t\t}\n\t}\n\t\n\tdata._attachmentTable = athTblName;\n\tdata.stdChg = {};\n\tif (className === 'std_change_record_producer') {\n\t\t//Populate scope with the porperty for two step\n\t\tdata.stdChg.twoStep = false;\n\t\tvar twoStepProp = new global.StdChangeUtils().getValue('two_step') + '';\n\t\tif (twoStepProp)\n\t\t\tdata.stdChg.twoStep = twoStepProp === '1';\n\t\tvar stdChgProducerGr = new GlideRecord('std_change_record_producer');\n\t\tstdChgProducerGr.get(data.sc_cat_item.sys_id);\n\t\tif (stdChgProducerGr.isValidRecord())\n\t\t\tdata.stdChg.currentVersion = stdChgProducerGr.getValue('current_version');\n\t}\n\n\tif (data.sc_cat_item.sys_class_name !== 'sc_cat_item_content')\n\t\t$sp.logStat('Cat Item View', data.sc_cat_item.sys_class_name, data.sc_cat_item.sys_id, data.sc_cat_item.name, $sp.getPortalRecord().getUniqueValue());\n\t\n\n\n\t\n\tfunction getValues(sys_id) {\n\t\tvar qs = new sn_sc.VariablePoolQuestionSetJS();\n\t\tqs.setCartID(sys_id);\n\t\tqs.load();\n\t\tvar values = {};\n\t\tvar questions = qs.getFlatQuestions();\n\t\tfor (var i = 0; i < questions.length; i++) {\n\t\t\tvar qKey = questions[i].name;\n\t\t\tif (typeof qKey == 'undefined' || qKey == '')\n\t\t\t\tqKey = \"IO:\" + questions[i].sys_id;\n\t\t\tvalues[qKey] = questions[i];\n\t\t}\n\t\treturn values;\n\t}\n\tfunction setPrice(field, p, rp) {\n\t\tif (p != undefined)\n\t\t\tfield.price = p;\n\t\tif (rp != undefined)\n\t\t\tfield.recurring_price = rp;\n\t}\n\tfunction updatePriceForReferenceTable(field) {\n\t\tvar tableName = field.refTable + '';\n\t\tif (tableName != undefined && tableName != null && tableName != '') {\n\t\t\tvar gr = new GlideRecord(tableName);\n\t\t\tif (gr.isValid()) {\n\t\t\t\tif (gr.get(field.value) && gr.isValidRecord()) {\n\t\t\t\t\tupdatePrice(gr, field);\n\t\t\t\t\tupdateRecurringPrice(gr, field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction updatePriceForListCollector(field) {\n\t\tvar tableName = field.refTable + '';\n\t\tif (tableName != undefined && tableName != null && tableName != '') {\n\t\t\tvar gr = new GlideRecord(tableName);\n\t\t\tif (gr.isValid()) {\n\t\t\t\tvar values = field.value.split(',');\n\t\t\t\tgr.addQuery('sys_id', values);\n\t\t\t\tgr.query();\n\t\t\t\tvar p = 0.0;\n\t\t\t\tvar rp = 0.0;\n\t\t\t\tvar price_value_list = [];\n\t\t\t\twhile(gr.next()) {\n\t\t\t\t\t\tvar price_field = {};\n\t\t\t\t\t\tupdatePrice(gr, price_field);\n\t\t\t\t\t\tupdateRecurringPrice(gr, price_field);\n\t\t\t\t\t\tif (price_field.price)\n\t\t\t\t\t\t\tp += Number(price_field.price);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tprice_field.price = 0.0;\n\t\t\t\t\t\tif (price_field.recurring_price)\n\t\t\t\t\t\t\trp += Number(price_field.recurring_price);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tprice_field.recurring_price = 0.0;\n\t\t\t\t\t\tprice_value_list.push(price_field);\n\t\t\t\t}\n\t\t\t\tfield.price = p;\n\t\t\t\tfield.recurring_price = rp;\n\t\t\t\tfield.price_value_list = price_value_list;\n\t\t\t}\n\t\t}\n\t}\n\tfunction updatePrice(gr, field) {\n\t\tif (gr.isValidField('price'))\n\t\t\tfield.price = gr.getValue('price');\n\t\telse if (gr.isValidField('u_price'))\n\t\t\tfield.price = gr.getValue('u_price');\n\t}\n\tfunction updateRecurringPrice(gr, field) {\n\t\tif (gr.isValidField('recurring_price'))\n\t\t\tfield.recurring_price = gr.getValue('recurring_price');\n\t\telse if (gr.isValidField('u_recurring_price'))\n\t\t\tfield.recurring_price = gr.getValue('u_recurring_price');\n\t}\n\tfunction updatePriceOnField(field) {\n\t\tif (field.type == 'boolean' || field.type == 'boolean_confirm') {\n\t\t\tif (field.value == 'true' || field.value == true)\n\t\t\t\tsetPrice(field, field._pricing.price_if_checked, field._pricing.recurring_price_if_checked);\n\t\t\telse\n\t\t\t\tsetPrice(field, 0, 0);\n\t\t} else if (field.choices) {\n\t\t\tfield.choices.forEach( function(choice) {\n\t\t\t\tif (choice.value +'' == field.value + '')\n\t\t\t\t\t setPrice(field, choice.price, choice.recurring_price);\n\t\t\t});\n\t\t} else if (field._pricing && field._pricing.pricing_implications === true) {\n\t\t\tif (field.type == 'reference') \n\t\t\t\tupdatePriceForReferenceTable(field);\n\t\t\telse if (field.type == 'glide_list')\n\t\t\t\tupdatePriceForListCollector(field);\n\t\t}\n\t}\n})()",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "// populate the 'data' variable with catalog item, variables, and variable view\n(function() {\n\tvar localInput = input; //to safeguard pullution of \"input\" via BR or other scripts\n\n\tvar draftID = $sp.getParameter(\"draft_id\");\n\tdata.draft_id = draftID;\n\t\n\tvar embeddedWidgetOptions = ['auto_redirect', 'requested_for_id', 'requested_for_display'];\n\tif (localInput && localInput.action == \"from_attachment\")\n\t\treturn;\n\n\tif (localInput && localInput.action == 'init_item') {\n\t\tdata._generatedItemGUID = gs.generateGUID();\n\t\treturn;\n\t}\n\telse if (localInput && localInput.action === \"order_one_step\") {\n\n\t}\n\telse if (localInput && localInput.action === \"order_item\") {\n\t\t//Minimum set of widget options supported for Embedded widget\n\t\tembeddedWidgetOptions.forEach(function (embeddedWidgetOption) {\n\t\t\tif (typeof localInput[embeddedWidgetOption] != 'undefined')\n\t\t\t\toptions[embeddedWidgetOption] = localInput[embeddedWidgetOption];\n\t\t});\n\t\tdata.orderItemModal = $sp.getWidget('widget-modal', {\n\t\t\tembeddedWidgetId: 'sc-checkout', \n\t\t\tembeddedWidgetOptions: {\n\t\t\t\tcart: {name: localInput.cart}, \n\t\t\t\taction: 'order_now', \n\t\t\t\titem: localInput.itemDetails, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequested_for: {id:options.requested_for_id, displayValue:options.requested_for_display},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauto_redirect: options.auto_redirect,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tparentParams: localInput.workspaceParams\n\t\t\t}, \n\t\t\tbackdrop: 'static', \n\t\t\tkeyboard: false, \n\t\t\tsize: 'md'\n\t\t});\n\t\treturn;\n\t} else if (localInput && localInput.action == \"order_wishlist_item\") {\n\t\t//Minimum set of widget options supported for Embedded widget\n\t\tembeddedWidgetOptions.forEach(function (embeddedWidgetOption) {\n\t\t\tif (typeof localInput[embeddedWidgetOption] != 'undefined')\n\t\t\t\toptions[embeddedWidgetOption] = localInput[embeddedWidgetOption];\n\t\t});\n\t\tdata.orderItemModal = $sp.getWidget('widget-modal', {\n\t\t\tembeddedWidgetId: 'sc-checkout', \n\t\t\tembeddedWidgetOptions: {\n\t\t\t\tcart: {name: localInput.cart}, \n\t\t\t\taction: 'order_now_wishlisted_item', \n\t\t\t\titem: localInput.itemDetails, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequested_for: {id:options.requested_for_id, displayValue:options.requested_for_display},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauto_redirect: options.auto_redirect,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tparentParams: localInput.workspaceParams\n\t\t\t}, \n\t\t\tbackdrop: 'static', \n\t\t\tkeyboard: false, \n\t\t\tsize: 'md'\n\t\t});\n\t\treturn;\n\t} else if (localInput && localInput.action === 'log_request') {\n\t\t $sp.logStat('Cat Item Request', localInput.itemDetails.sys_class_name, localInput.itemDetails.sys_id, localInput.itemDetails.name, $sp.getPortalRecord().getUniqueValue());\n\t\t return;\n\t}\n\t// portal can specify a catalog and catalog category home page\n\tvar catalogID = $sp.getParameter(\"catalog_id\") ? $sp.getParameter(\"catalog_id\") + \"\" : \"-1\";\n\tdata.sc_catalog_page = $sp.getDisplayValue(\"sc_catalog_page\") || \"sc_home\";\n\tdata.sc_category_page = $sp.getDisplayValue(\"sc_category_page\") || \"sc_category\";\n\tvar edit_parm = $sp.getParameter('edit');\n\tdata.is_cart_item = edit_parm == 'cart';\n\tdata.is_wishlist_item = edit_parm == 'wishlist';\n\tdata.show_wishlist_msg = false;\n\tdata.recordFound = true;\n\toptions.show_add_cart_button = (options.show_add_cart_button == \"true\");\n\tvar clGenerator = new GlideChoiceList();\n\tvar choiceListQuantity = clGenerator.getChoiceList(\"sc_cart_item\", \"quantity\");\n\tvar choicelistQuantityData = [];\n\tfor (var i = 0; i < choiceListQuantity.size(); i++) {\n\t\tvar choice = choiceListQuantity.get(i);\n\t\tif (!isNaN(choice.getValue()))\n\t\t\tchoicelistQuantityData.push({value : parseInt(choice.getValue()), label : choice.getLabel()});\n\t}\n\tdata.choiceListQuantity = choicelistQuantityData;\n\tdata.quantity = choicelistQuantityData[0].value;\n\tif (options.page) {\n\t\tvar pageGR = new GlideRecord(\"sp_page\");\n\t\toptions.page = (pageGR.get(options.page)) ? pageGR.getValue(\"id\") : null;\n\t}\n\tif (options.table) {\n\t\tvar tableGR = new GlideRecord(\"sys_db_object\");\n\t\toptions.table = (tableGR.get(options.table)) ? tableGR.getValue(\"name\") : null;\n\t}\n\toptions.url = options.url || \"id={page}&is_new_order=true&table={table}&sys_id={sys_id}\";\n\t\n\tdata.showPrices = $sp.showCatalogPrices();\n\tvar m = data.msgs = {};\n\tm.submitMsg = gs.getMessage(\"Submit\");\n\tm.requestMsg = gs.getMessage(\"Request\");\n\tm.orderNowMsg = gs.getMessage(\"Order Now\");\n\tm.submittedMsg = gs.getMessage(\"Submitted\");\n\tm.submittingMsg = gs.getMessage(\"Submitting\");\n\tm.createdMsg = gs.getMessage(\"Created\");\n\tm.trackMsg = gs.getMessage(\"track using 'Requests' in the header or\");\n\tm.clickMsg = gs.getMessage(\"click here to view\");\n\tm.dialogTitle = gs.getMessage(\"Delete Attachment\");\n\tm.dialogMessage = gs.getMessage(\"Are you sure?\");\n\tm.dialogOK = gs.getMessage(\"OK\");\n\tm.dialogCancel = gs.getMessage(\"Cancel\");\n\tm.addToCart = gs.getMessage(\"Add to Cart\");\n\tm.updateCart = gs.getMessage(\"Update Cart\");\n\t\n\tm.renameSuccessMsg = gs.getMessage(\"Attachment renamed successfully\");\n\tm.deleteSuccessMsg = gs.getMessage(\"Attachment deleted successfully\");\n\tm.wishlistMsg = gs.getMessage('Wish List');\n\tm.cartMsg = gs.getMessage('Cart');\n\tm.itemWishlistMsg = gs.getMessage('This item is already in your Wish List. If you attempt to add this item to your Wish List it will overwrite the existing item.');\n\tm.invalidRecordMsg = gs.getMessage('You are either not authorized or record is not valid.');\n\tm.wishlistUpdateMsg = gs.getMessage('Your Wish List has been updated.');\n\tm.wishlistAddMsg = gs.getMessage('Your item has been added to your Wish List.');\n\tm.cartAddMsg = gs.getMessage('Your item has been added to your Cart. To make changes to the items in your cart, click ');\n\tm.viewWishListMsg = gs.getMessage('View Wish List');\n\tm.viewCartMsg = gs.getMessage('View Cart');\n\tm.delete_attachment = gs.getMessage(\"Delete Attachment?\");\n\tm.regexError = gs.getMessage(\"Item with invalid variable can't be saved\");\n\tm.requestSubmitted = gs.getMessage(\"Thank you, your request has been submitted.\");\n\tdata.maxAttachmentSize = parseInt(gs.getProperty(\"com.glide.attachment.max_size\", 1024));\n\tif (isNaN(data.maxAttachmentSize))\n\t\tdata.maxAttachmentSize = 24;\n\tm.largeAttachmentMsg = gs.getMessage(\"Attached files must be smaller than {0} - please try again\", \"\" + data.maxAttachmentSize + \"MB\");\n\t\n\tm.notForMobileMsg = gs.getMessage('Not viewable in mobile');\n\t\n\t// var cartName = data.is_cart_item ? 'DEFAULT' : 'saved_items';\n\tvar cartName = 'draft_0374f689db63951c1814586dd39619c2';\n\tvar cart = new sn_sc.CartJS(cartName);\n\t\n\tif (edit_parm) {\n\t\tvar cart_item_id = $sp.getParameter(\"sys_id\");\n\t\tvar gr = new GlideRecord(\"sc_cart_item\");\n\t\tif (!gr.get(cart_item_id) || /* gr.cart != cart.getCartID() || */\n\t\t\t\t(!new sn_sc.CatItem(gr.getValue('cat_item')).canView())) {\n\t\t\tdata.recordFound = false;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tdata.showWishlist = data.is_wishlist_item;\n\t\tvar catItemData = {};\n\t\tcatItemData.sys_id = gr.getValue('cat_item');\n\t\tcatItemData.cart_item_id = gr.getUniqueValue();\n\t\tcatItemData.table = \"sc_cart_item\";\n\t\tcatItemData.is_ordering = true;\n\t\tdata.sc_cat_item = $sp.getCatalogItem(catItemData);\n\t\tdata.sc_cat_item.isCartItem = true;\n\t\tdata.sc_cat_item.cart_guide = gr.getValue('order_guide');\n\t\tdata.hideDeliveryTime = data.sc_cat_item.no_delivery_time;\n\t\tif (!data.hideDeliveryTime)\n\t\tdata.hideDeliveryTime = (options.hide_delivery_time == \"true\" || data.sc_cat_item.sys_class_name == 'sc_cat_item_producer' || data.sc_cat_item.sys_class_name == 'sc_cat_item_guide' || data.sc_cat_item.sys_class_name == 'std_change_record_producer');\n\n\t\tvar values = getValues(cart_item_id);\n\t\tfor(var f in data.sc_cat_item._fields) {\n\t\t\t// Put the values into the cat item fields\n\t\t\tvar field = data.sc_cat_item._fields[f];\n\t\t\tif (typeof values[f] != \"undefined\" && typeof values[f].value != \"undefined\") {\n\t\t\t\tif (values[f].type == 9 || values[f].type == 10)\n\t\t\t\t\tfield.value = values[f].displayValue;\n\t\t\t\telse if (values[f].type == 25)\n\t\t\t\t\tfield.value = values[f].decrypted_value;\n\t\t\t\telse\n\t\t\t\t\tfield.value = values[f].value;\n\t\t\t\tfield.displayValue = values[f].displayValue;\n\t\t\t\tfield.display_value_list = values[f].display_value_list;\n\t\t\t}\n\t\t\tupdatePriceOnField(field);\n\t\t\t\t\n\t\t}\n\t\tdata._generatedItemGUID = cart_item_id;\n\t\tdata.quantity = '' + gr.quantity;\n\t} else {\n\t\tif (localInput)\n\t\t\tdata.sys_id = localInput.sys_id;\n\t\telse if (options.sys_id)\n\t\t\tdata.sys_id = options.sys_id;\n\t\telse\n\t\t\tdata.sys_id = $sp.getParameter(\"sys_id\") || $sp.getParameter('sl_sys_id');\n\t\n\t\tif (!data.sys_id) {\n\t\t\tdata.recordFound = false;\n\t\t\treturn;\n\t\t}\n\t\n\t\tdata._generatedItemGUID = gs.generateGUID();\n\t\tvar validatedItem = new sn_sc.CatItem('' + data.sys_id);\n\t\tif (!validatedItem.canView() || !validatedItem.isVisibleServicePortal()) {\n\t\t\tdata.recordFound = false;\n\t\t\treturn;\n\t\t}\n\t\n\t\tdata.sc_cat_item = $sp.getCatalogItem({\n\t\t\tsys_id: data.sys_id + '',\n\t\t\tis_ordering: true\n\t\t});\n\t\t\n\t\tvar catRec = new GlideRecord('sc_cat_item');\n\t\tif (catRec.get(data.sys_id)) {\n\t\t\tdata.sc_cat_item.custom_url = catRec.getValue('u_custom_redirect_link');\n\t\t}\n\t\t\n\t\tif (options.native_mobile == 'true') {\n\t\t\t\tif (data.sc_cat_item.sys_class_name == 'std_change_record_producer' ||\n\t\t\t\t\t\tdata.sc_cat_item.sys_class_name == 'sc_cat_item_content' ||\n\t\t\t\t\t  data.sc_cat_item.sys_class_name == 'sc_cat_item_producer_service') {\n\t\t\t\t\tdata.not_for_mobile = true;\n\t\t\t\t\tdata.sc_cat_item = {};\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t}\n\t\t\n\t\tdata.hideDeliveryTime = data.sc_cat_item.no_delivery_time;\n\t\tif (!data.hideDeliveryTime) \n\t\tdata.hideDeliveryTime = (options.hide_delivery_time == \"true\" || data.sc_cat_item.sys_class_name == 'sc_cat_item_producer' || data.sc_cat_item.sys_class_name == 'sc_cat_item_guide' || data.sc_cat_item.sys_class_name == 'std_change_record_producer');\n\n\t\tif (data.sc_cat_item.category) {\n\t\t\tvar categoryJS;\n\t\t\tvar categoryID = validatedItem.getFirstAccessibleCategoryForSearch((catalogID && catalogID != \"-1\") ? catalogID : $sp.getCatalogs().value + \"\");\n\t\t\tif (GlideStringUtil.isEligibleSysID($sp.getParameter(\"sysparm_category\"))) {\n\t\t\t\tcategoryJS = new sn_sc.CatCategory($sp.getParameter(\"sysparm_category\") + \"\");\n\t\t\t\tcategoryID = $sp.getParameter(\"sysparm_category\") + \"\";\n\t\t\t}\n\t\t\telse if(categoryID) {\n\t\t\t\tcategoryJS = new sn_sc.CatCategory(categoryID);\n\t\t\t}\n\t\t\tif (categoryJS && GlideStringUtil.isEligibleSysID(categoryJS.getID())) {\n\t\t\t\tif (categoryJS.getCatalog()) {\n\t\t\t\t\tcatalogID = categoryJS.getCatalog();\n\t\t\t\t\tdata.catalog_id = catalogID;\n\t\t\t\t\tvar catalogObj = new sn_sc.Catalog(catalogID);\n\t\t\t\t\tdata.sc_catalog = catalogObj.getTitle();\n\t\t\t\t\tdata.showWishlist = new sn_sc.Catalog('' + catalogID).isWishlistEnabled();\n\t\t\t\t}\n\t\t\t\tdata.category = {\n\t\t\t\t\tname: categoryJS.getTitle(),\n\t\t\t\t\turl: '?id=' + data.sc_category_page + '&sys_id=' + categoryID\n\t\t\t\t}\n\t\t\t\tdata.categories = [];\n\t\t\t\tdata.categories.push({\n\t\t\t\t\tlabel: categoryJS.getTitle(),\n\t\t\t\t\turl: '?id=' + data.sc_category_page + '&sys_id=' + categoryID\n\t\t\t\t});\n\t\t\t\twhile(categoryJS.getParent()) {\n\t\t\t\t\tvar parentId =  categoryJS.getParent();\n\t\t\t\t\tcategoryJS = new sn_sc.CatCategory(parentId);\n\t\t\t\t\tvar category = {\n\t\t\t\t\t\tlabel: categoryJS.getTitle(),\n\t\t\t\t\t\turl: '?id=' + data.sc_category_page + '&sys_id=' + parentId\n\t\t\t\t\t};\n\t\t\t\t\tdata.categories.unshift(category);\n\t\t\t\t}\n\t\t\t\tif ((($sp.getCatalogs().value + \"\").split(\",\")).length > 1) {\n\t\t\t\t\tdata.all_catalog_msg = gs.getMessage(\"All Catalogs\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar gr = new GlideRecord('sc_cart_item');\n\t\tgr.addQuery('cart', cart.getCartID());\n\t\tgr.addQuery('cat_item', data.sys_id);\n\t\tgr.query();\n\t\tif (gr.next() && !options.isServiceWorkspace)\n\t\t\tdata.show_wishlist_msg = true;\n\t}\n\n\tdata.sys_properties = {\n\t\ttwostep: gs.getProperty(\"glide.sc.sp.twostep\", \"true\") == 'true',\n\t\tmobileNativeColor: gs.getProperty(\"glide.sc.mobile.primary_color\", \"#1f8476\"),\n\t\tcartEnabled: gs.getProperty(\"glide.sc.cart.enabled\", \"false\") == \"true\"\n\t};\n\t\n\tvar className = data.sc_cat_item.sys_class_name;\n\tdata.can_create_cart_item = canCreateCartItem(className) && !gs.hasRole('snc_read_only');\n\t\n\tfunction canCreateCartItem(className) {\n\t\tvar cart_item = true;\n\t\tvar list_of_class_names = gs.getProperty('glide.sc.item.not_normal_cart_item', '').split(',');\n\t\tfor (var i = 0; i < list_of_class_names.length; i++) {\n\t\t\t\tif (className != 'sc_cat_item_producer' && className != 'std_change_record_producer' && className != 'sc_cat_item_producer_service' && className == 'sc_cat_item_content' && list_of_class_names[i] == className)\n\t\t\t\t\tcart_item = false;\n\t\t}\n\t\treturn cart_item;\n\t}\n\n\tvar athTblName = 'sc_cart_item';\n\tif (!new global.CatalogItemTypeProcessor().canCreateNormalCartItem(className)) {\n\t\tif (className == 'sc_cat_item_producer' || className == 'std_change_record_producer') {\n\t\t\t\tvar gr = new GlideRecord(className);\n\t\t\t\tgr.get(data.sc_cat_item.sys_id);\n\t\t\t\tif (gr.isValidRecord())\n\t\t\t\t\tathTblName = gr.getValue('table_name');\n\t\t}\n\t}\n\t\n\tdata._attachmentTable = athTblName;\n\tdata.stdChg = {};\n\tif (className === 'std_change_record_producer') {\n\t\t//Populate scope with the porperty for two step\n\t\tdata.stdChg.twoStep = false;\n\t\tvar twoStepProp = new global.StdChangeUtils().getValue('two_step') + '';\n\t\tif (twoStepProp)\n\t\t\tdata.stdChg.twoStep = twoStepProp === '1';\n\t\tvar stdChgProducerGr = new GlideRecord('std_change_record_producer');\n\t\tstdChgProducerGr.get(data.sc_cat_item.sys_id);\n\t\tif (stdChgProducerGr.isValidRecord())\n\t\t\tdata.stdChg.currentVersion = stdChgProducerGr.getValue('current_version');\n\t}\n\n\tif (data.sc_cat_item.sys_class_name !== 'sc_cat_item_content')\n\t\t$sp.logStat('Cat Item View', data.sc_cat_item.sys_class_name, data.sc_cat_item.sys_id, data.sc_cat_item.name, $sp.getPortalRecord().getUniqueValue());\n\t\n\n\n\t\n\tfunction getValues(sys_id) {\n\t\tvar qs = new sn_sc.VariablePoolQuestionSetJS();\n\t\tqs.setCartID(sys_id);\n\t\tqs.load();\n\t\tvar values = {};\n\t\tvar questions = qs.getFlatQuestions();\n\t\tfor (var i = 0; i < questions.length; i++) {\n\t\t\tvar qKey = questions[i].name;\n\t\t\tif (typeof qKey == 'undefined' || qKey == '')\n\t\t\t\tqKey = \"IO:\" + questions[i].sys_id;\n\t\t\tvalues[qKey] = questions[i];\n\t\t}\n\t\treturn values;\n\t}\n\tfunction setPrice(field, p, rp) {\n\t\tif (p != undefined)\n\t\t\tfield.price = p;\n\t\tif (rp != undefined)\n\t\t\tfield.recurring_price = rp;\n\t}\n\tfunction updatePriceForReferenceTable(field) {\n\t\tvar tableName = field.refTable + '';\n\t\tif (tableName != undefined && tableName != null && tableName != '') {\n\t\t\tvar gr = new GlideRecord(tableName);\n\t\t\tif (gr.isValid()) {\n\t\t\t\tif (gr.get(field.value) && gr.isValidRecord()) {\n\t\t\t\t\tupdatePrice(gr, field);\n\t\t\t\t\tupdateRecurringPrice(gr, field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction updatePriceForListCollector(field) {\n\t\tvar tableName = field.refTable + '';\n\t\tif (tableName != undefined && tableName != null && tableName != '') {\n\t\t\tvar gr = new GlideRecord(tableName);\n\t\t\tif (gr.isValid()) {\n\t\t\t\tvar values = field.value.split(',');\n\t\t\t\tgr.addQuery('sys_id', values);\n\t\t\t\tgr.query();\n\t\t\t\tvar p = 0.0;\n\t\t\t\tvar rp = 0.0;\n\t\t\t\tvar price_value_list = [];\n\t\t\t\twhile(gr.next()) {\n\t\t\t\t\t\tvar price_field = {};\n\t\t\t\t\t\tupdatePrice(gr, price_field);\n\t\t\t\t\t\tupdateRecurringPrice(gr, price_field);\n\t\t\t\t\t\tif (price_field.price)\n\t\t\t\t\t\t\tp += Number(price_field.price);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tprice_field.price = 0.0;\n\t\t\t\t\t\tif (price_field.recurring_price)\n\t\t\t\t\t\t\trp += Number(price_field.recurring_price);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tprice_field.recurring_price = 0.0;\n\t\t\t\t\t\tprice_value_list.push(price_field);\n\t\t\t\t}\n\t\t\t\tfield.price = p;\n\t\t\t\tfield.recurring_price = rp;\n\t\t\t\tfield.price_value_list = price_value_list;\n\t\t\t}\n\t\t}\n\t}\n\tfunction updatePrice(gr, field) {\n\t\tif (gr.isValidField('price'))\n\t\t\tfield.price = gr.getValue('price');\n\t\telse if (gr.isValidField('u_price'))\n\t\t\tfield.price = gr.getValue('u_price');\n\t}\n\tfunction updateRecurringPrice(gr, field) {\n\t\tif (gr.isValidField('recurring_price'))\n\t\t\tfield.recurring_price = gr.getValue('recurring_price');\n\t\telse if (gr.isValidField('u_recurring_price'))\n\t\t\tfield.recurring_price = gr.getValue('u_recurring_price');\n\t}\n\tfunction updatePriceOnField(field) {\n\t\tif (field.type == 'boolean' || field.type == 'boolean_confirm') {\n\t\t\tif (field.value == 'true' || field.value == true)\n\t\t\t\tsetPrice(field, field._pricing.price_if_checked, field._pricing.recurring_price_if_checked);\n\t\t\telse\n\t\t\t\tsetPrice(field, 0, 0);\n\t\t} else if (field.choices) {\n\t\t\tfield.choices.forEach( function(choice) {\n\t\t\t\tif (choice.value +'' == field.value + '')\n\t\t\t\t\t setPrice(field, choice.price, choice.recurring_price);\n\t\t\t});\n\t\t} else if (field._pricing && field._pricing.pricing_implications === true) {\n\t\t\tif (field.type == 'reference') \n\t\t\t\tupdatePriceForReferenceTable(field);\n\t\t\telse if (field.type == 'glide_list')\n\t\t\t\tupdatePriceForListCollector(field);\n\t\t}\n\t}\n})()",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function ($scope, $http, spScUtil, spUtil, nowAttachmentHandler, $rootScope, $sanitize, $window, $sce, i18n, $timeout, $log, spAriaUtil, $document, spModal, $q, spAtf, $location, spAriaFocusManager, spSCNavStateManager, cabrillo) {\n\tvar c = this;\n\t\n\t//console.log('-------------' + JSON.stringify(c.data.sc_cat_item));\n\t\n\t//alert('customer link: ' + JSON.stringify(c.data.sc_cat_item));\n\t\n\tif (c.data.sc_cat_item && $scope.data.hasOwnProperty(\"_generatedItemGUID\")) {\n\t\tc.data.sc_cat_item._attachmentGUID = $scope.data._generatedItemGUID;\n\t}\n\n\t$scope.getFocus = function(field) {\n\t\tvar focusVar = (field.type == \"reference\") ? \"sp_formfield_reference_\" : \"sp_formfield_\";\n\t\tfocusVar += (field.name.startsWith(\"IO:\") ? field._children[0]:field.name);\n\t\tdocument.getElementById(focusVar).focus();\n\t}\n\n\tc.quantity = c.data.quantity ? c.data.quantity + \"\" : \"1\";\n\tc.mandatory = [];\n\t$scope.stickyHeaderTop = '0px';\n\tc.widget._debugContextMenu = [\n\t\t[ i18n.getMessage(\"Open\") + \" sc_cat_item\", function() {\n\t\t\tvar item = c.data.sc_cat_item;\n\t\t\t$window.open(\"/sp_config?id=form&table=\" + item.table + \"&sys_id=\" + item.sys_id); }]\n\t];\n\t\n spUtil.recordWatch($scope, \"sys_attachment\", \"table_sys_id=\" + $scope.data._generatedItemGUID, function(response, data) {\n\t\t$scope.attachmentHandler.getAttachmentList();\n\t\t\tif (response.data) {\n\t\t\t\tvar options = {};\n\t\t\t\toptions.operation = response.data.operation;\n\t\t\t\toptions.filename = response.data.display_value;\n\t\t\t\toptions.state = (response.data.record && response.data.record.state) ? response.data.record.state.value : \"\";\n\t\t\tif (options.operation === 'update' && options.state === 'not_available')\n\t\t\t\t$rootScope.$broadcast(\"$$uiNotification\", {type: 'error', message: i18n.getMessage('Upload file scan failed').withValues([options.filename])});\n\t\t}\n\t});\n\t\n\t$rootScope.$on('spModel.gForm.rendered', function() {\n\t\t$timeout(function() {\n\t\t\t\t\t\t\tspAtf.init().then(function(atf) {\n\t\t\t\t\t\t\t\t$scope._atf = atf;\n\t\t\t\t\t\t\t\tatf.expose('catalog_util', catalogUtil);\n\t\t\t\t\t\t\t});\n\t\t}, 10);\n\t});\n\t\n\t//\tATF helper object\n\tvar catalogUtil = {\n\t\tupdateGform: function() {\n\t\t\t$scope._atf.expose('g_form', spAtf.augmentForm(g_form));\n\t\t},\n\t\t\n\t\taddRow: function(fieldId, timeoutInMS) {\n\t\t\tif (timeoutInMS <= 0)\n\t\t\t\ttimeoutInMS = 1000;\n\t\t\tvar deferred = $q.defer();\n\t\t\t$scope.$broadcast(\"$sp.sc_multi_row.create_row\", fieldId, $scope.data.sc_cat_item.sys_id);\n\t\t\t$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {\n\t\t\t\tif (gFormInstance.getSysId() == fieldId)\n\t\t\t\t\tdeferred.resolve();\n\t\t\t});\n\t\t\t$timeout(function() {\n\t\t\t\tdeferred.reject();\n\t\t\t}, timeoutInMS);\n\t\t\treturn deferred.promise;\n\t\t},\n\t\t\n\t\tsubmit: function (timeout) {\n\t\t\tvar deferred = $q.defer();\n\t\t\t$scope.triggerOnSubmit(timeout);\n\t\t\tvar cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {\n\t\t\t\t\tcleanup();\n\t\t\t\t\tdeferred.reject(\"Can't submit form\");\n\t\t\t});\n\t\t\tif (g_form) {\n\t\t\t\t\tg_form.$private.events.on('submitted', function() {\n\t\t\tvar cleanUp = $scope.$on('$sp.sc_cat_item.submitted', function(o, result) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tcleanUp();\n\t\t\t\t\t\t\tdeferred.resolve(result);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tdeferred.reject('g_form not initialized');\n\t\t\t\n\t\t\treturn deferred.promise;\n\t\t},\n\t\t\n\t\taddToCart: function(timeout) {\n\t\t\tvar defer = $q.defer();\n\t\t\t$scope.triggerAddToCart(timeout);\n\t\t\tvar cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {\n\t\t\t\t\tcleanup();\n\t\t\t\t\tdefer.reject(\"Can't submit form\");\n\t\t\t});\n\t\t\tif (g_form) {\n\t\t\t\tg_form.$private.events.on('submitted', function() {\n\t\t\t\t\t\tvar cleanup = $scope.$on('$sp.sc_cat_item.add_to_cart', function(o, result) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tdefer.reject('g_form not initialized');\t\t\t\n\t\t\treturn defer.promise;\n\t\t},\n\t\t\n\t\tsubmitCatItem: function(timeout) {\n\t\t\tvar defer = $q.defer();\n\t\t\t$scope.triggerOnSubmit(timeout);\n\t\t\tvar cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {\n\t\t\t\t\tcleanup();\n\t\t\t\t\tdefer.reject(\"Can't submit form\");\n\t\t\t});\n\t\t\tif (g_form) {\n\t\t\t\tg_form.$private.events.on('submitted', function() {\n\t\t\t\tif ($scope.data.sys_properties.twostep && $scope.data.sc_cat_item.request_method != \"submit\") {\n\t\t\t\t\tdefer.resolve();\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tvar cleanUp = $scope.$on('$sp.sc_cat_item.submitted', function(o, result) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tcleanUp();\n\t\t\t\t\t\t\tresult.single_step = true;\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tdefer.reject('g_form not initialized');\n\t\t\treturn defer.promise;\n\t\t},\n\t\t\n\t\tsetQuantity: function(quantity) {\n\t\t\tif ($scope.c.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" && $scope.c.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\") {\n\t\t\t\t$scope.c.quantity = quantity;\n\t\t\t\t$scope.$apply();\n\t\t\t}\n\t\t},\n\t\t\n\t\tgetQuantity: function() {\n\t\t\treturn $scope.c.quantity;\n\t\t},\n\t\t\n\t\tgetPrice: function() {\n\t\t\tvar obj = {};\n\t\t\tobj.price = $scope.data.sc_cat_item.price_display;\n\t\t\tobj.recurring_price = $scope.data.sc_cat_item.recurring_price_display;\n\t\t\tobj.recurring_frequency = $scope.data.sc_cat_item.recurring_frequency;\n\t\t\treturn obj;\n\t\t}\n\t}\n\t\n\tif (cabrillo.isNative())\n\t\tcabrillo.viewLayout.setTitle('');\n\t\n\tc.showAddCartBtn = function() {\n\t\treturn !$scope.submitted &&\n\t\t  c.options.show_add_cart_button &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\" &&\n\t\t\t!c.data.sc_cat_item.no_cart && !c.data.is_cart_item;\n\t}\n\t\n\tc.showQuantitySelector = function() {\n\t\t// Following if block is code for hard-setting an aria-label on the quantity select box\n\t\t// for displaying the label \"quantity\"\n\t\tif($('#catItemQuantity') != null) {\n\t\t\tvar quantityElement = $('#catItemQuantity');\n\t\t\tquantityElement.prev().find(\".select2-offscreen\").removeAttr(\"aria-labelledby\").attr(\"aria-label\",\"Quantity \" + c.quantity);\n\t\t}\n\t\t\n\t\treturn c.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\" &&\n\t\t\t!c.data.sc_cat_item.no_quantity &&\n\t\t\t(c.data.sc_cat_item.cart_guide === undefined || c.data.sc_cat_item.cart_guide === null)&&\n\t\t\t(!c.data.sc_cat_item.no_order_now || !c.data.sc_cat_item.no_cart);\n\t}\n\tc.showOrderNowButton = function() {\n\t\treturn !$scope.data.is_cart_item && (c.data.sc_cat_item.use_sc_layout || !c.data.sc_cat_item.no_order_now);\n\t}\n\tc.showAddToWishlist = function () {\n\t\treturn !$scope.submitted  && \n\t\t\t(c.data.showWishlist && \n\t\t\t !c.data.sc_cat_item.no_wishlist && \n\t\t\t !c.data.is_cart_item && \n\t\t\t c.options.show_add_to_wishlist_button === 'true');\n\t}\n\tc.allowOrder = function() {\n\t\tif (c.data.sc_cat_item.use_sc_layout)\n\t\t\treturn true;\n\t\tif (c.data.sc_cat_item.no_order)\n\t\t\treturn false;\n\t\tif (c.data.sc_cat_item.no_order_now && c.data.sc_cat_item.no_cart)\n\t\t\treturn false;\n\t\treturn true;\n\t}\n\t\n\tc.hideCartMsg = function () {\n\t\t$scope.data.showMsg = false;\n\t}\n\n\tc.showAttachments = function() {\n\t\treturn !$scope.submitted &&\n\t\t\t!c.data.sc_cat_item.no_attachments &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\";\n\t};\n\t$scope.$on('dialog.upload_too_large.show', function(e){\n\t\t$log.error($scope.m.largeAttachmentMsg);\n\t\tspUtil.addErrorMessage($scope.m.largeAttachmentMsg);\n\t});\n\t$scope.m = $scope.data.msgs;\n\tvar ah = $scope.attachmentHandler = new nowAttachmentHandler(setAttachments, appendError);\n\tfunction appendError(error) {\n\t\tspUtil.addErrorMessage(error.msg + error.fileName);\n\t}\n\tah.setParams($scope.data._attachmentTable, $scope.data._generatedItemGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);\n\tfunction setAttachments(attachments, action) {\n\t\t$scope.attachments = attachments;\n\t\tif (action === \"added\") {\n\t\t\t$scope.setFocusToAttachment();\n\t\t\tif ($scope.attachments.length > 0)\n\t\t\t $scope.data.sc_cat_item.attachment_submitted = true;\n\t\t}\n\t\tif (action === \"renamed\")\n\t\t\tspAriaUtil.sendLiveMessage($scope.m.renameSuccessMsg);\n\t\tif (action === \"deleted\") {\n\t\t\tspAriaUtil.sendLiveMessage($scope.m.deleteSuccessMsg);\n\t\t\tif ($scope.attachments.length == 0)\n\t\t\t\t$scope.data.sc_cat_item.attachment_submitted = false;\n\t\t}\n\t\tspUtil.get($scope,{action:\"from_attachment\"});\n\t}\n\t$scope.attachmentHandler.getAttachmentList();\n\t$scope.confirmDeleteAttachment = function(attachment) {\n\t\tif (cabrillo.isNative()) {\n\t\t\tif (confirm($scope.data.msgs.delete_attachment)) {\n\t\t\t\t$scope.attachmentHandler.deleteAttachment(attachment);\n\t\t\t\t$scope.setFocusToAttachmentButton();\n\t\t\t}\t\t\t\n\t\t} else {\n\t\t\tspModal.confirm($scope.data.msgs.delete_attachment).then(function() {\n\t\t\t\t$scope.attachmentHandler.deleteAttachment(attachment);\n\t\t\t\t$scope.setFocusToAttachmentButton();\n\t\t\t});\n\t\t}\n\t}\n\t$scope.dismissWishListMessage = function() {\n\t\t$scope.is_update_wishlist = false;\n\t}\n\t\n  if ($scope.data.sc_cat_item) {\n\t\t$scope.data.sc_cat_item.description = $sce.trustAsHtml($scope.data.sc_cat_item.description);\n\t\tif (angular.equals($scope.data.sc_cat_item._fields, {}))\n\t\t\t\t$scope.data.no_fields = true;\n\t\tif ($scope.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" && \n\t\t\t\t$scope.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\") {\t\n\t\t\tif ($scope.data.sc_cat_item.request_method == \"request\")\n\t\t\t\t$scope.submitButtonMsg = $scope.m.requestMsg;\n\t\t\telse if ($scope.data.sc_cat_item.request_method == \"submit\")\n\t\t\t\t$scope.submitButtonMsg = $scope.m.submitMsg;\n\t\telse\n\t\t\t\t$scope.submitButtonMsg = $scope.m.orderNowMsg;\n\t\t} else\n\t\t\t$scope.submitButtonMsg = $scope.m.submitMsg;\n\t\t\n\t\t// Breadcrumbs\n\t\tif (!$scope.data.categories)\n\t\t\t$scope.data.categories = [];\n\t\t$scope.data.categories.forEach(function(category, index, categories) {\n\t\t\tcategories[index].url = category.url + '&catalog_id=' + $scope.data.catalog_id;\n\t\t});\n\t\tif ($scope.data.is_wishlist_item) {\n\t\t\t$scope.data.categories.unshift({label: $scope.m.wishlistMsg, url: '?id=sc_wishlist'});\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t}\n\t\telse if ($scope.data.is_cart_item) {\n\t\t\t$scope.data.categories.unshift({label: $scope.m.cartMsg, url: '?id=sc_cart'});\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t}\n\t\telse if ($scope.data.categories.length > 0) {\n\t\t\t$scope.data.categories.unshift({label: $scope.data.sc_catalog || $scope.page.title, url: '?id=' + $scope.data.sc_category_page + \"&catalog_id=\" + $scope.data.catalog_id});\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t\tif ($scope.data.all_catalog_msg) {\n\t\t\t\t$scope.data.categories.unshift({label: $scope.data.all_catalog_msg, url: '?id=' + $scope.data.sc_category_page + \"&catalog_id=-1\"});\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t}\n\t\t\n\t\t$timeout(function() {\n\t\t\t$scope.$emit('sp.update.breadcrumbs', $scope.data.categories);\n\t\t});\n\t\tspUtil.setSearchPage('sc');\n\t} else {\n\t\tvar notFoundBC = [{label: $scope.page.title, url: '?id=' + $scope.data.sc_catalog_page}];\n\t\t$timeout(function() {\n\t\t\t$scope.$emit('sp.update.breadcrumbs', notFoundBC);\n\t\t});\n\t\tspUtil.setSearchPage('sc');\n\t}\n\tc.getItemId = function () {\n\t\treturn $scope.data.sc_cat_item ? $scope.data.sc_cat_item.sys_id : -1;\n\t};\n\t\n\tfunction showNativeMobileButtons(){\n\t\tif ($scope.options.native_mobile == 'true' && cabrillo.isNative()) {\n\t\t\tcabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);\t\t\t\n\t\t\tif ($scope.data.sc_cat_item.sys_class_name == \"sc_cat_item_producer\" || $scope.data.sc_cat_item.sys_class_name == \"std_change_record_producer\")\n\t\t\t\taddRPButton();\n\t\t\telse if ($scope.data.is_cart_item)\n\t\t\t\taddUpdateButton();\n\t\t\telse\n\t\t\t\taddOrderButtons();\n\t\t}\n\t}\n\t\n\tfunction nativeGoBackToCart() {\n\t\tcabrillo.viewLayout.setNavigationBarButtons();\n\t\tvar button = [{\n\t\t\timageName: 'back',\n\t\t\tbuttonStyle: cabrillo.viewLayout.REPLACE_BACK_BUTTON_STYLE,\n\t\t\tenabled: true\n\t\t}];\n\n\t\tcabrillo.viewLayout.setNavigationBarButtons(button, function() {\n\t\t\t$location.search('id=sc_cart');\n\t\t});\n\t}\n\t\n\tfunction displayNativeButtons() {\n\t\tif (cabrillo.isNative() && !$scope.orderConfirmation) {\n\t\t\tcabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);\n\t\t\tshowNativeMobileButtons();\n\t\t\tcabrillo.viewLayout.showBackButton();\n\n\t\t\tif ($scope.data.is_cart_item) {\n\t\t\t\tcabrillo.viewLayout.hideBackButton();\n\t\t\t\tcabrillo.viewLayout.setNavigationBarButtons();\n\t\t\t\tnativeGoBackToCart();\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvar mespClosePopupUnregister = $rootScope.$on(\"mesp.popup.close\", function() {\n\t\t// Timeout is to give a better user experience otherwise when this popup opens,\n\t\t// the cabrillo buttons will be displayed immediately giving a bad user experience.\n\t\t$timeout(function(){\n\t\t\tdisplayNativeButtons();\n\t\t});\n\t});\n\t\n\tvar mespOpenPopupUnregister = $rootScope.$on(\"mesp.popup.open\", function() {\n\t\t// Timeout is to give a better user experience otherwise when this popup opens,\n\t\t// the cabrillo buttons will be displayed immediately giving a bad user experience.\n\t\t$timeout(function(){\n\t\t\tremoveCabrilloButtons();\n\t\t});\n\t});\n\t\n\tvar g_form;\t\n\t$scope.$on('spModel.gForm.initialized', function(e, gFormInstance){\n\t\tif (gFormInstance.getSysId() != -1 && gFormInstance.getSysId() != c.getItemId())\n\t\t\treturn;\n\t\tg_form = gFormInstance;\n\t\tspSCNavStateManager.register(g_form);\n\t\tif ($scope.options.native_mobile == 'true' && cabrillo.isNative()) {\n\t\t\tcabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);\n\t\t\t$rootScope.$on('spModel.gForm.showNativeMobileButtons', displayNativeButtons);\n\t\t}\n\t\t$timeout(function() {\n\t\t\t$rootScope.$emit('spModel.gForm.rendered', g_form);\n\t\t\tshowNativeMobileButtons();\n\t\t}, 175);\n\n\t\t// This runs after all onSubmit scripts have executed\n\t\tg_form.$private.events.on('submitted', function(){\n\t\t\tcleanFailedSubmit();\n\t\t\t$scope.submitting = true;\n\t\t\tif ($scope.data.sc_cat_item.item_action === \"order\")\n\t\t\t\tgetOne();\n\t\t\telse if ($scope.data.sc_cat_item.item_action === \"add_to_cart\")\n\t\t\t\taddToCart();\n\t\t\telse if ($scope.data.sc_cat_item.item_action == \"update_cart\")\n\t\t\t\tupdateCart();\n\t\t});\n\t});\n\tfunction getVarData(fields) {\n\t\tvar reqData = {};\n\t\tfor(var obj in fields)\n\t\t\treqData[fields[obj].name] = fields[obj].value;\n\t\treturn reqData;\n\t}\n\tfunction addLink(url, msg) {\n\t\treturn \"<a class='link alert-link' href=\" + url + \">\" + msg + \"</a>\";\n\t}\n\t\n    //New Draft Function\n    function newAddDraft(itemId, quantity, variables, newRecordID, draftID) {\n        return $http.post(\"/api/sn_sc/v1/servicecatalog/\" + \"items/\" + itemId + \"/create_draft\", {\n            'sysparm_quantity': quantity,\n            'variables': variables,\n            'sysparm_item_guid': newRecordID,\n            'draft_id': draftID\n        })\n    };\n\tfunction getValidatedVarData(fields) {\n\t\t//Filtering out invalid masked variables, to avoid adding them to wishlist\n\t\tvar validFields = Object.values(fields).filter(function(field) { return !(field.type == 'masked' && field.useConfirmation && field.value != field.confirmPassword); });\n\t\treturn getVarData(validFields);\n\t}\t\n\t\n\t$scope.addToWishlist = function() {\n\t\t$scope.submitting = true;\n\t\t$scope.m.actionMsg = $scope.data.is_wishlist_item ? $scope.m.wishlistUpdateMsg : $scope.m.wishlistAddMsg;\n\t\t$scope.m.actionMsg += addLink('?id=sc_wishlist', $scope.m.viewWishListMsg);\n\t\t$scope.m.actionMsg += '<i class=\"fa fa-close pull-right pointer close-notification\" aria-label=\"${Close Notification}\" tabindex=\"0\" ng-click=\"c.hideCartMsg()\"/>';\n\t\t$scope.m.actionMsg = $sce.trustAsHtml($scope.m.actionMsg);\n\t\t$scope.is_update_wishlist = false;\n\t\t\n\t\tvar draftID = $scope.data.draft_id;\n        newAddDraft($scope.data.sc_cat_item.sys_id, c.quantity, getValidatedVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, draftID).then(function(response) {\t\t\n\t\t//spScUtil.addToWishlist($scope.data.sc_cat_item.sys_id, c.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID).then(function(response){\n\t\t\tvar cartItemId = \"\";\n\t\t\tfor (var i=0; i<response.data.result.items.length; i++) {\n\t\t\t\tvar item = response.data.result.items[i];\n\t\t\t\tif (item.catalog_item_id === $scope.data.sc_cat_item.sys_id) {\n\t\t\t\t\tcartItemId = item.cart_item_id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t\tif ($scope.data.draft_id == null) {\n                $scope.data.draft_id = response.data.result.cart_id;\n            }\n\t\t\t\t\t\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.add_item\");\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\", cartItemId);\n\t\t\tg_form.$private.userState.clearModifiedFields();\n\t\t\t$scope.data.showMsg = $scope.is_update_wishlist = true;\n\t\t\t$scope.data.is_wishlist_item = true;\n\t\t\t$scope.data.show_wishlist_msg = false;\n\t\t\t$scope.submitting = false;\n\t\t\tspUtil.scrollTo('#sc_cat_item', 300);\n\t\t}, function(response) {\n\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t$scope.submitting = false;\n\t\t\treturn $q.reject(response);\n\t\t});\n\t}\n\tfunction getAlsoRequestForValue(fields) {\n        if ($scope.data.sc_cat_item.requested_for_variable_name)\n            return fields[$scope.data.sc_cat_item.requested_for_variable_name].also_request_for_value;\n    }\n\t\n\t$scope.triggerAddToWishlist = function() {\n        $scope.submitting = true;\n        var alsoRequestFor = getAlsoRequestForValue($scope.data.sc_cat_item._fields);\n        if (alsoRequestFor) {\n            spModal.confirm($scope.m.addToWishlistConfirmMsg).then(addToWishlist, function() {\n                $scope.submitting = false;\n            });\n        } else\n            addToWishlist();\n    }\n\n\t$scope.triggerAddToCart = function(timeout) {\n\t\t$scope.data.sc_cat_item.item_action = \"add_to_cart\";\n\t\t$scope.data.sc_cat_item.quantity = c.quantity;\n\t\t$scope.$evalAsync(function (){\n\t\t\tif (g_form) {\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tif (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields)) {\n\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t$scope.validating = true;\n\t\t\t\t} else if (!g_form.submit()) {\n\t\t\t\t\ttimeout = timeout || 1000;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t$scope.triggerUpdateCart = function(timeout) {\n\t\t$scope.data.sc_cat_item.item_action = \"update_cart\";\n\t\t$scope.data.sc_cat_item.quantity = c.quantity;\n\t\t$scope.$evalAsync(function (){\n\t\t\tif (g_form) {\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tif (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields)) {\n\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t$scope.validating = true;\n\t\t\t\t} else if (!g_form.submit()) {\n\t\t\t\t\ttimeout = timeout || 1000;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t})\n\t\treturn false;\n\t}\n\n\t$scope.triggerOnSubmit = function(timeout) {\n\t\tif ($scope.options.isServiceWorkspace && $window.frameElement) {\n\t\t\tvar workspaceParams = {};\n\t\t\tworkspaceParams.sysparm_parent_table = $window.frameElement.getAttribute('parent-table');\n\t\t\tworkspaceParams.sysparm_parent_sys_id = $window.frameElement.getAttribute('parent-sys-id');\n\t\t\t$scope.data.workspaceParams = workspaceParams;\n\t\t}\n\t\t$scope.data.sc_cat_item.item_action = \"order\";\n\t\t$scope.data.sc_cat_item.quantity = c.quantity;\n\t\t$scope.$evalAsync(function () {\n\t\t\tif (g_form) {\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tif (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields)) {\n\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t$scope.validating = true;\n\t\t\t\t} else if (!g_form.submit()) {\n\t\t\t\t\ttimeout = timeout || 1000;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn false;\n\t}\n\t\n\tfunction setFieldsReadonly() {\n\t\tvar allFields = g_form.getFieldNames();\n\t\tfor (var fieldName in allFields) {\n\t\t\tg_form.setReadonly(allFields[fieldName], true);\n\t\t}\n\t}\n\t// order / create request\n\tfunction getOne() {\n\t\t$scope.server.get({\n\t\t\taction: 'log_request',\n\t\t\titemDetails: {\n\t\t\t\tsys_id: $scope.data.sc_cat_item.sys_id,\n\t\t\t\t\t\t\t\t\t\tname: $scope.data.sc_cat_item.name,\n\t\t\t\tsys_class_name: $scope.data.sc_cat_item.sys_class_name\n\t\t\t}\n\t\t});\n\t\t//Required to pass as payload for usage as embeddedWidget\n\t\tvar embeddedWidgetOptions = {\n\t\t\t\"auto_redirect\" : \"true\",\n\t\t\t\"requested_for_id\" : \"\",\n\t\t\t\"requested_for_display\" : \"\"\n\t\t};\n\t\tif ($scope.data.sc_cat_item.sys_class_name != \"sc_cat_item_producer\" && $scope.data.sc_cat_item.sys_class_name != \"std_change_record_producer\") {\n\t\t\tif ($scope.data.sys_properties.twostep && $scope.data.sc_cat_item.request_method != \"submit\") {\n\t\t\t\tvar payload = {\n\t\t\t\t\tcart: 'cart_' + $scope.data.sc_cat_item.sys_id,\n\t\t\t\t\titemDetails: {\n\t\t\t\t\t\tsys_id: $scope.data.sc_cat_item.sys_id, \n\t\t\t\t\t\tquantity: $scope.data.sc_cat_item.quantity, \n\t\t\t\t\t\tfields: getVarData($scope.data.sc_cat_item._fields), \n\t\t\t\t\t\tnewRecordID: $scope.data._generatedItemGUID,\n\t\t\t\t\t\trequest_method : $scope.data.sc_cat_item.request_method\n\t\t\t\t\t},\n\t\t\t\t\taction: $scope.data.is_wishlist_item ? \"order_wishlist_item\" : \"order_item\",\n\t\t\t\t\tworkspaceParams: $scope.data.workspaceParams\n\t\t\t\t};\n\t\t\t\tfor (var embeddedOption in embeddedWidgetOptions) {\n\t\t\t\t\tpayload[embeddedOption] = c.options[embeddedOption] || embeddedWidgetOptions[embeddedOption];\n\t\t\t\t}\n\t\t\t\t$scope.server.get(payload).then(function(response) {\n\t\t\t\t\tvar orderItemModalCtrl;\n\t\t\t\t\tvar unregister = $scope.$on('$sp.service_catalog.cart.cancel_order', function() {\n\t\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t\t$scope.orderConfirmation = false;\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\torderItemModalCtrl.close();\n\t\t\t\t\t\t\tdisplayNativeButtons();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tvar closeModalOnSubmit = $scope.$on('$sp.service_catalog.cart.submitted', function(){\n\t\t\t\t\t\torderItemModalCtrl.close();\n\t\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t\t});\n\t\t\t\t\tvar orderItemModal = angular.copy(response.data.orderItemModal);\n\t\t\t\t\torderItemModal.options.afterOpen = function(ctrl){\n\t\t\t\t\t\torderItemModalCtrl = ctrl;\n\t\t\t\t\t};\n\t\t\t\t\torderItemModal.options.afterClose = function() {\n\t\t\t\t\t\t\tunregister();\n\t\t\t\t\t\t\tcloseModalOnSubmit();\n\t\t\t\t\t\t\tc.orderItemModal = null;\n\t\t\t\t\t\t\torderItemModalCtrl = null;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tc.orderItemModal = orderItemModal;\n\t\t\t\t\t});\n\t\t\t\t$scope.orderConfirmation = true;\n\t\t\t} else {\n\t\t\t\tvar additionalParms = {};\n\t\t\t\tif ($scope.data.workspaceParams) {\n\t\t\t\t\tadditionalParms.sysparm_parent_sys_id = $scope.data.workspaceParams.sysparm_parent_sys_id;\n\t\t\t\t\tadditionalParms.sysparm_parent_table = $scope.data.workspaceParams.sysparm_parent_table;\n\t\t\t\t}\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tshowPageLoader();\n\t\t\t\taddOrderButtons();\n\t\t\t\tif ($scope.data.is_wishlist_item) {\n\n\t\t\t\t\tspScUtil.orderWishlistedItem($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, additionalParms).then(function(response) {\n\t\t\t\t\t\tvar a = response.data.result;\n\t\t\t\t\t\t$scope.$emit(\"$$uiNotification\", a.$$uiNotification);\n\t\t\t\t\t\t$scope.$emit(\"$sp.sc_cat_item.submitted\", a);\n\t\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\");\n\t\t\t\t\t\tif (c.options.auto_redirect == 'false') {\n\t\t\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.submitted\", true);\n\t\t\t\t\t\t\tspUtil.addInfoMessage($scope.m.requestSubmitted);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ($scope.portal.url_suffix.toString().toLowerCase() == 'pttep') {\n\t\t\t\t\t\t\t\t$location.search('id=my_request');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t$location.search('id=my_request_external');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//\t$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + a.sys_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tspScUtil.orderNow($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, additionalParms).then(function(response) {\n\t\t\t\t\t\t\tvar a = response.data.result;\n\t\t\t\t\t\t\t$scope.$emit(\"$$uiNotification\", a.$$uiNotification);\n\t\t\t\t\t\t\t$scope.$emit(\"$sp.sc_cat_item.submitted\", a);\n\t\t\t\t\t\t\tif (c.options.auto_redirect == 'false') {\n\t\t\t\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.submitted\", true);\n\t\t\t\t\t\t\t\tspUtil.addInfoMessage($scope.m.requestSubmitted);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else if (!$scope._atf) {\n\t\t\t\t\t\t\t\tremoveCabrilloButtons();\n\t\t\t\t\t\t\t\t\tif ($scope.portal.url_suffix.toString().toLowerCase() == 'pttep') {\n\t\t\t\t\t\t\t\t\t\t$location.search('id=my_request');\n\t\t\t\t\t\t\t\t\t\t//$location.search('id=sc_category&catalog_id=eb988957db10bb00ca57f0eb0c9619d4&sys_id=ece62ff29756f510c4ea79b71153aff1');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t$location.search('id=my_request_external');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + a.sys_id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}, function(response) {\n\t\t\t\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tpostCatalogFormRequest().then(function(response) {\n\t\t\t\tvar a = response.data.result;\n\t\t\t\tif (!$scope.options.isServiceWorkspace)\n\t\t\t\t\t$scope.$emit(\"$$uiNotification\", a.$$uiNotification);\n\t\t\t\t$scope.$emit(\"$sp.sc_cat_item.submitted\", a);\n\t\t\t\tif ($scope.data.is_wishlist_item)\n\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\");\n\t\t\t\tif (c.options.auto_redirect == 'false') {\n\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t$scope.submitting = false;\n\t\t\t\t$scope.submitButtonMsg = $scope.m.submittedMsg;\n\t\t\t\t} else if (!$scope._atf)\n\t\t\t\t\t\thandleRedirect(a.number, a.table, a.sys_id, a.redirect_to, a.redirect_portal_url);\n\t\t\t\t\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction addToCart() {\n\t\t$scope.server.get({\n\t\t\taction: 'log_request',\n\t\t\titemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, \n\t\t\t\t\t\t\t\t\t\tname: $scope.data.sc_cat_item.name,\n\t\t\t\t\t\t\t\t\t\tsys_class_name: $scope.data.sc_cat_item.sys_class_name}\n\t\t});\n\t\t\n\t\tpostCatalogFormRequest().then(function(response) {\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.add_item\");\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.update\");\n\t\t\t$scope.$emit(\"$sp.sc_cat_item.add_to_cart\", $scope.data._generatedItemGUID);\n\t\t\tif ($scope.data.is_wishlist_item) {\n\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\");\n\t\t\t\t$scope.data.is_wishlist_item = false;\n\t\t\t\tif ($location.$$search.edit === \"wishlist\") {\n\t\t\t\t\t$location.search(\"id=sc_wishlist\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tg_form.$private.userState.clearModifiedFields();\n\t\t\tc.status = i18n.getMessage(\"Added item to shopping cart\");\n\t\t\tvar cartResponse = response;\n\t\t\t$scope.server.get({action: 'init_item'}).then(function(response) {\n\t\t\t\t$scope.data._generatedItemGUID = response.data._generatedItemGUID;\n\t\t\t\tah.setParams($scope.data._attachmentTable, $scope.data._generatedItemGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);\n\t\t\t\t$scope.attachmentHandler.getAttachmentList();\n\t\t\t\tif (!cabrillo.isNative()) {\n\t\t\t\t\t$scope.m.actionMsg = $scope.m.cartAddMsg + addLink('?id=sc_cart', $scope.m.viewCartMsg);\n\t\t\t\t\t$scope.m.actionMsg += '<i class=\"fa fa-close pull-right pointer close-notification\" aria-label=\"${Close Notification}\" tabindex=\"0\" ng-click=\"c.hideCartMsg()\"/>';\n\t\t\t\t\t$scope.m.actionMsg = $sce.trustAsHtml($scope.m.actionMsg);\n\t\t\t\t\t$scope.data.showMsg = true;\n\t\t\t\t} else {\n\t\t\t\t\t\tcabrillo.message.showMessage(cabrillo.message.SUCCESS_MESSAGE_STYLE, c.status);\n\t\t\t\t\t\tif (cartResponse && cartResponse.data && cartResponse.data.result) {\n\t\t\t\t\t\t\t\tvar items = cartResponse.data.result.items || [];\n\t\t\t\t\t\t\t\t$scope.showCabrilloCart = true;\n\t\t\t\t\t\t\t\t$scope.cartItemCount = items.length;\n\t\t\t\t\t\t\t\tshowCartButton();\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$scope.submitting = false;\n\t\t\t\thidePageLoader();\n\t\t\t\tcleanFailedSubmit = $scope.$on('$sp.service_catalog.form_submit_failed', function() { $scope.submitting = false; });\n\t\t\t\tspUtil.scrollTo('#sc_cat_item', 300);\n\t\t\t});\n\t\t});\n\t}\n\tfunction updateCart() {\n\t\tpostCatalogFormRequest().then(function(response) {\n\t\t\tg_form.$private.userState.clearModifiedFields();\n\t\t\tc.status = i18n.getMessage(\"Updated Item to shopping cart.\");\n\t\t\tremoveCabrilloButtons();\n\t\t\t$location.search('id=sc_cart');\n\t\t})\n\t}\n\tfunction postCatalogFormRequest() {\n\t\t$scope.submitting = true;\n\t\tshowPageLoader();\n\t\tif ($scope.data.sc_cat_item.item_action !== \"add_to_cart\")\n\t\t\taddOrderButtons();\n\t\t\n\t\tif ($scope.data.is_wishlist_item) {\n\t\t\t$scope.is_update_wishlist = false;\n\t\t\t$scope.data.show_wishlist_msg = false;\n\t\t\tif ($scope.data.sc_cat_item.sys_class_name === \"sc_cat_item_producer\")\n\t\t\t\treturn spScUtil.submitWishlistedProducer($scope.data.sc_cat_item.sys_id, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, $scope.data.workspaceParams);\n\t\t\telse if ($scope.data.sc_cat_item.item_action === \"add_to_cart\")\n\t\t\t\treturn spScUtil.addWishlistedItemToCart($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID).then(null, function(response) {\n\t\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t\t$scope.submitting = false;\t\n\t\t\t\treturn $q.reject(response);\n\t\t\t});\n\t\t}\n\t\telse if ($scope.data.is_cart_item) {\n\t\t\treturn spScUtil.updateCart($scope.data._generatedItemGUID, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields));\n\t\t}\n\t\telse if ($scope.data.sc_cat_item.sys_class_name === \"sc_cat_item_producer\") {\n\t\t\treturn spScUtil.submitProducer($scope.data.sc_cat_item.sys_id, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, $scope.data.workspaceParams).then(null, function(response) {\n\t\t\t\tif (response.data.result && response.data.result.errMsg) \n\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t\t$scope.submitting = false;\n\t\t\t\treturn $q.reject(response);\n\t\t\t});\n\t\t}\n\t\telse if ($scope.data.sc_cat_item.sys_class_name === \"std_change_record_producer\") {\n\t\t\t\treturn spScUtil.submitStdChgProducer($scope.data.sc_cat_item.sys_id, $scope.data.stdChg.twoStep, $scope.data.stdChg.currentVersion, $scope.data._generatedItemGUID, $scope.portal.url_suffix);\n\t\t}\n\t\telse if ($scope.data.sc_cat_item.item_action === \"add_to_cart\") {\n\t\t\treturn spScUtil.addToCart($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID).then(null, function(response) {\n\t\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t\t$scope.submitting = false;\n\t\t\t\treturn $q.reject(response);\n\t\t\t});\n\t\t}\n\t}\n\t// spModel populates mandatory - hasMandatory is called by the submit button\n\t$scope.hasMandatory = function() {\n\t\treturn c.mandatory && c.mandatory.length > 0;\n\t};\n\t\n\t//\tListeners\n\tvar cleanFailedSubmit = $scope.$on('$sp.service_catalog.form_submit_failed', function() { $scope.submitting = false; });\n\tvar validationComplete = $rootScope.$on('$sp.service_catalog.form_validation_complete', function() { \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$scope.validating = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t$scope.$on(\"$sp.sc_cat_item.submitted\", function() {\n\t\tg_form.$private.userState.clearModifiedFields();\n\t});\n\t$scope.$on(\"$sp.service_catalog.wishlist.update\", function(evt, item) {\n\t\tif (item === $scope.data.sys_id)\n\t\t\t$scope.data.show_wishlist_msg = false;\n\t});\n\t// switch catalog items\n\tvar unregister = $scope.$on('$sp.list.click', onListClick);\n\t$scope.$on(\"$destroy\", function() {\n\t\t$rootScope.$broadcast(\"$sp.service_catalog.item.close\");\n\t\tunregister();\n\t\tmespClosePopupUnregister();\n\t\tmespOpenPopupUnregister();\n\t\tvalidationComplete();\n\t});\n\tfunction onListClick(evt, arg) {\n\t\t$scope.data.sys_id = arg.sys_id;\n\t\tspUtil.update($scope);\n\t}\n\t\n\tfunction formatRedirectUrl(page, table, sys_id) {\n\t\tvar url;\n\t\tvar paramObj = {page: page, table: table, sys_id: sys_id};\n\t\turl = spUtil.format(c.options.url, paramObj);\n\t\t\n\t\t//return url;\n\t\tif ($scope.portal.url_suffix.toString().toLowerCase() == 'pttep') {\n\t\t\t\n\t\t\tif (c.data.sc_cat_item.custom_url && c.data.sc_cat_item.custom_url != '') {\n\t\t\t\treturn c.data.sc_cat_item.custom_url.toString();\n\t\t\t} else {\n\t\t\treturn 'id=my_request';\n\t\t\t}\n\t\t\t//return 'id=sc_category&catalog_id=eb988957db10bb00ca57f0eb0c9619d4&sys_id=ece62ff29756f510c4ea79b71153aff1';\n\t\t\t//return 'id=mail_delivery_task';\n\t\t}\n\t\telse {\n\t\t\treturn 'id=my_request_external';\n\t\t}\n\t}\n\t\n\tfunction handleRedirect(n, table, sys_id, redirectTo, redirectUrl) {\n\n\t\tvar page = 'form';\n\t\tif (table == 'sc_request')\n\t\t\tpage = 'sc_request';\n\t\telse if (n)\n\t\t\tpage = 'ticket';\n\t\t\n\t\tif (redirectTo == 'catalog_home') \n\t\t\tpage = 'sc_home';\n\n\t\t//For Standard change, always direct to form if not in Workspace\n\t\tif ($scope.data.sc_cat_item.sys_class_name === \"std_change_record_producer\") {\n\t\t\tif ($scope.options.isServiceWorkspace == 'true') {\n\t\t\t\tvar params = {};\n\t\t\t\tparams.msg = 'TARGET_RECORD_SELECTED';\n\t\t\t\tparams.target_table = table;\n\t\t\t\tparams.target_sys_id = -1;\n\t\t\t\tif (sys_id)\n\t\t\t\t\tparams.target_sys_id = sys_id;\n\n\t\t\t\tif ($scope.data.stdChg.twoStep)\n\t\t\t\t\tparams.target_query = 'type=standard^std_change_producer_version=' + $scope.data.stdChg.currentVersion;\n\n\t\t\t\twindow.postMessage(params, location.origin);\n\t\t\t\treturn;\n\t\t\t} else\n\t\t\t\tpage = 'form';\n\t\t}\n\t\tremoveCabrilloButtons();\n\t\tif (c.options.page) {page = c.options.page;}\n\t\tif (c.options.table) {table = c.options.table;}\n\t\tvar url = formatRedirectUrl(page, table, sys_id);\n\t\tif ($scope.data.sc_cat_item.sys_class_name === \"sc_cat_item_producer\" || $scope.data.sc_cat_item.sys_class_name === \"std_change_record_producer\" || $scope.data.sc_cat_item.sys_class_name === \"sc_req_item\") {\n\t\t\tif (redirectUrl) {\n\t\t\t\t$window.location.href = redirectUrl;\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tvar newURL = $location.search(url);\n\t\t    spAriaFocusManager.navigateToLink(newURL.url());\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t$location.search(formatRedirectUrl('sc_request', 'sc_request', sys_id));\n\t\treturn;\n\t}\n    \n    $timeout(function() {\n        if ($document[0].getElementsByClassName('sc-sticky-item-header').length > 0) {\n            var titleHeight = $document[0].getElementsByClassName('sc-sticky-item-header')[0].clientHeight;\n            $scope.stickyHeaderTop = '-' + (titleHeight - 20 - $document[0].getElementsByClassName('sc-cat-item-short-description')[0].clientHeight) + 'px;';\n        }\n    });\n\t\t\n\tfunction addOrderButtons() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tshowCartButton();\n\t\tvar buttons = [];\n\t\tif ($scope.c.data.sys_properties.cartEnabled && $scope.c.showAddCartBtn()) {\n\t\t\tbuttons.push({\n\t\t\t\ttitle: $scope.m.addToCart,\n\t\t\t\tenabled: true,\n\t\t\t\tbackgroundColor: '#f7f7f7',\n\t\t\t\ttextColor: '#000000'\n\t\t\t});\n\t\t}\n\t\tbuttons.push({\n\t\t\ttitle: $scope.submitting? $scope.m.submittingMsg : $scope.submitButtonMsg,\n\t\t\tenabled: !$scope.submitting,\n\t\t\tbackgroundColor: $scope.data.sys_properties.mobileNativeColor,\n\t\t\ttextColor: '#FFFFFF'\n\t\t});\n\t\tcabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {\n\t\t\tif ($scope.c.data.sys_properties.cartEnabled && $scope.c.showAddCartBtn()) {\n\t\t\t\tif (buttonIndex == 0) {\n\t\t\t\t\t$timeout(function() {\t\n\t\t\t\t\t\t$scope.triggerAddToCart();\n\t\t\t\t\t},500);\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$timeout(function() {\t\n\t\t\t\t\t\t$scope.triggerOnSubmit();\n\t\t\t\t\t},500);\n\t\t\t\t}\t\t\t\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$timeout(function() {\t\n\t\t\t\t\t$scope.triggerOnSubmit();\n\t\t\t\t},500);\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction addRPButton() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tvar buttons = [\n\t\t\t{\n\t\t\t\ttitle: $scope.submitButtonMsg,\n\t\t\t\tenabled: true,\n\t\t\t\tbackgroundColor: $scope.data.sys_properties.mobileNativeColor,\n\t\t\t\ttextColor: '#FFFFFF'\n\t\t\t}\n\t\t];\n\n\t\tcabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {\n\t\t\t$timeout(function() {\t\n\t\t\t\t$scope.triggerOnSubmit();\n\t\t\t},500);\n\t\t});\n\t}\n\t\n\tfunction showCartButton() {\n\t\tif (!cabrillo.isNative() || !$scope.showCabrilloCart) return;\n\n\t\tvar button = [{\n\t\t\t\timageName: 'cart',\n\t\t\t\tbadgeCount: $scope.cartItemCount,\n\t\t\t\tbackgroundColor: '#2ff5f9',\n\t\t\t\ttextColor: '#FFFFFF',\n\t\t\t\tenabled: true\n\t\t\t\t}];\n\n\t\tcabrillo.viewLayout.setNavigationBarButtons(button, function(index) {\n\t\t\t\t$location.search('id=sc_cart');\n\t\t\t});\n\n\t}\n\t\n\tfunction addUpdateButton() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tvar buttons = [\n\t\t\t{\n\t\t\t\ttitle: $scope.m.updateCart,\n\t\t\t\tenabled: true,\n\t\t\t\tbackgroundColor: $scope.data.sys_properties.mobileNativeColor,\n\t\t\t\ttextColor: '#FFFFFF'\n\t\t\t}\n\t\t];\n\n\t\tcabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {\n\t\t\t$timeout(function() {\t\n\t\t\t\t$scope.triggerUpdateCart();\n\t\t\t},500);\n\t\t});\n\t\tnativeGoBackToCart();\n\t}\n\t\n\tfunction removeCabrilloButtons() {\n\t\t\tif (!cabrillo.isNative()) return;\n\t\t\tcabrillo.viewLayout.setBottomButtons();\n\t}\n\t\n\tfunction showPageLoader() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tcabrillo.viewLayout.showSpinner();\n\t}\n\t\n\tfunction hidePageLoader() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tcabrillo.viewLayout.hideSpinner();\n\t}\n}",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function ($scope, $http, spScUtil, spUtil, nowAttachmentHandler, $rootScope, $sanitize, $window, $sce, i18n, $timeout, $log, spAriaUtil, $document, spModal, $q, spAtf, $location, spAriaFocusManager, spSCNavStateManager, cabrillo) {\n\tvar c = this;\n\t\n\t//console.log('-------------' + JSON.stringify(c.data.sc_cat_item));\n\t\n\t//alert('customer link: ' + JSON.stringify(c.data.sc_cat_item));\n\t\n\tif (c.data.sc_cat_item && $scope.data.hasOwnProperty(\"_generatedItemGUID\")) {\n\t\tc.data.sc_cat_item._attachmentGUID = $scope.data._generatedItemGUID;\n\t}\n\n\t$scope.getFocus = function(field) {\n\t\tvar focusVar = (field.type == \"reference\") ? \"sp_formfield_reference_\" : \"sp_formfield_\";\n\t\tfocusVar += (field.name.startsWith(\"IO:\") ? field._children[0]:field.name);\n\t\tdocument.getElementById(focusVar).focus();\n\t}\n\n\tc.quantity = c.data.quantity ? c.data.quantity + \"\" : \"1\";\n\tc.mandatory = [];\n\t$scope.stickyHeaderTop = '0px';\n\tc.widget._debugContextMenu = [\n\t\t[ i18n.getMessage(\"Open\") + \" sc_cat_item\", function() {\n\t\t\tvar item = c.data.sc_cat_item;\n\t\t\t$window.open(\"/sp_config?id=form&table=\" + item.table + \"&sys_id=\" + item.sys_id); }]\n\t];\n\t\n spUtil.recordWatch($scope, \"sys_attachment\", \"table_sys_id=\" + $scope.data._generatedItemGUID, function(response, data) {\n\t\t$scope.attachmentHandler.getAttachmentList();\n\t\t\tif (response.data) {\n\t\t\t\tvar options = {};\n\t\t\t\toptions.operation = response.data.operation;\n\t\t\t\toptions.filename = response.data.display_value;\n\t\t\t\toptions.state = (response.data.record && response.data.record.state) ? response.data.record.state.value : \"\";\n\t\t\tif (options.operation === 'update' && options.state === 'not_available')\n\t\t\t\t$rootScope.$broadcast(\"$$uiNotification\", {type: 'error', message: i18n.getMessage('Upload file scan failed').withValues([options.filename])});\n\t\t}\n\t});\n\t\n\t$rootScope.$on('spModel.gForm.rendered', function() {\n\t\t$timeout(function() {\n\t\t\t\t\t\t\tspAtf.init().then(function(atf) {\n\t\t\t\t\t\t\t\t$scope._atf = atf;\n\t\t\t\t\t\t\t\tatf.expose('catalog_util', catalogUtil);\n\t\t\t\t\t\t\t});\n\t\t}, 10);\n\t});\n\t\n\t//\tATF helper object\n\tvar catalogUtil = {\n\t\tupdateGform: function() {\n\t\t\t$scope._atf.expose('g_form', spAtf.augmentForm(g_form));\n\t\t},\n\t\t\n\t\taddRow: function(fieldId, timeoutInMS) {\n\t\t\tif (timeoutInMS <= 0)\n\t\t\t\ttimeoutInMS = 1000;\n\t\t\tvar deferred = $q.defer();\n\t\t\t$scope.$broadcast(\"$sp.sc_multi_row.create_row\", fieldId, $scope.data.sc_cat_item.sys_id);\n\t\t\t$scope.$on('spModel.gForm.initialized', function(e, gFormInstance) {\n\t\t\t\tif (gFormInstance.getSysId() == fieldId)\n\t\t\t\t\tdeferred.resolve();\n\t\t\t});\n\t\t\t$timeout(function() {\n\t\t\t\tdeferred.reject();\n\t\t\t}, timeoutInMS);\n\t\t\treturn deferred.promise;\n\t\t},\n\t\t\n\t\tsubmit: function (timeout) {\n\t\t\tvar deferred = $q.defer();\n\t\t\t$scope.triggerOnSubmit(timeout);\n\t\t\tvar cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {\n\t\t\t\t\tcleanup();\n\t\t\t\t\tdeferred.reject(\"Can't submit form\");\n\t\t\t});\n\t\t\tif (g_form) {\n\t\t\t\t\tg_form.$private.events.on('submitted', function() {\n\t\t\tvar cleanUp = $scope.$on('$sp.sc_cat_item.submitted', function(o, result) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tcleanUp();\n\t\t\t\t\t\t\tdeferred.resolve(result);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tdeferred.reject('g_form not initialized');\n\t\t\t\n\t\t\treturn deferred.promise;\n\t\t},\n\t\t\n\t\taddToCart: function(timeout) {\n\t\t\tvar defer = $q.defer();\n\t\t\t$scope.triggerAddToCart(timeout);\n\t\t\tvar cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {\n\t\t\t\t\tcleanup();\n\t\t\t\t\tdefer.reject(\"Can't submit form\");\n\t\t\t});\n\t\t\tif (g_form) {\n\t\t\t\tg_form.$private.events.on('submitted', function() {\n\t\t\t\t\t\tvar cleanup = $scope.$on('$sp.sc_cat_item.add_to_cart', function(o, result) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tdefer.reject('g_form not initialized');\t\t\t\n\t\t\treturn defer.promise;\n\t\t},\n\t\t\n\t\tsubmitCatItem: function(timeout) {\n\t\t\tvar defer = $q.defer();\n\t\t\t$scope.triggerOnSubmit(timeout);\n\t\t\tvar cleanup = $scope.$on('$sp.service_catalog.form_submit_failed', function() {\n\t\t\t\t\tcleanup();\n\t\t\t\t\tdefer.reject(\"Can't submit form\");\n\t\t\t});\n\t\t\tif (g_form) {\n\t\t\t\tg_form.$private.events.on('submitted', function() {\n\t\t\t\tif ($scope.data.sys_properties.twostep && $scope.data.sc_cat_item.request_method != \"submit\") {\n\t\t\t\t\tdefer.resolve();\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tvar cleanUp = $scope.$on('$sp.sc_cat_item.submitted', function(o, result) {\n\t\t\t\t\t\t$timeout(function() {\n\t\t\t\t\t\t\tcleanUp();\n\t\t\t\t\t\t\tresult.single_step = true;\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tdefer.reject('g_form not initialized');\n\t\t\treturn defer.promise;\n\t\t},\n\t\t\n\t\tsetQuantity: function(quantity) {\n\t\t\tif ($scope.c.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" && $scope.c.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\") {\n\t\t\t\t$scope.c.quantity = quantity;\n\t\t\t\t$scope.$apply();\n\t\t\t}\n\t\t},\n\t\t\n\t\tgetQuantity: function() {\n\t\t\treturn $scope.c.quantity;\n\t\t},\n\t\t\n\t\tgetPrice: function() {\n\t\t\tvar obj = {};\n\t\t\tobj.price = $scope.data.sc_cat_item.price_display;\n\t\t\tobj.recurring_price = $scope.data.sc_cat_item.recurring_price_display;\n\t\t\tobj.recurring_frequency = $scope.data.sc_cat_item.recurring_frequency;\n\t\t\treturn obj;\n\t\t}\n\t}\n\t\n\tif (cabrillo.isNative())\n\t\tcabrillo.viewLayout.setTitle('');\n\t\n\tc.showAddCartBtn = function() {\n\t\treturn !$scope.submitted &&\n\t\t  c.options.show_add_cart_button &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\" &&\n\t\t\t!c.data.sc_cat_item.no_cart && !c.data.is_cart_item;\n\t}\n\t\n\tc.showQuantitySelector = function() {\n\t\t// Following if block is code for hard-setting an aria-label on the quantity select box\n\t\t// for displaying the label \"quantity\"\n\t\tif($('#catItemQuantity') != null) {\n\t\t\tvar quantityElement = $('#catItemQuantity');\n\t\t\tquantityElement.prev().find(\".select2-offscreen\").removeAttr(\"aria-labelledby\").attr(\"aria-label\",\"Quantity \" + c.quantity);\n\t\t}\n\t\t\n\t\treturn c.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\" &&\n\t\t\t!c.data.sc_cat_item.no_quantity &&\n\t\t\t(c.data.sc_cat_item.cart_guide === undefined || c.data.sc_cat_item.cart_guide === null)&&\n\t\t\t(!c.data.sc_cat_item.no_order_now || !c.data.sc_cat_item.no_cart);\n\t}\n\tc.showOrderNowButton = function() {\n\t\treturn !$scope.data.is_cart_item && (c.data.sc_cat_item.use_sc_layout || !c.data.sc_cat_item.no_order_now);\n\t}\n\tc.showAddToWishlist = function () {\n\t\treturn !$scope.submitted  && \n\t\t\t(c.data.showWishlist && \n\t\t\t !c.data.sc_cat_item.no_wishlist && \n\t\t\t !c.data.is_cart_item && \n\t\t\t c.options.show_add_to_wishlist_button === 'true');\n\t}\n\tc.allowOrder = function() {\n\t\tif (c.data.sc_cat_item.use_sc_layout)\n\t\t\treturn true;\n\t\tif (c.data.sc_cat_item.no_order)\n\t\t\treturn false;\n\t\tif (c.data.sc_cat_item.no_order_now && c.data.sc_cat_item.no_cart)\n\t\t\treturn false;\n\t\treturn true;\n\t}\n\t\n\tc.hideCartMsg = function () {\n\t\t$scope.data.showMsg = false;\n\t}\n\n\tc.showAttachments = function() {\n\t\treturn !$scope.submitted &&\n\t\t\t!c.data.sc_cat_item.no_attachments &&\n\t\t\tc.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\";\n\t};\n\t$scope.$on('dialog.upload_too_large.show', function(e){\n\t\t$log.error($scope.m.largeAttachmentMsg);\n\t\tspUtil.addErrorMessage($scope.m.largeAttachmentMsg);\n\t});\n\t$scope.m = $scope.data.msgs;\n\tvar ah = $scope.attachmentHandler = new nowAttachmentHandler(setAttachments, appendError);\n\tfunction appendError(error) {\n\t\tspUtil.addErrorMessage(error.msg + error.fileName);\n\t}\n\tah.setParams($scope.data._attachmentTable, $scope.data._generatedItemGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);\n\tfunction setAttachments(attachments, action) {\n\t\t$scope.attachments = attachments;\n\t\tif (action === \"added\") {\n\t\t\t$scope.setFocusToAttachment();\n\t\t\tif ($scope.attachments.length > 0)\n\t\t\t $scope.data.sc_cat_item.attachment_submitted = true;\n\t\t}\n\t\tif (action === \"renamed\")\n\t\t\tspAriaUtil.sendLiveMessage($scope.m.renameSuccessMsg);\n\t\tif (action === \"deleted\") {\n\t\t\tspAriaUtil.sendLiveMessage($scope.m.deleteSuccessMsg);\n\t\t\tif ($scope.attachments.length == 0)\n\t\t\t\t$scope.data.sc_cat_item.attachment_submitted = false;\n\t\t}\n\t\tspUtil.get($scope,{action:\"from_attachment\"});\n\t}\n\t$scope.attachmentHandler.getAttachmentList();\n\t$scope.confirmDeleteAttachment = function(attachment) {\n\t\tif (cabrillo.isNative()) {\n\t\t\tif (confirm($scope.data.msgs.delete_attachment)) {\n\t\t\t\t$scope.attachmentHandler.deleteAttachment(attachment);\n\t\t\t\t$scope.setFocusToAttachmentButton();\n\t\t\t}\t\t\t\n\t\t} else {\n\t\t\tspModal.confirm($scope.data.msgs.delete_attachment).then(function() {\n\t\t\t\t$scope.attachmentHandler.deleteAttachment(attachment);\n\t\t\t\t$scope.setFocusToAttachmentButton();\n\t\t\t});\n\t\t}\n\t}\n\t$scope.dismissWishListMessage = function() {\n\t\t$scope.is_update_wishlist = false;\n\t}\n\t\n  if ($scope.data.sc_cat_item) {\n\t\t$scope.data.sc_cat_item.description = $sce.trustAsHtml($scope.data.sc_cat_item.description);\n\t\tif (angular.equals($scope.data.sc_cat_item._fields, {}))\n\t\t\t\t$scope.data.no_fields = true;\n\t\tif ($scope.data.sc_cat_item.sys_class_name !== \"sc_cat_item_producer\" && \n\t\t\t\t$scope.data.sc_cat_item.sys_class_name !== \"std_change_record_producer\") {\t\n\t\t\tif ($scope.data.sc_cat_item.request_method == \"request\")\n\t\t\t\t$scope.submitButtonMsg = $scope.m.requestMsg;\n\t\t\telse if ($scope.data.sc_cat_item.request_method == \"submit\")\n\t\t\t\t$scope.submitButtonMsg = $scope.m.submitMsg;\n\t\telse\n\t\t\t\t$scope.submitButtonMsg = $scope.m.orderNowMsg;\n\t\t} else\n\t\t\t$scope.submitButtonMsg = $scope.m.submitMsg;\n\t\t\n\t\t// Breadcrumbs\n\t\tif (!$scope.data.categories)\n\t\t\t$scope.data.categories = [];\n\t\t$scope.data.categories.forEach(function(category, index, categories) {\n\t\t\tcategories[index].url = category.url + '&catalog_id=' + $scope.data.catalog_id;\n\t\t});\n\t\tif ($scope.data.is_wishlist_item) {\n\t\t\t$scope.data.categories.unshift({label: $scope.m.wishlistMsg, url: '?id=sc_wishlist'});\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t}\n\t\telse if ($scope.data.is_cart_item) {\n\t\t\t$scope.data.categories.unshift({label: $scope.m.cartMsg, url: '?id=sc_cart'});\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t}\n\t\telse if ($scope.data.categories.length > 0) {\n\t\t\t$scope.data.categories.unshift({label: $scope.data.sc_catalog || $scope.page.title, url: '?id=' + $scope.data.sc_category_page + \"&catalog_id=\" + $scope.data.catalog_id});\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t\tif ($scope.data.all_catalog_msg) {\n\t\t\t\t$scope.data.categories.unshift({label: $scope.data.all_catalog_msg, url: '?id=' + $scope.data.sc_category_page + \"&catalog_id=-1\"});\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t$scope.data.categories.push({label: $scope.data.sc_cat_item.name, url: '#'});\n\t\t}\n\t\t\n\t\t$timeout(function() {\n\t\t\t$scope.$emit('sp.update.breadcrumbs', $scope.data.categories);\n\t\t});\n\t\tspUtil.setSearchPage('sc');\n\t} else {\n\t\tvar notFoundBC = [{label: $scope.page.title, url: '?id=' + $scope.data.sc_catalog_page}];\n\t\t$timeout(function() {\n\t\t\t$scope.$emit('sp.update.breadcrumbs', notFoundBC);\n\t\t});\n\t\tspUtil.setSearchPage('sc');\n\t}\n\tc.getItemId = function () {\n\t\treturn $scope.data.sc_cat_item ? $scope.data.sc_cat_item.sys_id : -1;\n\t};\n\t\n\tfunction showNativeMobileButtons(){\n\t\tif ($scope.options.native_mobile == 'true' && cabrillo.isNative()) {\n\t\t\tcabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);\t\t\t\n\t\t\tif ($scope.data.sc_cat_item.sys_class_name == \"sc_cat_item_producer\" || $scope.data.sc_cat_item.sys_class_name == \"std_change_record_producer\")\n\t\t\t\taddRPButton();\n\t\t\telse if ($scope.data.is_cart_item)\n\t\t\t\taddUpdateButton();\n\t\t\telse\n\t\t\t\taddOrderButtons();\n\t\t}\n\t}\n\t\n\tfunction nativeGoBackToCart() {\n\t\tcabrillo.viewLayout.setNavigationBarButtons();\n\t\tvar button = [{\n\t\t\timageName: 'back',\n\t\t\tbuttonStyle: cabrillo.viewLayout.REPLACE_BACK_BUTTON_STYLE,\n\t\t\tenabled: true\n\t\t}];\n\n\t\tcabrillo.viewLayout.setNavigationBarButtons(button, function() {\n\t\t\t$location.search('id=sc_cart');\n\t\t});\n\t}\n\t\n\tfunction displayNativeButtons() {\n\t\tif (cabrillo.isNative() && !$scope.orderConfirmation) {\n\t\t\tcabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);\n\t\t\tshowNativeMobileButtons();\n\t\t\tcabrillo.viewLayout.showBackButton();\n\n\t\t\tif ($scope.data.is_cart_item) {\n\t\t\t\tcabrillo.viewLayout.hideBackButton();\n\t\t\t\tcabrillo.viewLayout.setNavigationBarButtons();\n\t\t\t\tnativeGoBackToCart();\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvar mespClosePopupUnregister = $rootScope.$on(\"mesp.popup.close\", function() {\n\t\t// Timeout is to give a better user experience otherwise when this popup opens,\n\t\t// the cabrillo buttons will be displayed immediately giving a bad user experience.\n\t\t$timeout(function(){\n\t\t\tdisplayNativeButtons();\n\t\t});\n\t});\n\t\n\tvar mespOpenPopupUnregister = $rootScope.$on(\"mesp.popup.open\", function() {\n\t\t// Timeout is to give a better user experience otherwise when this popup opens,\n\t\t// the cabrillo buttons will be displayed immediately giving a bad user experience.\n\t\t$timeout(function(){\n\t\t\tremoveCabrilloButtons();\n\t\t});\n\t});\n\t\n\tvar g_form;\t\n\t$scope.$on('spModel.gForm.initialized', function(e, gFormInstance){\n\t\tif (gFormInstance.getSysId() != -1 && gFormInstance.getSysId() != c.getItemId())\n\t\t\treturn;\n\t\tg_form = gFormInstance;\n\t\tspSCNavStateManager.register(g_form);\n\t\tif ($scope.options.native_mobile == 'true' && cabrillo.isNative()) {\n\t\t\tcabrillo.viewLayout.setTitle($scope.data.sc_cat_item.name);\n\t\t\t$rootScope.$on('spModel.gForm.showNativeMobileButtons', displayNativeButtons);\n\t\t}\n\t\t$timeout(function() {\n\t\t\t$rootScope.$emit('spModel.gForm.rendered', g_form);\n\t\t\tshowNativeMobileButtons();\n\t\t}, 175);\n\n\t\t// This runs after all onSubmit scripts have executed\n\t\tg_form.$private.events.on('submitted', function(){\n\t\t\tcleanFailedSubmit();\n\t\t\t$scope.submitting = true;\n\t\t\tif ($scope.data.sc_cat_item.item_action === \"order\")\n\t\t\t\tgetOne();\n\t\t\telse if ($scope.data.sc_cat_item.item_action === \"add_to_cart\")\n\t\t\t\taddToCart();\n\t\t\telse if ($scope.data.sc_cat_item.item_action == \"update_cart\")\n\t\t\t\tupdateCart();\n\t\t});\n\t});\n\tfunction getVarData(fields) {\n\t\tvar reqData = {};\n\t\tfor(var obj in fields)\n\t\t\treqData[fields[obj].name] = fields[obj].value;\n\t\treturn reqData;\n\t}\n\tfunction addLink(url, msg) {\n\t\treturn \"<a class='link alert-link' href=\" + url + \">\" + msg + \"</a>\";\n\t}\n\t\n    //New Draft Function\n    function newAddDraft(itemId, quantity, variables, newRecordID, draftID) {\n        return $http.post(\"/api/sn_sc/v1/servicecatalog/\" + \"items/\" + itemId + \"/create_draft\", {\n            'sysparm_quantity': quantity,\n            'variables': variables,\n            'sysparm_item_guid': newRecordID,\n            'draft_id': draftID\n        })\n    };\n\tfunction getValidatedVarData(fields) {\n\t\t//Filtering out invalid masked variables, to avoid adding them to wishlist\n\t\tvar validFields = Object.values(fields).filter(function(field) { return !(field.type == 'masked' && field.useConfirmation && field.value != field.confirmPassword); });\n\t\treturn getVarData(validFields);\n\t}\t\n\t\n\t$scope.addToWishlist = function() {\n\t\t$scope.submitting = true;\n\t\t$scope.m.actionMsg = $scope.data.is_wishlist_item ? $scope.m.wishlistUpdateMsg : $scope.m.wishlistAddMsg;\n\t\t$scope.m.actionMsg += addLink('?id=sc_wishlist', $scope.m.viewWishListMsg);\n\t\t$scope.m.actionMsg += '<i class=\"fa fa-close pull-right pointer close-notification\" aria-label=\"${Close Notification}\" tabindex=\"0\" ng-click=\"c.hideCartMsg()\"/>';\n\t\t$scope.m.actionMsg = $sce.trustAsHtml($scope.m.actionMsg);\n\t\t$scope.is_update_wishlist = false;\n\t\t\n\t\tvar draftID = $scope.data.draft_id;\n        newAddDraft($scope.data.sc_cat_item.sys_id, c.quantity, getValidatedVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, draftID).then(function(response) {\t\t\n\t\t//spScUtil.addToWishlist($scope.data.sc_cat_item.sys_id, c.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID).then(function(response){\n\t\t\tvar cartItemId = \"\";\n\t\t\tfor (var i=0; i<response.data.result.items.length; i++) {\n\t\t\t\tvar item = response.data.result.items[i];\n\t\t\t\tif (item.catalog_item_id === $scope.data.sc_cat_item.sys_id) {\n\t\t\t\t\tcartItemId = item.cart_item_id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\t\tif ($scope.data.draft_id == null) {\n                $scope.data.draft_id = response.data.result.cart_id;\n            }\n\t\t\t\t\t\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.add_item\");\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\", cartItemId);\n\t\t\tg_form.$private.userState.clearModifiedFields();\n\t\t\t$scope.data.showMsg = $scope.is_update_wishlist = true;\n\t\t\t$scope.data.is_wishlist_item = true;\n\t\t\t$scope.data.show_wishlist_msg = false;\n\t\t\t$scope.submitting = false;\n\t\t\tspUtil.scrollTo('#sc_cat_item', 300);\n\t\t}, function(response) {\n\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t$scope.submitting = false;\n\t\t\treturn $q.reject(response);\n\t\t});\n\t}\n\tfunction getAlsoRequestForValue(fields) {\n        if ($scope.data.sc_cat_item.requested_for_variable_name)\n            return fields[$scope.data.sc_cat_item.requested_for_variable_name].also_request_for_value;\n    }\n\t\n\t$scope.triggerAddToWishlist = function() {\n        $scope.submitting = true;\n        var alsoRequestFor = getAlsoRequestForValue($scope.data.sc_cat_item._fields);\n        if (alsoRequestFor) {\n            spModal.confirm($scope.m.addToWishlistConfirmMsg).then(addToWishlist, function() {\n                $scope.submitting = false;\n            });\n        } else\n            addToWishlist();\n    }\n\n\t$scope.triggerAddToCart = function(timeout) {\n\t\t$scope.data.sc_cat_item.item_action = \"add_to_cart\";\n\t\t$scope.data.sc_cat_item.quantity = c.quantity;\n\t\t$scope.$evalAsync(function (){\n\t\t\tif (g_form) {\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tif (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields)) {\n\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t$scope.validating = true;\n\t\t\t\t} else if (!g_form.submit()) {\n\t\t\t\t\ttimeout = timeout || 1000;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t$scope.triggerUpdateCart = function(timeout) {\n\t\t$scope.data.sc_cat_item.item_action = \"update_cart\";\n\t\t$scope.data.sc_cat_item.quantity = c.quantity;\n\t\t$scope.$evalAsync(function (){\n\t\t\tif (g_form) {\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tif (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields)) {\n\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t$scope.validating = true;\n\t\t\t\t} else if (!g_form.submit()) {\n\t\t\t\t\ttimeout = timeout || 1000;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t})\n\t\treturn false;\n\t}\n\n\t$scope.triggerOnSubmit = function(timeout) {\n\t\tif ($scope.options.isServiceWorkspace && $window.frameElement) {\n\t\t\tvar workspaceParams = {};\n\t\t\tworkspaceParams.sysparm_parent_table = $window.frameElement.getAttribute('parent-table');\n\t\t\tworkspaceParams.sysparm_parent_sys_id = $window.frameElement.getAttribute('parent-sys-id');\n\t\t\t$scope.data.workspaceParams = workspaceParams;\n\t\t}\n\t\t$scope.data.sc_cat_item.item_action = \"order\";\n\t\t$scope.data.sc_cat_item.quantity = c.quantity;\n\t\t$scope.$evalAsync(function () {\n\t\t\tif (g_form) {\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tif (!spScUtil.isRegexDone($scope.data.sc_cat_item._fields)) {\n\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t$scope.validating = true;\n\t\t\t\t} else if (!g_form.submit()) {\n\t\t\t\t\ttimeout = timeout || 1000;\n\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t$scope.$broadcast('$sp.service_catalog.form_submit_failed', {action_name: 'submit'});\n\t\t\t\t\t}, timeout);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\treturn false;\n\t}\n\t\n\tfunction setFieldsReadonly() {\n\t\tvar allFields = g_form.getFieldNames();\n\t\tfor (var fieldName in allFields) {\n\t\t\tg_form.setReadonly(allFields[fieldName], true);\n\t\t}\n\t}\n\t// order / create request\n\tfunction getOne() {\n\t\t$scope.server.get({\n\t\t\taction: 'log_request',\n\t\t\titemDetails: {\n\t\t\t\tsys_id: $scope.data.sc_cat_item.sys_id,\n\t\t\t\t\t\t\t\t\t\tname: $scope.data.sc_cat_item.name,\n\t\t\t\tsys_class_name: $scope.data.sc_cat_item.sys_class_name\n\t\t\t}\n\t\t});\n\t\t//Required to pass as payload for usage as embeddedWidget\n\t\tvar embeddedWidgetOptions = {\n\t\t\t\"auto_redirect\" : \"true\",\n\t\t\t\"requested_for_id\" : \"\",\n\t\t\t\"requested_for_display\" : \"\"\n\t\t};\n\t\tif ($scope.data.sc_cat_item.sys_class_name != \"sc_cat_item_producer\" && $scope.data.sc_cat_item.sys_class_name != \"std_change_record_producer\") {\n\t\t\tif ($scope.data.sys_properties.twostep && $scope.data.sc_cat_item.request_method != \"submit\") {\n\t\t\t\tvar payload = {\n\t\t\t\t\tcart: 'cart_' + $scope.data.sc_cat_item.sys_id,\n\t\t\t\t\titemDetails: {\n\t\t\t\t\t\tsys_id: $scope.data.sc_cat_item.sys_id, \n\t\t\t\t\t\tquantity: $scope.data.sc_cat_item.quantity, \n\t\t\t\t\t\tfields: getVarData($scope.data.sc_cat_item._fields), \n\t\t\t\t\t\tnewRecordID: $scope.data._generatedItemGUID,\n\t\t\t\t\t\trequest_method : $scope.data.sc_cat_item.request_method\n\t\t\t\t\t},\n\t\t\t\t\taction: $scope.data.is_wishlist_item ? \"order_wishlist_item\" : \"order_item\",\n\t\t\t\t\tworkspaceParams: $scope.data.workspaceParams\n\t\t\t\t};\n\t\t\t\tfor (var embeddedOption in embeddedWidgetOptions) {\n\t\t\t\t\tpayload[embeddedOption] = c.options[embeddedOption] || embeddedWidgetOptions[embeddedOption];\n\t\t\t\t}\n\t\t\t\t$scope.server.get(payload).then(function(response) {\n\t\t\t\t\tvar orderItemModalCtrl;\n\t\t\t\t\tvar unregister = $scope.$on('$sp.service_catalog.cart.cancel_order', function() {\n\t\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t\t$scope.orderConfirmation = false;\n\t\t\t\t\t\t$timeout(function () {\n\t\t\t\t\t\t\torderItemModalCtrl.close();\n\t\t\t\t\t\t\tdisplayNativeButtons();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tvar closeModalOnSubmit = $scope.$on('$sp.service_catalog.cart.submitted', function(){\n\t\t\t\t\t\torderItemModalCtrl.close();\n\t\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t\t});\n\t\t\t\t\tvar orderItemModal = angular.copy(response.data.orderItemModal);\n\t\t\t\t\torderItemModal.options.afterOpen = function(ctrl){\n\t\t\t\t\t\torderItemModalCtrl = ctrl;\n\t\t\t\t\t};\n\t\t\t\t\torderItemModal.options.afterClose = function() {\n\t\t\t\t\t\t\tunregister();\n\t\t\t\t\t\t\tcloseModalOnSubmit();\n\t\t\t\t\t\t\tc.orderItemModal = null;\n\t\t\t\t\t\t\torderItemModalCtrl = null;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tc.orderItemModal = orderItemModal;\n\t\t\t\t\t});\n\t\t\t\t$scope.orderConfirmation = true;\n\t\t\t} else {\n\t\t\t\tvar additionalParms = {};\n\t\t\t\tif ($scope.data.workspaceParams) {\n\t\t\t\t\tadditionalParms.sysparm_parent_sys_id = $scope.data.workspaceParams.sysparm_parent_sys_id;\n\t\t\t\t\tadditionalParms.sysparm_parent_table = $scope.data.workspaceParams.sysparm_parent_table;\n\t\t\t\t}\n\t\t\t\t$scope.submitting = true;\n\t\t\t\tshowPageLoader();\n\t\t\t\taddOrderButtons();\n\t\t\t\tif ($scope.data.is_wishlist_item) {\n\n\t\t\t\t\tspScUtil.orderWishlistedItem($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, additionalParms).then(function(response) {\n\t\t\t\t\t\tvar a = response.data.result;\n\t\t\t\t\t\t$scope.$emit(\"$$uiNotification\", a.$$uiNotification);\n\t\t\t\t\t\t$scope.$emit(\"$sp.sc_cat_item.submitted\", a);\n\t\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\");\n\t\t\t\t\t\tif (c.options.auto_redirect == 'false') {\n\t\t\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.submitted\", true);\n\t\t\t\t\t\t\tspUtil.addInfoMessage($scope.m.requestSubmitted);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ($scope.portal.url_suffix.toString().toLowerCase() == 'pttep') {\n\t\t\t\t\t\t\t\t$location.search('id=my_request');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t$location.search('id=my_request_external');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//\t$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + a.sys_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tspScUtil.orderNow($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, additionalParms).then(function(response) {\n\t\t\t\t\t\t\tvar a = response.data.result;\n\t\t\t\t\t\t\t$scope.$emit(\"$$uiNotification\", a.$$uiNotification);\n\t\t\t\t\t\t\t$scope.$emit(\"$sp.sc_cat_item.submitted\", a);\n\t\t\t\t\t\t\tif (c.options.auto_redirect == 'false') {\n\t\t\t\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t\t\t\t$scope.submitting = false;\n\t\t\t\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.submitted\", true);\n\t\t\t\t\t\t\t\tspUtil.addInfoMessage($scope.m.requestSubmitted);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t} else if (!$scope._atf) {\n\t\t\t\t\t\t\t\tremoveCabrilloButtons();\n\t\t\t\t\t\t\t\t\tif ($scope.portal.url_suffix.toString().toLowerCase() == 'pttep') {\n\t\t\t\t\t\t\t\t\t\t$location.search('id=my_request');\n\t\t\t\t\t\t\t\t\t\t//$location.search('id=sc_category&catalog_id=eb988957db10bb00ca57f0eb0c9619d4&sys_id=ece62ff29756f510c4ea79b71153aff1');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t$location.search('id=my_request_external');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//$location.search('id=sc_request&is_new_order=true&table=sc_request&sys_id=' + a.sys_id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}, function(response) {\n\t\t\t\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tpostCatalogFormRequest().then(function(response) {\n\t\t\t\tvar a = response.data.result;\n\t\t\t\tif (!$scope.options.isServiceWorkspace)\n\t\t\t\t\t$scope.$emit(\"$$uiNotification\", a.$$uiNotification);\n\t\t\t\t$scope.$emit(\"$sp.sc_cat_item.submitted\", a);\n\t\t\t\tif ($scope.data.is_wishlist_item)\n\t\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\");\n\t\t\t\tif (c.options.auto_redirect == 'false') {\n\t\t\t\t\tsetFieldsReadonly();\n\t\t\t\t\t$scope.submitted = true;\n\t\t\t\t$scope.submitting = false;\n\t\t\t\t$scope.submitButtonMsg = $scope.m.submittedMsg;\n\t\t\t\t} else if (!$scope._atf)\n\t\t\t\t\t\thandleRedirect(a.number, a.table, a.sys_id, a.redirect_to, a.redirect_portal_url);\n\t\t\t\t\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction addToCart() {\n\t\t$scope.server.get({\n\t\t\taction: 'log_request',\n\t\t\titemDetails: {sys_id: $scope.data.sc_cat_item.sys_id, \n\t\t\t\t\t\t\t\t\t\tname: $scope.data.sc_cat_item.name,\n\t\t\t\t\t\t\t\t\t\tsys_class_name: $scope.data.sc_cat_item.sys_class_name}\n\t\t});\n\t\t\n\t\tpostCatalogFormRequest().then(function(response) {\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.add_item\");\n\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.cart.update\");\n\t\t\t$scope.$emit(\"$sp.sc_cat_item.add_to_cart\", $scope.data._generatedItemGUID);\n\t\t\tif ($scope.data.is_wishlist_item) {\n\t\t\t\t$rootScope.$broadcast(\"$sp.service_catalog.wishlist.update\");\n\t\t\t\t$scope.data.is_wishlist_item = false;\n\t\t\t\tif ($location.$$search.edit === \"wishlist\") {\n\t\t\t\t\t$location.search(\"id=sc_wishlist\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tg_form.$private.userState.clearModifiedFields();\n\t\t\tc.status = i18n.getMessage(\"Added item to shopping cart\");\n\t\t\tvar cartResponse = response;\n\t\t\t$scope.server.get({action: 'init_item'}).then(function(response) {\n\t\t\t\t$scope.data._generatedItemGUID = response.data._generatedItemGUID;\n\t\t\t\tah.setParams($scope.data._attachmentTable, $scope.data._generatedItemGUID, 1024 * 1024 * $scope.data.maxAttachmentSize);\n\t\t\t\t$scope.attachmentHandler.getAttachmentList();\n\t\t\t\tif (!cabrillo.isNative()) {\n\t\t\t\t\t$scope.m.actionMsg = $scope.m.cartAddMsg + addLink('?id=sc_cart', $scope.m.viewCartMsg);\n\t\t\t\t\t$scope.m.actionMsg += '<i class=\"fa fa-close pull-right pointer close-notification\" aria-label=\"${Close Notification}\" tabindex=\"0\" ng-click=\"c.hideCartMsg()\"/>';\n\t\t\t\t\t$scope.m.actionMsg = $sce.trustAsHtml($scope.m.actionMsg);\n\t\t\t\t\t$scope.data.showMsg = true;\n\t\t\t\t} else {\n\t\t\t\t\t\tcabrillo.message.showMessage(cabrillo.message.SUCCESS_MESSAGE_STYLE, c.status);\n\t\t\t\t\t\tif (cartResponse && cartResponse.data && cartResponse.data.result) {\n\t\t\t\t\t\t\t\tvar items = cartResponse.data.result.items || [];\n\t\t\t\t\t\t\t\t$scope.showCabrilloCart = true;\n\t\t\t\t\t\t\t\t$scope.cartItemCount = items.length;\n\t\t\t\t\t\t\t\tshowCartButton();\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$scope.submitting = false;\n\t\t\t\thidePageLoader();\n\t\t\t\tcleanFailedSubmit = $scope.$on('$sp.service_catalog.form_submit_failed', function() { $scope.submitting = false; });\n\t\t\t\tspUtil.scrollTo('#sc_cat_item', 300);\n\t\t\t});\n\t\t});\n\t}\n\tfunction updateCart() {\n\t\tpostCatalogFormRequest().then(function(response) {\n\t\t\tg_form.$private.userState.clearModifiedFields();\n\t\t\tc.status = i18n.getMessage(\"Updated Item to shopping cart.\");\n\t\t\tremoveCabrilloButtons();\n\t\t\t$location.search('id=sc_cart');\n\t\t})\n\t}\n\tfunction postCatalogFormRequest() {\n\t\t$scope.submitting = true;\n\t\tshowPageLoader();\n\t\tif ($scope.data.sc_cat_item.item_action !== \"add_to_cart\")\n\t\t\taddOrderButtons();\n\t\t\n\t\tif ($scope.data.is_wishlist_item) {\n\t\t\t$scope.is_update_wishlist = false;\n\t\t\t$scope.data.show_wishlist_msg = false;\n\t\t\tif ($scope.data.sc_cat_item.sys_class_name === \"sc_cat_item_producer\")\n\t\t\t\treturn spScUtil.submitWishlistedProducer($scope.data.sc_cat_item.sys_id, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, $scope.data.workspaceParams);\n\t\t\telse if ($scope.data.sc_cat_item.item_action === \"add_to_cart\")\n\t\t\t\treturn spScUtil.addWishlistedItemToCart($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID).then(null, function(response) {\n\t\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t\t$scope.submitting = false;\t\n\t\t\t\treturn $q.reject(response);\n\t\t\t});\n\t\t}\n\t\telse if ($scope.data.is_cart_item) {\n\t\t\treturn spScUtil.updateCart($scope.data._generatedItemGUID, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields));\n\t\t}\n\t\telse if ($scope.data.sc_cat_item.sys_class_name === \"sc_cat_item_producer\") {\n\t\t\treturn spScUtil.submitProducer($scope.data.sc_cat_item.sys_id, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID, $scope.data.workspaceParams).then(null, function(response) {\n\t\t\t\tif (response.data.result && response.data.result.errMsg) \n\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t\t$scope.submitting = false;\n\t\t\t\treturn $q.reject(response);\n\t\t\t});\n\t\t}\n\t\telse if ($scope.data.sc_cat_item.sys_class_name === \"std_change_record_producer\") {\n\t\t\t\treturn spScUtil.submitStdChgProducer($scope.data.sc_cat_item.sys_id, $scope.data.stdChg.twoStep, $scope.data.stdChg.currentVersion, $scope.data._generatedItemGUID, $scope.portal.url_suffix);\n\t\t}\n\t\telse if ($scope.data.sc_cat_item.item_action === \"add_to_cart\") {\n\t\t\treturn spScUtil.addToCart($scope.data.sc_cat_item.sys_id, $scope.data.sc_cat_item.quantity, getVarData($scope.data.sc_cat_item._fields), $scope.data._generatedItemGUID).then(null, function(response) {\n\t\t\t\tif (response.data.result && response.data.result.errMsg)\n\t\t\t\t\tspUtil.addErrorMessage(response.data.result.errMsg);\n\n\t\t\t\t$scope.submitting = false;\n\t\t\t\treturn $q.reject(response);\n\t\t\t});\n\t\t}\n\t}\n\t// spModel populates mandatory - hasMandatory is called by the submit button\n\t$scope.hasMandatory = function() {\n\t\treturn c.mandatory && c.mandatory.length > 0;\n\t};\n\t\n\t//\tListeners\n\tvar cleanFailedSubmit = $scope.$on('$sp.service_catalog.form_submit_failed', function() { $scope.submitting = false; });\n\tvar validationComplete = $rootScope.$on('$sp.service_catalog.form_validation_complete', function() { \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$scope.validating = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t$scope.$on(\"$sp.sc_cat_item.submitted\", function() {\n\t\tg_form.$private.userState.clearModifiedFields();\n\t});\n\t$scope.$on(\"$sp.service_catalog.wishlist.update\", function(evt, item) {\n\t\tif (item === $scope.data.sys_id)\n\t\t\t$scope.data.show_wishlist_msg = false;\n\t});\n\t// switch catalog items\n\tvar unregister = $scope.$on('$sp.list.click', onListClick);\n\t$scope.$on(\"$destroy\", function() {\n\t\t$rootScope.$broadcast(\"$sp.service_catalog.item.close\");\n\t\tunregister();\n\t\tmespClosePopupUnregister();\n\t\tmespOpenPopupUnregister();\n\t\tvalidationComplete();\n\t});\n\tfunction onListClick(evt, arg) {\n\t\t$scope.data.sys_id = arg.sys_id;\n\t\tspUtil.update($scope);\n\t}\n\t\n\tfunction formatRedirectUrl(page, table, sys_id) {\n\t\tvar url;\n\t\tvar paramObj = {page: page, table: table, sys_id: sys_id};\n\t\turl = spUtil.format(c.options.url, paramObj);\n\t\t\n\t\t//return url;\n\t\tif ($scope.portal.url_suffix.toString().toLowerCase() == 'pttep') {\n\t\t\t\n\t\t\tif (c.data.sc_cat_item.custom_url && c.data.sc_cat_item.custom_url != '') {\n\t\t\t\treturn c.data.sc_cat_item.custom_url.toString();\n\t\t\t} else {\n\t\t\treturn 'id=my_request';\n\t\t\t}\n\t\t\t//return 'id=sc_category&catalog_id=eb988957db10bb00ca57f0eb0c9619d4&sys_id=ece62ff29756f510c4ea79b71153aff1';\n\t\t\t//return 'id=mail_delivery_task';\n\t\t}\n\t\telse {\n\t\t\treturn 'id=my_request_external';\n\t\t}\n\t}\n\t\n\tfunction handleRedirect(n, table, sys_id, redirectTo, redirectUrl) {\n\n\t\tvar page = 'form';\n\t\tif (table == 'sc_request')\n\t\t\tpage = 'sc_request';\n\t\telse if (n)\n\t\t\tpage = 'ticket';\n\t\t\n\t\tif (redirectTo == 'catalog_home') \n\t\t\tpage = 'sc_home';\n\n\t\t//For Standard change, always direct to form if not in Workspace\n\t\tif ($scope.data.sc_cat_item.sys_class_name === \"std_change_record_producer\") {\n\t\t\tif ($scope.options.isServiceWorkspace == 'true') {\n\t\t\t\tvar params = {};\n\t\t\t\tparams.msg = 'TARGET_RECORD_SELECTED';\n\t\t\t\tparams.target_table = table;\n\t\t\t\tparams.target_sys_id = -1;\n\t\t\t\tif (sys_id)\n\t\t\t\t\tparams.target_sys_id = sys_id;\n\n\t\t\t\tif ($scope.data.stdChg.twoStep)\n\t\t\t\t\tparams.target_query = 'type=standard^std_change_producer_version=' + $scope.data.stdChg.currentVersion;\n\n\t\t\t\twindow.postMessage(params, location.origin);\n\t\t\t\treturn;\n\t\t\t} else\n\t\t\t\tpage = 'form';\n\t\t}\n\t\tremoveCabrilloButtons();\n\t\tif (c.options.page) {page = c.options.page;}\n\t\tif (c.options.table) {table = c.options.table;}\n\t\tvar url = formatRedirectUrl(page, table, sys_id);\n\t\tif ($scope.data.sc_cat_item.sys_class_name === \"sc_cat_item_producer\" || $scope.data.sc_cat_item.sys_class_name === \"std_change_record_producer\" || $scope.data.sc_cat_item.sys_class_name === \"sc_req_item\") {\n\t\t\tif (redirectUrl) {\n\t\t\t\t$window.location.href = redirectUrl;\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tvar newURL = $location.search(url);\n\t\t    spAriaFocusManager.navigateToLink(newURL.url());\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t$location.search(formatRedirectUrl('sc_request', 'sc_request', sys_id));\n\t\treturn;\n\t}\n    \n    $timeout(function() {\n        if ($document[0].getElementsByClassName('sc-sticky-item-header').length > 0) {\n            var titleHeight = $document[0].getElementsByClassName('sc-sticky-item-header')[0].clientHeight;\n            $scope.stickyHeaderTop = '-' + (titleHeight - 20 - $document[0].getElementsByClassName('sc-cat-item-short-description')[0].clientHeight) + 'px;';\n        }\n    });\n\t\t\n\tfunction addOrderButtons() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tshowCartButton();\n\t\tvar buttons = [];\n\t\tif ($scope.c.data.sys_properties.cartEnabled && $scope.c.showAddCartBtn()) {\n\t\t\tbuttons.push({\n\t\t\t\ttitle: $scope.m.addToCart,\n\t\t\t\tenabled: true,\n\t\t\t\tbackgroundColor: '#f7f7f7',\n\t\t\t\ttextColor: '#000000'\n\t\t\t});\n\t\t}\n\t\tbuttons.push({\n\t\t\ttitle: $scope.submitting? $scope.m.submittingMsg : $scope.submitButtonMsg,\n\t\t\tenabled: !$scope.submitting,\n\t\t\tbackgroundColor: $scope.data.sys_properties.mobileNativeColor,\n\t\t\ttextColor: '#FFFFFF'\n\t\t});\n\t\tcabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {\n\t\t\tif ($scope.c.data.sys_properties.cartEnabled && $scope.c.showAddCartBtn()) {\n\t\t\t\tif (buttonIndex == 0) {\n\t\t\t\t\t$timeout(function() {\t\n\t\t\t\t\t\t$scope.triggerAddToCart();\n\t\t\t\t\t},500);\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$timeout(function() {\t\n\t\t\t\t\t\t$scope.triggerOnSubmit();\n\t\t\t\t\t},500);\n\t\t\t\t}\t\t\t\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$timeout(function() {\t\n\t\t\t\t\t$scope.triggerOnSubmit();\n\t\t\t\t},500);\n\t\t\t}\n\t\t});\n\t}\n\t\n\tfunction addRPButton() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tvar buttons = [\n\t\t\t{\n\t\t\t\ttitle: $scope.submitButtonMsg,\n\t\t\t\tenabled: true,\n\t\t\t\tbackgroundColor: $scope.data.sys_properties.mobileNativeColor,\n\t\t\t\ttextColor: '#FFFFFF'\n\t\t\t}\n\t\t];\n\n\t\tcabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {\n\t\t\t$timeout(function() {\t\n\t\t\t\t$scope.triggerOnSubmit();\n\t\t\t},500);\n\t\t});\n\t}\n\t\n\tfunction showCartButton() {\n\t\tif (!cabrillo.isNative() || !$scope.showCabrilloCart) return;\n\n\t\tvar button = [{\n\t\t\t\timageName: 'cart',\n\t\t\t\tbadgeCount: $scope.cartItemCount,\n\t\t\t\tbackgroundColor: '#2ff5f9',\n\t\t\t\ttextColor: '#FFFFFF',\n\t\t\t\tenabled: true\n\t\t\t\t}];\n\n\t\tcabrillo.viewLayout.setNavigationBarButtons(button, function(index) {\n\t\t\t\t$location.search('id=sc_cart');\n\t\t\t});\n\n\t}\n\t\n\tfunction addUpdateButton() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tvar buttons = [\n\t\t\t{\n\t\t\t\ttitle: $scope.m.updateCart,\n\t\t\t\tenabled: true,\n\t\t\t\tbackgroundColor: $scope.data.sys_properties.mobileNativeColor,\n\t\t\t\ttextColor: '#FFFFFF'\n\t\t\t}\n\t\t];\n\n\t\tcabrillo.viewLayout.setBottomButtons(buttons, function(buttonIndex) {\n\t\t\t$timeout(function() {\t\n\t\t\t\t$scope.triggerUpdateCart();\n\t\t\t},500);\n\t\t});\n\t\tnativeGoBackToCart();\n\t}\n\t\n\tfunction removeCabrilloButtons() {\n\t\t\tif (!cabrillo.isNative()) return;\n\t\t\tcabrillo.viewLayout.setBottomButtons();\n\t}\n\t\n\tfunction showPageLoader() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tcabrillo.viewLayout.showSpinner();\n\t}\n\t\n\tfunction hidePageLoader() {\n\t\tif (!cabrillo.isNative()) return;\n\t\tcabrillo.viewLayout.hideSpinner();\n\t}\n}",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "PTTEP SC Catalog Item v4",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "PTTEP SC Catalog Item v4",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_scope",
            "reference_type": "table",
            "displayValue": "Global",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "global",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "widget-sc-cat-item-v4",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "widget-sc-cat-item-v4",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": 12,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "color",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "color",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}