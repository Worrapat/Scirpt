{
    "instance": {
        "name": "pttepdev",
        "url": "https://pttepdev.service-now.com",
        "g_ck": "92294b7e9781361002d4b3f71153af2909a9fa24cc4dd69d5bcf519de31b0a252b7eed2e"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "IStationery Stock-In PO Order NOW",
    "sys_id": "64b171b0dbaa7150d63d06a5f3961948",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<!DOCTYPE html>\n<html>\n<head>\n    \n</head>\n<body>\n  \n   \t<div class=\"row\">\n        <div class=\"column\" style=\"float: left; padding-left: 15px; padding-right: 20px; padding-bottom: 20px; margin-top: -10px;\" dir=\"ltr\">\n            <button type=\"button\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPoModal\" ng-click=\"c.copyArray()\">Order Now</button>\n        </div>\n      \t<div class=\"column\" style=\"float: right; padding-right: 15px; padding-bottom: 20px; margin-top: -10px;\" dir=\"rtl\" >\n            <button type=\"button\" id=\"istationary_stock_in_item_list_cart\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPreviewPoModal\" ng-click=\"c.fetchObjectValue()\">Preview Order</button>\n        </div>\n    </div>\n    \n    <div id=\"myPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          <!---<tr dir-paginate=\"item in filteredItems = c.copyArr | itemsPerPage:15\" current-page=\"c.currentPage\" pagination-id=\"active\">--->\n                            <tr ng-repeat=\"item in c.copyArr\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td>{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n\t\t\t\t</div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary\" ng-click=\"c.generateArray()\">${Add}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n\n    <div id=\"myPreviewPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In (Order Summary)</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          \t<tr ng-if=\"c.previewOBJ.length <= 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n                              <td colspan=\"6\" style=\"text-align:center;\">Empty Item</td>\n                          \t</tr>\n                            <tr ng-repeat=\"item in c.previewOBJ\" *ngIf=\"c.previewOBJ.length > 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td style=\"text-align:left;\">{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n                    <p style = \"text-align: right; padding-right: 18px;\">Grand Price: ฿{{c.total_display}}</p>\n                </div>\n                <div class=\"modal-footer\">\n                  \t<button class=\"btn btn-primary\" ng-click=\"c.updateCart()\">${Update}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</html>",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<!DOCTYPE html>\n<html>\n<head>\n    \n</head>\n<body>\n  \n   \t<div class=\"row\">\n        <div class=\"column\" style=\"float: left; padding-left: 15px; padding-right: 20px; padding-bottom: 20px; margin-top: -10px;\" dir=\"ltr\">\n            <button type=\"button\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPoModal\" ng-click=\"c.copyArray()\">Order Now</button>\n        </div>\n      \t<div class=\"column\" style=\"float: right; padding-right: 15px; padding-bottom: 20px; margin-top: -10px;\" dir=\"rtl\" >\n            <button type=\"button\" id=\"istationary_stock_in_item_list_cart\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#myPreviewPoModal\" ng-click=\"c.fetchObjectValue()\">Preview Order</button>\n        </div>\n    </div>\n    \n    <div id=\"myPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          <!---<tr dir-paginate=\"item in filteredItems = c.copyArr | itemsPerPage:15\" current-page=\"c.currentPage\" pagination-id=\"active\">--->\n                            <tr ng-repeat=\"item in c.copyArr\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td>{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n\t\t\t\t</div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary\" ng-click=\"c.generateArray()\">${Add}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</body>\n\n    <div id=\"myPreviewPoModal\" class=\"modal fade\" data-backdrop=\"static\" data-keyboard=\"false\" role=\"dialog\">\n        <div class=\"modal-dialog\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n                    <h3 class=\"modal-title\">iStationary Stock-In (Order Summary)</h3>\n                </div>\n                <div class=\"modal-body\">\n                    <table class=\"table table-hover table-striped table-responsive table-bordered table-wrapper-scroll-y my-custom-scrollbar\">\n                        <thead>\n                            <tr>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Item</th>\n                                <th style=\"width:30%;text-align:center;\" class=\"tablecolumn\">Description</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Type</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Unit Price</th>\n                              \t<th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Remaining Qty</th>\n                                <th style=\"width:10%;text-align:center;\" class=\"tablecolumn\">Quantity</th>\n                                <th style=\"width:15%;text-align:center;\" class=\"tablecolumn\">Total Price</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                          \t<tr ng-if=\"c.previewOBJ.length <= 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n                              <td colspan=\"6\" style=\"text-align:center;\">Empty Item</td>\n                          \t</tr>\n                            <tr ng-repeat=\"item in c.previewOBJ\" *ngIf=\"c.previewOBJ.length > 0\" current-page=\"c.currentPage\" pagination-id=\"active\">\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">\n\t\t\t\t\t\t\t\t\t<a href=\"{{::item.photo1}}\" target=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t<img ng-src=\"{{::item.photo1}}?t=large\" ng-if=\"item.photo1\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n   \t\t\t\t\t\t\t\t\t</a>\n                                  \t<a>\n                                        <img ng-src=\"No%20Image.png?t=large\" ng-if=\"item.photo1 === 'null.iix'\" alt=\"{{::item.name}}\" class=\"m-r-sm m-b-sm item-image pull-center\"  ng-click=\"showLargeImage(item.photo1x)\"/>\n                                    </a>\n\t\t\t\t\t\t\t\t</td>  \n\t\t\t\t\t\t\t\t<td style=\"text-align:left;\">{{item.description}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_type}}</td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">{{item.unit_price}}</td>\n                              \t<td style=\"text-align:center;\"><label ng-bind=item.remaining_qty></label></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"><input style=\"text-align:center;\" class=\"rounded-corner-input example1 column1\" ng-model=item.qty type=\"number\" ng-change=\"updatePrice(item)\" min=\"0\" max=\"{{item.po_remaining_qty}}\"></td>\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\">฿<label ng-bind=item.totalPrice></label></td>\n\t\t\t\t\t\t\t</tr>\n                        </tbody>\n                    </table>\n                    <p style = \"text-align: right; padding-right: 18px;\">Grand Price: ฿{{c.total_display}}</p>\n                </div>\n                <div class=\"modal-footer\">\n                  \t<button class=\"btn btn-primary\" ng-click=\"c.updateCart()\">${Update}</button>\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</html>",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "internal": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Internal",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "",
            "name": "internal",
            "attributes": {},
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "internal"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".modal-dialog {\n    width: 70%;\n    margin: auto auto;\n} \n.my-custom-scrollbar {\n  position: relative;\n  overflow-x: scroll;\n  overflow-y: hidden;\n\n}\n.table-wrapper-scroll-y {\ndisplay: block;\n}\n.table-paginator{\n    position: relative;\n    height: 75px;\n     //float: right;\n    color: #646262;\n}\n.align-right{\n    position: absolute;\n    top:0;\n    right:2rem;\n}\n.rpp{\n    display: inline-block;\n    margin-right: 4rem;\n}\n.rpp h4{\n    font-size: 14px;\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-control{\n    display: inline-block;\n}\n.page-control .current-page{\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-prev{\n    margin-right: 2rem;\n}\n.page-next{\n    margin-left: 2rem;\n}\nth{\nbackground-color: #F5F5F5;\n}\n.form-input-control {\n  height:35px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-fixed-control{\n  height:35px;\n  width:60px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-photo-control{\n  height:35px;\n  width:80px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.form-extra-control{\n  height:35px;\n  width:90px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.po {\n  width: 20px;\n  height: 20px;\n  background-color:#B2F5EE;\n}\n\n.pr{\n  width: 20px;\n  height: 20px;\n  background-color:#DAF7A6;\n}\n\n.column{\n  width: 40%;\n}\n\n.column1{\n\twidth: 75%;\n}\n\n.column2{\n  margin-left: auto;\n}\n\n.row {\n  margin-bottom: 20px;\n  display: flex;\n}\n\n.row .row {\n  margin: 0;\n}\n\n.row > * {\n  padding: 15px;\n  flex: 1;\n}\n\n.example1 {\n  border: 2px solid #66CC99;\n  padding: 5px;\n  border-radius: 20px;\n}\n\n.tablecolumn {\n\tbackground-color: #cce6ff;\n}\n",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".modal-dialog {\n    width: 70%;\n    margin: auto auto;\n} \n.my-custom-scrollbar {\n  position: relative;\n  overflow-x: scroll;\n  overflow-y: hidden;\n\n}\n.table-wrapper-scroll-y {\ndisplay: block;\n}\n.table-paginator{\n    position: relative;\n    height: 75px;\n     //float: right;\n    color: #646262;\n}\n.align-right{\n    position: absolute;\n    top:0;\n    right:2rem;\n}\n.rpp{\n    display: inline-block;\n    margin-right: 4rem;\n}\n.rpp h4{\n    font-size: 14px;\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-control{\n    display: inline-block;\n}\n.page-control .current-page{\n    display: inline-block;\n    margin-right: 2rem;\n}\n.page-prev{\n    margin-right: 2rem;\n}\n.page-next{\n    margin-left: 2rem;\n}\nth{\nbackground-color: #F5F5F5;\n}\n.form-input-control {\n  height:35px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-fixed-control{\n  height:35px;\n  width:60px;\n  border-radius: 5px;\n  border:1px solid;\n}\n.form-photo-control{\n  height:35px;\n  width:80px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.form-extra-control{\n  height:35px;\n  width:90px;\n  border-radius: 5px;\n  border:1px solid;\n}\n\n.po {\n  width: 20px;\n  height: 20px;\n  background-color:#B2F5EE;\n}\n\n.pr{\n  width: 20px;\n  height: 20px;\n  background-color:#DAF7A6;\n}\n\n.column{\n  width: 40%;\n}\n\n.column1{\n\twidth: 75%;\n}\n\n.column2{\n  margin-left: auto;\n}\n\n.row {\n  margin-bottom: 20px;\n  display: flex;\n}\n\n.row .row {\n  margin: 0;\n}\n\n.row > * {\n  padding: 15px;\n  flex: 1;\n}\n\n.example1 {\n  border: 2px solid #66CC99;\n  padding: 5px;\n  border-radius: 20px;\n}\n\n.tablecolumn {\n\tbackground-color: #cce6ff;\n}\n",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function link(scope, element, attrs, controller) { \n\n }",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function link(scope, element, attrs, controller) { \n\n }",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "(function () {\n\tvar arr = [];\n\t//gs.log('Test\t\t\tww');\n\tif (input.action == 'referencevalue' && input.filterData != '') {\n\t\t//\tgs.log('cat : '+input.filterData.category);\n\t\t//gs.log('SIT Case : A');\n\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\tpo_item.addEncodedQuery(\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\n\t\t);\n\t\tpo_item.query();\n\t\twhile (po_item.next()) {\n\t\t\t// get MRV request QTY\n\t\t\tvar master_item = po_item.u_master_item.getRefRecord();\n\t\t\tvar img = ' ';\n\t\t\tif (\n\t\t\t\tmaster_item.getValue('picture') != '' ||\n\t\t\t\tmaster_item.getValue('picture') != ' ' ||\n\t\t\t\tmaster_item.getValue('picture') != null\n\t\t\t) {\n\t\t\t\timg = master_item.getValue('picture') + '.iix';\n\t\t\t}\n\t\t\tvar request_qty = 0;\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\tline_item.addEncodedQuery(\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\n\t\t\t);\n\t\t\tline_item.query();\n\t\t\tif (line_item.next()) {\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t}\n\n\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\n\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\n\t\t\t}\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\n\t\t\t\tvar obj = {\n\t\t\t\t\tphoto1: img,\n\t\t\t\t\tdescription: master_item.getValue('name'),\n\t\t\t\t\tunit_type: master_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(master_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\n\t\t\t\t\tqty: 0,\n\t\t\t\t\ttotalPrice: 0.0,\n\t\t\t\t\titem_id: master_item.getUniqueValue(),\n\t\t\t\t};\n\t\t\t\tarr.push(obj);\n\t\t\t}\n\t\t}\n\t\t//gs.log(JSON.stringify(arr));\n\t\tdata.finalObject = arr;\n\t} else if (input.action == 'referencepreviewvalue') {\n\t\t//gs.log('SIT Case : B');\n\t\tarr = [];\n\t\tfor (var i = 0; i < input.mrv.length; i++) {\n\t\t\t//gs.log('Preview po old-pack : '+JSON.stringify(input.mrv));\n\n\t\t\tvar request_qty = 0;\n\t\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\t\tpo_item.addQuery('u_po=' + input.po + '^u_master_item=' + input.mrv[i].u_description_sin);\n\t\t\tpo_item.query();\n\t\t\tif (po_item.next()) {\n\t\t\t\t// get MRV request QTY\n\t\t\t\tvar mrv_item = po_item.u_master_item.getRefRecord();\n\t\t\t\tvar mrv_item_id = mrv_item.getUniqueValue();\n\t\t\t\tvar imgPreview = ' ';\n\t\t\t\tif (\n\t\t\t\t\tmrv_item.getValue('picture') != '' ||\n\t\t\t\t\tmrv_item.getValue('picture') != ' ' ||\n\t\t\t\t\tmrv_item.getValue('picture') != null\n\t\t\t\t) {\n\t\t\t\t\timgPreview = mrv_item.getValue('picture') + '.iix';\n\t\t\t\t}\n\n\t\t\t\t// get Submitted request QTY\n\t\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\t\tline_item.addEncodedQuery(\n\t\t\t\t\t'u_order=' + input.ref + '^u_item=' + mrv_item.sys_id + '^active=true',\n\t\t\t\t);\n\t\t\t\tline_item.query();\n\t\t\t\tif (line_item.next()) {\n\t\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t\t}\n\n\t\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\n\t\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\n\t\t\t\tif (request_qty != '0' || request_qty != 0) {\n\t\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\t\tpo_rem = parseInt(po_rem);\n\t\t\t\t}\n\n\t\t\t\tvar qty = input.mrv[i].u_qty.replace(/,/g, '');\n\n\t\t\t\tvar ref = input.ref != '';\n\t\t\t\tvar objPreview = {\n\t\t\t\t\tphoto1: imgPreview,\n\t\t\t\t\tdescription: mrv_item.name.getDisplayValue(),\n\t\t\t\t\tunit_type: mrv_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(mrv_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty: ref ? po_max_rem : parseInt(po_item.u_po_remaining),\n\t\t\t\t\tremaining_qty: ref\n\t\t\t\t\t\t? po_max_rem - parseInt(qty)\n\t\t\t\t\t\t: parseInt(po_item.u_po_remaining) - parseInt(qty),\n\t\t\t\t\tqty: parseInt(qty),\n\t\t\t\t\ttotalPrice: input.mrv[i].u_total_price,\n\t\t\t\t\titem_id: mrv_item_id,\n\t\t\t\t};\n\t\t\t\tarr.push(objPreview);\n\t\t\t\t//gs.log('Preview po re-pack : '+JSON.stringify(objPreview));\n\t\t\t}\n\t\t\tdata.finalPreviewObject = arr;\n\t\t\t//gs.log(JSON.stringify(data.finalPreviewObject));\n\t\t\tvar totalAmnt = 0;\n\t\t\tfor (var j = 0; j < data.finalPreviewObject.length; j++) {\n\t\t\t\t//gs.log(\"total_amount : \" + data.finalArray[i].total_amount.replace(/,/g, \"\"));\n\t\t\t\ttotalAmnt =\n\t\t\t\t\tparseFloat(totalAmnt) +\n\t\t\t\t\tparseFloat(data.finalPreviewObject[j].totalPrice.replace(/,/g, ''));\n\t\t\t}\n\t\t\tdata.grand_price = totalAmnt;\n\t\t}\n\t} else if (input.action == 'referenceoldvalue' && input.filterData != '') {\n\t\tarr = [];\n\t\tvar mrv_po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\tmrv_po_item.addEncodedQuery(\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\n\t\t);\n\t\tmrv_po_item.query();\n\t\twhile (mrv_po_item.next()) {\n\t\t\tvar mas_item = mrv_po_item.u_master_item.getRefRecord();\n\t\t\t// if (mrv_po_item.u_po_remaining != 0 || mrv_po_item.u_po_remaining != '0') {\n\t\t\tvar imgs = ' ';\n\t\t\t// gs.info(parse[i].u_description_sin)\n\t\t\tif (\n\t\t\t\tmas_item.getValue('picture') != '' ||\n\t\t\t\tmas_item.getValue('picture') != ' ' ||\n\t\t\t\tmas_item.getValue('picture') != null\n\t\t\t) {\n\t\t\t\timgs = mas_item.getValue('picture') + '.iix';\n\t\t\t}\n\t\t\tvar request_qty = 0;\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\tline_item.addEncodedQuery(\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\n\t\t\t);\n\t\t\tline_item.query();\n\t\t\tif (line_item.next()) {\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t}\n\t\t\tvar po_max_rem = mrv_po_item.u_po_remaining.getValue();\n\t\t\tvar po_rem = mrv_po_item.u_po_remaining.getValue();\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\n\t\t\t}\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\n\t\t\t\tvar objOld = {\n\t\t\t\t\tphoto1: imgs,\n\t\t\t\t\tdescription: mas_item.getValue('name'),\n\t\t\t\t\tunit_type: mas_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(mas_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty:\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\n\t\t\t\t\tremaining_qty:\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\n\t\t\t\t\tqty: 0,\n\t\t\t\t\ttotalPrice: 0.0,\n\t\t\t\t\titem_id: mas_item.getUniqueValue(),\n\t\t\t\t};\n\t\t\t\tfor (var s = 0; s < input.mrvsvalue.length; s++) {\n\t\t\t\t\tif (input.mrvsvalue[s].u_description_sin === objOld.item_id) {\n\t\t\t\t\t\tvar qty = input.mrvsvalue[s].u_qty.replace(/,/g, '');\n\t\t\t\t\t\tobjOld.qty = parseInt(qty);\n\t\t\t\t\t\tobjOld.totalPrice = input.mrvsvalue[s].u_total_price;\n\t\t\t\t\t\tobjOld.po_remaining_qty = parseInt(mrv_po_item.u_po_remaining);\n\t\t\t\t\t\tobjOld.remaining_qty = parseInt(mrv_po_item.u_po_remaining) - parseInt(qty);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tarr.push(objOld);\n\t\t\t}\n\t\t}\n\t\tdata.finalSubObject = arr;\n\t} else if (input.action == 'checkmultirow') {\n\t\tvar arrayUtil = new ArrayUtil();\n\t\tvar finalmvrs = [];\n\t\tvar oldArr = input.oldArr;\n\t\tvar newArr = input.newArr;\n\n\t\tfor (var v = 0; v < newArr.length; v++) {\n\t\t\t//check loop\n\t\t\tvar foundIndex = -1;\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\n\t\t\t\t\tfoundIndex = x;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (foundIndex != -1) {\n\t\t\t\t//gs.log('A');\n\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t//gs.log('A - A');\n\t\t\t\t\toldArr[foundIndex].u_qty = newArr[v].u_qty;\n\t\t\t\t\toldArr[foundIndex].u_total_price = newArr[v].u_total_price;\n\t\t\t\t} else {\n\t\t\t\t\t//gs.log('A - B');\n\t\t\t\t\toldArr.splice(foundIndex, 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//gs.log('B');\n\t\t\t\tif (foundIndex == -1) {\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t\t//gs.log('B - A');\n\t\t\t\t\t\toldArr.push(newArr[v]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//gs.log('B - B');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdata.oldArr = oldArr;\n\t} else if (input.action == 'previewUpdate') {\n\t\tvar oldArr = input.oldArr;\n\t\tvar newArr = input.newArr;\n\n\t\tfor (var v = 0; v < newArr.length; v++) {\n\t\t\t//check loop\n\t\t\tvar indexFound = -1;\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\n\t\t\t\t\tindexFound = x;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (indexFound != -1) {\n\t\t\t\t//gs.log('A');\n\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t//gs.log('A - A');\n\t\t\t\t\toldArr[indexFound].u_qty = newArr[v].u_qty;\n\t\t\t\t\toldArr[indexFound].u_total_price = newArr[v].u_total_price;\n\t\t\t\t} else {\n\t\t\t\t\t//gs.log('A - B');\n\t\t\t\t\toldArr.splice(indexFound, 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//gs.log('B');\n\t\t\t\tif (indexFound == -1) {\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t\t//gs.log('B - A');\n\t\t\t\t\t\toldArr.push(newArr[v]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//gs.log('B - B');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdata.oldArr = oldArr;\n\t} else if (input.action == 'checkreferencevalue') {\n\t\tarr = [];\n\t\tvar mrvs_po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\tmrvs_po_item.addEncodedQuery(\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\n\t\t);\n\t\tmrvs_po_item.query();\n\t\twhile (mrvs_po_item.next()) {\n\t\t\tvar mast_item = mrvs_po_item.u_master_item.getRefRecord();\n\t\t\tvar request_qty = 0;\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\tline_item.addEncodedQuery(\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + mast_item.sys_id + '^active=true',\n\t\t\t);\n\t\t\tline_item.query();\n\t\t\tif (line_item.next()) {\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t}\n\t\t\tvar imgg = ' ';\n\t\t\tif (\n\t\t\t\tmast_item.getValue('picture') != '' ||\n\t\t\t\tmast_item.getValue('picture') != ' ' ||\n\t\t\t\tmast_item.getValue('picture') != null\n\t\t\t) {\n\t\t\t\timgg = mast_item.getValue('picture') + '.iix';\n\t\t\t}\n\t\t\tvar po_max_rem = mrvs_po_item.u_po_remaining.getValue();\n\t\t\tvar po_rem = mrvs_po_item.u_po_remaining.getValue();\n\t\t\tif (request_qty != '0' || request_qty != 0) {\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\tpo_rem = parseInt(po_rem);\n\t\t\t}\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\n\t\t\t\tvar oldObj = {\n\t\t\t\t\tphoto1: imgg,\n\t\t\t\t\tdescription: mast_item.getValue('name'),\n\t\t\t\t\tunit_type: mast_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(mast_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\n\t\t\t\t\tqty: 0,\n\t\t\t\t\ttotalPrice: 0.0,\n\t\t\t\t\titem_id: mast_item.getUniqueValue(),\n\t\t\t\t};\n\t\t\t\tfor (var k = 0; k < input.mrvsvalue.length; k++) {\n\t\t\t\t\tif (input.mrvsvalue[k].u_description_sin === oldObj.item_id) {\n\t\t\t\t\t\tvar qty = input.mrvsvalue[k].u_qty.replace(/,/g, '');\n\t\t\t\t\t\toldObj.qty = parseInt(qty);\n\t\t\t\t\t\toldObj.totalPrice = input.mrvsvalue[k].u_total_price;\n\t\t\t\t\t\toldObj.po_remaining_qty = po_max_rem;\n\t\t\t\t\t\toldObj.remaining_qty = parseInt(po_max_rem) - parseInt(qty);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tarr.push(oldObj);\n\t\t\t}\n\t\t}\n\t\tdata.finalReSubObject = arr;\n\t}\n})();\n",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "(function () {\n\tvar arr = [];\n\t//gs.log('Test\t\t\tww');\n\tif (input.action == 'referencevalue' && input.filterData != '') {\n\t\t//\tgs.log('cat : '+input.filterData.category);\n\t\t//gs.log('SIT Case : A');\n\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\tpo_item.addEncodedQuery(\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\n\t\t);\n\t\tpo_item.query();\n\t\twhile (po_item.next()) {\n\t\t\t// get MRV request QTY\n\t\t\tvar master_item = po_item.u_master_item.getRefRecord();\n\t\t\tvar img = ' ';\n\t\t\tif (\n\t\t\t\tmaster_item.getValue('picture') != '' ||\n\t\t\t\tmaster_item.getValue('picture') != ' ' ||\n\t\t\t\tmaster_item.getValue('picture') != null\n\t\t\t) {\n\t\t\t\timg = master_item.getValue('picture') + '.iix';\n\t\t\t}\n\t\t\tvar request_qty = 0;\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\tline_item.addEncodedQuery(\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\n\t\t\t);\n\t\t\tline_item.query();\n\t\t\tif (line_item.next()) {\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t}\n\n\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\n\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\n\t\t\t}\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\n\t\t\t\tvar obj = {\n\t\t\t\t\tphoto1: img,\n\t\t\t\t\tdescription: master_item.getValue('name'),\n\t\t\t\t\tunit_type: master_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(master_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\n\t\t\t\t\tqty: 0,\n\t\t\t\t\ttotalPrice: 0.0,\n\t\t\t\t\titem_id: master_item.getUniqueValue(),\n\t\t\t\t};\n\t\t\t\tarr.push(obj);\n\t\t\t}\n\t\t}\n\t\t//gs.log(JSON.stringify(arr));\n\t\tdata.finalObject = arr;\n\t} else if (input.action == 'referencepreviewvalue') {\n\t\t//gs.log('SIT Case : B');\n\t\tarr = [];\n\t\tfor (var i = 0; i < input.mrv.length; i++) {\n\t\t\t//gs.log('Preview po old-pack : '+JSON.stringify(input.mrv));\n\n\t\t\tvar request_qty = 0;\n\t\t\tvar po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\t\tpo_item.addQuery('u_po=' + input.po + '^u_master_item=' + input.mrv[i].u_description_sin);\n\t\t\tpo_item.query();\n\t\t\tif (po_item.next()) {\n\t\t\t\t// get MRV request QTY\n\t\t\t\tvar mrv_item = po_item.u_master_item.getRefRecord();\n\t\t\t\tvar mrv_item_id = mrv_item.getUniqueValue();\n\t\t\t\tvar imgPreview = ' ';\n\t\t\t\tif (\n\t\t\t\t\tmrv_item.getValue('picture') != '' ||\n\t\t\t\t\tmrv_item.getValue('picture') != ' ' ||\n\t\t\t\t\tmrv_item.getValue('picture') != null\n\t\t\t\t) {\n\t\t\t\t\timgPreview = mrv_item.getValue('picture') + '.iix';\n\t\t\t\t}\n\n\t\t\t\t// get Submitted request QTY\n\t\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\t\tline_item.addEncodedQuery(\n\t\t\t\t\t'u_order=' + input.ref + '^u_item=' + mrv_item.sys_id + '^active=true',\n\t\t\t\t);\n\t\t\t\tline_item.query();\n\t\t\t\tif (line_item.next()) {\n\t\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t\t}\n\n\t\t\t\tvar po_max_rem = po_item.u_po_remaining.getValue();\n\t\t\t\tvar po_rem = po_item.u_po_remaining.getValue();\n\t\t\t\tif (request_qty != '0' || request_qty != 0) {\n\t\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\t\tpo_rem = parseInt(po_rem);\n\t\t\t\t}\n\n\t\t\t\tvar qty = input.mrv[i].u_qty.replace(/,/g, '');\n\n\t\t\t\tvar ref = input.ref != '';\n\t\t\t\tvar objPreview = {\n\t\t\t\t\tphoto1: imgPreview,\n\t\t\t\t\tdescription: mrv_item.name.getDisplayValue(),\n\t\t\t\t\tunit_type: mrv_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(mrv_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty: ref ? po_max_rem : parseInt(po_item.u_po_remaining),\n\t\t\t\t\tremaining_qty: ref\n\t\t\t\t\t\t? po_max_rem - parseInt(qty)\n\t\t\t\t\t\t: parseInt(po_item.u_po_remaining) - parseInt(qty),\n\t\t\t\t\tqty: parseInt(qty),\n\t\t\t\t\ttotalPrice: input.mrv[i].u_total_price,\n\t\t\t\t\titem_id: mrv_item_id,\n\t\t\t\t};\n\t\t\t\tarr.push(objPreview);\n\t\t\t\t//gs.log('Preview po re-pack : '+JSON.stringify(objPreview));\n\t\t\t}\n\t\t\tdata.finalPreviewObject = arr;\n\t\t\t//gs.log(JSON.stringify(data.finalPreviewObject));\n\t\t\tvar totalAmnt = 0;\n\t\t\tfor (var j = 0; j < data.finalPreviewObject.length; j++) {\n\t\t\t\t//gs.log(\"total_amount : \" + data.finalArray[i].total_amount.replace(/,/g, \"\"));\n\t\t\t\ttotalAmnt =\n\t\t\t\t\tparseFloat(totalAmnt) +\n\t\t\t\t\tparseFloat(data.finalPreviewObject[j].totalPrice.replace(/,/g, ''));\n\t\t\t}\n\t\t\tdata.grand_price = totalAmnt;\n\t\t}\n\t} else if (input.action == 'referenceoldvalue' && input.filterData != '') {\n\t\tarr = [];\n\t\tvar mrv_po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\tmrv_po_item.addEncodedQuery(\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\n\t\t);\n\t\tmrv_po_item.query();\n\t\twhile (mrv_po_item.next()) {\n\t\t\tvar mas_item = mrv_po_item.u_master_item.getRefRecord();\n\t\t\t// if (mrv_po_item.u_po_remaining != 0 || mrv_po_item.u_po_remaining != '0') {\n\t\t\tvar imgs = ' ';\n\t\t\t// gs.info(parse[i].u_description_sin)\n\t\t\tif (\n\t\t\t\tmas_item.getValue('picture') != '' ||\n\t\t\t\tmas_item.getValue('picture') != ' ' ||\n\t\t\t\tmas_item.getValue('picture') != null\n\t\t\t) {\n\t\t\t\timgs = mas_item.getValue('picture') + '.iix';\n\t\t\t}\n\t\t\tvar request_qty = 0;\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\tline_item.addEncodedQuery(\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + master_item.sys_id + '^active=true',\n\t\t\t);\n\t\t\tline_item.query();\n\t\t\tif (line_item.next()) {\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t}\n\t\t\tvar po_max_rem = mrv_po_item.u_po_remaining.getValue();\n\t\t\tvar po_rem = mrv_po_item.u_po_remaining.getValue();\n\t\t\tif ((request_qty != '0' && input.ref != '') || (request_qty != 0 && input.ref != '')) {\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\tpo_rem = parseInt(po_rem) + parseInt(request_qty);\n\t\t\t}\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\n\t\t\t\tvar objOld = {\n\t\t\t\t\tphoto1: imgs,\n\t\t\t\t\tdescription: mas_item.getValue('name'),\n\t\t\t\t\tunit_type: mas_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(mas_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty:\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\n\t\t\t\t\tremaining_qty:\n\t\t\t\t\t\tmrv_po_item.u_po_remaining.getValue() == null\n\t\t\t\t\t\t\t? 0\n\t\t\t\t\t\t\t: mrv_po_item.u_po_remaining.getValue(),\n\t\t\t\t\tqty: 0,\n\t\t\t\t\ttotalPrice: 0.0,\n\t\t\t\t\titem_id: mas_item.getUniqueValue(),\n\t\t\t\t};\n\t\t\t\tfor (var s = 0; s < input.mrvsvalue.length; s++) {\n\t\t\t\t\tif (input.mrvsvalue[s].u_description_sin === objOld.item_id) {\n\t\t\t\t\t\tvar qty = input.mrvsvalue[s].u_qty.replace(/,/g, '');\n\t\t\t\t\t\tobjOld.qty = parseInt(qty);\n\t\t\t\t\t\tobjOld.totalPrice = input.mrvsvalue[s].u_total_price;\n\t\t\t\t\t\tobjOld.po_remaining_qty = parseInt(mrv_po_item.u_po_remaining);\n\t\t\t\t\t\tobjOld.remaining_qty = parseInt(mrv_po_item.u_po_remaining) - parseInt(qty);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tarr.push(objOld);\n\t\t\t}\n\t\t}\n\t\tdata.finalSubObject = arr;\n\t} else if (input.action == 'checkmultirow') {\n\t\tvar arrayUtil = new ArrayUtil();\n\t\tvar finalmvrs = [];\n\t\tvar oldArr = input.oldArr;\n\t\tvar newArr = input.newArr;\n\n\t\tfor (var v = 0; v < newArr.length; v++) {\n\t\t\t//check loop\n\t\t\tvar foundIndex = -1;\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\n\t\t\t\t\tfoundIndex = x;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (foundIndex != -1) {\n\t\t\t\t//gs.log('A');\n\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t//gs.log('A - A');\n\t\t\t\t\toldArr[foundIndex].u_qty = newArr[v].u_qty;\n\t\t\t\t\toldArr[foundIndex].u_total_price = newArr[v].u_total_price;\n\t\t\t\t} else {\n\t\t\t\t\t//gs.log('A - B');\n\t\t\t\t\toldArr.splice(foundIndex, 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//gs.log('B');\n\t\t\t\tif (foundIndex == -1) {\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t\t//gs.log('B - A');\n\t\t\t\t\t\toldArr.push(newArr[v]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//gs.log('B - B');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdata.oldArr = oldArr;\n\t} else if (input.action == 'previewUpdate') {\n\t\tvar oldArr = input.oldArr;\n\t\tvar newArr = input.newArr;\n\n\t\tfor (var v = 0; v < newArr.length; v++) {\n\t\t\t//check loop\n\t\t\tvar indexFound = -1;\n\t\t\tfor (var x = 0; x < oldArr.length; x++) {\n\t\t\t\tif (oldArr[x].u_description_sin === newArr[v].u_description_sin) {\n\t\t\t\t\tindexFound = x;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (indexFound != -1) {\n\t\t\t\t//gs.log('A');\n\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t//gs.log('A - A');\n\t\t\t\t\toldArr[indexFound].u_qty = newArr[v].u_qty;\n\t\t\t\t\toldArr[indexFound].u_total_price = newArr[v].u_total_price;\n\t\t\t\t} else {\n\t\t\t\t\t//gs.log('A - B');\n\t\t\t\t\toldArr.splice(indexFound, 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//gs.log('B');\n\t\t\t\tif (indexFound == -1) {\n\t\t\t\t\tif (newArr[v].u_qty != 0) {\n\t\t\t\t\t\t//gs.log('B - A');\n\t\t\t\t\t\toldArr.push(newArr[v]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//gs.log('B - B');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tdata.oldArr = oldArr;\n\t} else if (input.action == 'checkreferencevalue') {\n\t\tarr = [];\n\t\tvar mrvs_po_item = new GlideRecord('u_ist_look_up_po_item');\n\t\tmrvs_po_item.addEncodedQuery(\n\t\t\t'u_po=' + input.filterData + '^u_po.u_active=true^ORDERBYu_master_item',\n\t\t);\n\t\tmrvs_po_item.query();\n\t\twhile (mrvs_po_item.next()) {\n\t\t\tvar mast_item = mrvs_po_item.u_master_item.getRefRecord();\n\t\t\tvar request_qty = 0;\n\t\t\tvar line_item = new GlideRecord('u_ist_stock_in_line_item');\n\t\t\tline_item.addEncodedQuery(\n\t\t\t\t'u_order=' + input.ref + '^u_item=' + mast_item.sys_id + '^active=true',\n\t\t\t);\n\t\t\tline_item.query();\n\t\t\tif (line_item.next()) {\n\t\t\t\trequest_qty = line_item.u_quantity.getDisplayValue();\n\t\t\t}\n\t\t\tvar imgg = ' ';\n\t\t\tif (\n\t\t\t\tmast_item.getValue('picture') != '' ||\n\t\t\t\tmast_item.getValue('picture') != ' ' ||\n\t\t\t\tmast_item.getValue('picture') != null\n\t\t\t) {\n\t\t\t\timgg = mast_item.getValue('picture') + '.iix';\n\t\t\t}\n\t\t\tvar po_max_rem = mrvs_po_item.u_po_remaining.getValue();\n\t\t\tvar po_rem = mrvs_po_item.u_po_remaining.getValue();\n\t\t\tif (request_qty != '0' || request_qty != 0) {\n\t\t\t\tpo_max_rem = parseInt(po_max_rem) + parseInt(request_qty);\n\t\t\t\tpo_rem = parseInt(po_rem);\n\t\t\t}\n\t\t\tif (po_max_rem != 0 && po_item.u_po_remaining != 0 && po_item.u_po_remaining != '') {\n\t\t\t\tvar oldObj = {\n\t\t\t\t\tphoto1: imgg,\n\t\t\t\t\tdescription: mast_item.getValue('name'),\n\t\t\t\t\tunit_type: mast_item.u_stock_in_unit.getDisplayValue(),\n\t\t\t\t\tunit_price: parseFloat(mast_item.getValue('u_stock_in_unit_cost'))\n\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ','),\n\t\t\t\t\tpo_remaining_qty: po_max_rem == null ? 0 : po_max_rem,\n\t\t\t\t\tremaining_qty: po_rem == null ? 0 : po_rem,\n\t\t\t\t\tqty: 0,\n\t\t\t\t\ttotalPrice: 0.0,\n\t\t\t\t\titem_id: mast_item.getUniqueValue(),\n\t\t\t\t};\n\t\t\t\tfor (var k = 0; k < input.mrvsvalue.length; k++) {\n\t\t\t\t\tif (input.mrvsvalue[k].u_description_sin === oldObj.item_id) {\n\t\t\t\t\t\tvar qty = input.mrvsvalue[k].u_qty.replace(/,/g, '');\n\t\t\t\t\t\toldObj.qty = parseInt(qty);\n\t\t\t\t\t\toldObj.totalPrice = input.mrvsvalue[k].u_total_price;\n\t\t\t\t\t\toldObj.po_remaining_qty = po_max_rem;\n\t\t\t\t\t\toldObj.remaining_qty = parseInt(po_max_rem) - parseInt(qty);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tarr.push(oldObj);\n\t\t\t}\n\t\t}\n\t\tdata.finalReSubObject = arr;\n\t}\n})();\n",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "true",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "api.controller = function ($scope, $rootScope) {\n\tvar c = this;\n\tc.searchText = '';\n\tc.currentPage = 1;\n\tc.copyArr = [];\n\tc.previewOBJ = [];\n\tc.orderedItems = [];\n\tc.copyObjectArr = [];\n\tc.oldData = [];\n\tc.checkObj = [];\n\tc.tempData = [];\n\tc.newArrData = [];\n\t$scope.status = $scope.data.status;\n\n\t// c.filterResult = {\n\t//     'category': '',\n\t//     'sub_category': ''\n\t// };\n\tc.filterResult = '';\n\tc.oldResult = null;\n\n\t// ===== Update UC Code Table =====\n\tc.updateUCCode = function (items) {\n\t\tconsole.log('items :', items);\n\n\t\t// --- 1. Validate input ---\n\t\tif (!Array.isArray(items) || items.length === 0) {\n\t\t\t// แสดงข้อความ default ถ้าไม่มีข้อมูลใน items\n\t\t\t$scope.page.g_form.setValue(\n\t\t\t\t'u_ticket_summary',\n\t\t\t\t'<div style=\"background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px 14px; font-family: Segoe UI, Arial, sans-serif; font-size: 14px; color: #374151; line-height: 1.5; box-shadow: 0 1px 4px rgba(0,0,0,0.05);\">This field is used to store the <strong style=\"color: #2563eb;\">UC Code</strong>, which indicates the system’s behavior under different conditions. Use the table below as a quick reference.</div>',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// --- 2. Initialize HTML structure ---\n\t\tlet tableHTML =\n\t\t\t'<table style=\"width:100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;\">' +\n\t\t\t'<thead>' +\n\t\t\t'<tr style=\"background-color: #297bd8; color:#ffffff;\">' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:35%;\">Description</th>' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">Use Case</th>' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">User Edit Price</th>' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">Stock-In Unit Cost (Excl. VAT)</th>' +\n\t\t\t'</tr>' +\n\t\t\t'</thead><tbody>';\n\n\t\t// --- 3. Loop through each item to build rows ---\n\t\titems.forEach((item) => {\n\t\t\tconst description = item.description;\n\t\t\tconst ucCode = item.uc_code;\n\t\t\tconst userEditPrice = item.u_unit_price;\n\t\t\tconst stockInUnitCost = item.oldPrice;\n\n\t\t\ttableHTML +=\n\t\t\t\t`<tr>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; width:35%;\">` +\n\t\t\t\tdescription +\n\t\t\t\t`</td>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">` +\n\t\t\t\tucCode +\n\t\t\t\t`</td>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\n\t\t\t\tuserEditPrice +\n\t\t\t\t`</td>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\n\t\t\t\tstockInUnitCost +\n\t\t\t\t`</td>` +\n\t\t\t\t`</tr>`;\n\t\t});\n\n\t\t// --- 4. Close table and set value back to form field ---\n\t\ttableHTML += '</tbody></table>';\n\n\t\t$scope.page.g_form.setValue('u_ticket_summary', tableHTML);\n\t};\n\n\t// Copy Array //\n\n\tc.copyArray = function () {\n\t\t// c.filterResult.category = $scope.page.g_form.getValue('u_category');\n\t\t// c.filterResult.sub_category = $scope.page.g_form.getValue('u_sub_category');\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\n\t\tc.filterResult = $scope.page.g_form.getValue('u_so_po_no_');\n\t\t//alert(c.filterResult.category);\n\t\t// if (c.oldResult == null) {\n\t\tc.oldResult = c.filterResult;\n\t\tc.fetchValue(ref);\n\t\t// } else {\n\t\t//     c.oldResult = c.filterResult;\n\t\t//     c.fetchValue();\n\t\t// }\n\t};\n\n\t// Fetch Value //\n\n\tc.fetchValue = function (ref) {\n\t\t//alert(c.filterResult.category);\n\t\tvar reference = '';\n\t\tvar checkmvrs = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\tif (checkmvrs != '' && ref == '') {\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\n\t\t\treference = 'referenceoldvalue';\n\t\t} else if (checkmvrs != '' && ref != '') {\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\n\t\t\treference = 'checkreferencevalue';\n\t\t} else {\n\t\t\treference = 'referencevalue';\n\t\t}\n\t\tc.server\n\t\t\t.get({\n\t\t\t\taction: reference,\n\t\t\t\tfilterData: c.filterResult,\n\t\t\t\tpreviewData: c.previewData,\n\t\t\t\tmrvsvalue: checkmvrs,\n\t\t\t\tref: ref,\n\t\t\t})\n\t\t\t.then(function (r) {\n\t\t\t\t//alert(JSON.stringify(r.data));\n\t\t\t\tif (r.data) {\n\t\t\t\t\tc.data.finalSubObject = r.data.finalSubObject;\n\t\t\t\t\tc.data.finalObject = r.data.finalObject;\n\t\t\t\t\tc.data.finalReSubObject = r.data.finalReSubObject;\n\t\t\t\t\t//c.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\n\t\t\t\t\tif (reference == 'referencevalue') {\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\n\t\t\t\t\t} else if (reference == 'checkreferencevalue') {\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalReSubObject));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalSubObject));\n\t\t\t\t\t}\n\t\t\t\t\t//console.log(JSON.stringify(c.copyArr));\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\t// Generate Array //\n\n\tc.generateArray = function () {\n\t\tc.finalData = [];\n\t\tc.previewData = [];\n\t\tc.newArr = [];\n\t\tc.olddataArr = [];\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\t// console.log('oldata : ' + oldDataStr + ' ; type : ' + typeof(oldDataStr));\n\t\tif (oldDataStr != '') {\n\t\t\tc.oldData = JSON.parse(oldDataStr);\n\t\t}\n\t\tfor (var y = 0; y < c.copyArr.length; y++) {\n\t\t\tif (oldDataStr == '') {\n\t\t\t\t// console.log('if = empty');\n\t\t\t\tif (c.copyArr[y].qty != 0) {\n\t\t\t\t\tvar newData = {\n\t\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\n\t\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\n\t\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\n\t\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\n\t\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\n\t\t\t\t\t};\n\t\t\t\t\tc.newArr.push(newData);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// console.log('else != empty');\n\t\t\t\tvar newData = {\n\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\n\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\n\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\n\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\n\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\n\t\t\t\t};\n\t\t\t\tc.newArr.push(newData);\n\t\t\t}\n\t\t}\n\t\tif (oldDataStr != '') {\n\t\t\t// console.log('if oldDataStr != empty')\n\t\t\tc.server\n\t\t\t\t.get({\n\t\t\t\t\taction: 'checkmultirow',\n\t\t\t\t\tnewArr: c.newArr,\n\t\t\t\t\toldArr: c.oldData,\n\t\t\t\t})\n\t\t\t\t.then(function (r) {\n\t\t\t\t\t// console.log(r.data.oldArr);\n\t\t\t\t\tc.olddataArr = r.data.oldArr;\n\t\t\t\t\tc.newDataArr = c.olddataArr;\n\n\t\t\t\t\t// Prepare items for UC code table\n\t\t\t\t\tconst itemsForUC = oldArr.map((item) => {\n\t\t\t\t\t\t// console.log('**** oldArr =>: ' + JSON.stringify(item) + '****');\n\t\t\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tu_description_sin: item.u_description_sin,\n\t\t\t\t\t\t\tdescription: copyItem\n\t\t\t\t\t\t\t\t? copyItem.description\n\t\t\t\t\t\t\t\t: item.description || item.u_description_sin,\n\t\t\t\t\t\t\tu_unit_price: item.u_unit_price,\n\t\t\t\t\t\t\toldPrice: '-',\n\t\t\t\t\t\t\tuc_code: '-',\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tc.updateUCCode(itemsForUC);\n\n\t\t\t\t\tc.updatMRV(c.newDataArr);\n\t\t\t\t\t//console.log(c.newDataArr);\n\t\t\t\t});\n\t\t} else {\n\t\t\t// console.log('else oldDataStr == empty')\n\t\t\tc.olddataArr = c.newArr;\n\t\t\tc.newDataArr = c.olddataArr;\n\t\t\tc.finalData = c.newDataArr;\n\n\t\t\tconst itemsForUC = c.newArr.map((item) => {\n\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\n\t\t\t\treturn {\n\t\t\t\t\tu_description_sin: item.u_description_sin,\n\t\t\t\t\tdescription: copyItem ? copyItem.description : item.description || item.u_description_sin,\n\t\t\t\t\tu_unit_price: item.u_unit_price,\n\t\t\t\t\toldPrice: '-',\n\t\t\t\t\tuc_code: '-',\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// console.log('✅ itemsForUC (from backend oldPrice):', JSON.stringify(itemsForUC, null, 2));\n\n\t\t\tc.updateUCCode(itemsForUC);\n\t\t\tc.updatMRV(c.newDataArr);\n\t\t}\n\t};\n\n\tc.updatMRV = function (finalData) {\n\t\t//console.log('updateMRV : ' + finalData);\n\t\tc.total = 0;\n\t\tfor (var v = 0; v < finalData.length; v++) {\n\t\t\tif (parseFloat(finalData[v].u_qty) > 0) {\n\t\t\t\tc.total = c.total + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\n\t\t\t\t$scope.data.sumPrice =\n\t\t\t\t\t$scope.data.sumPrice + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\n\t\t\t}\n\t\t\tc.total_display = c.total\n\t\t\t\t.toFixed(2)\n\t\t\t\t.toString()\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\n\t\t\t// console.log('updateMRV c.total_display : ' + c.total_display);\n\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total);\n\t\t\t// console.log('updateMRV c.total : ' + c.total);\n\t\t}\n\n\t\t$('#myPoModal').modal('hide');\n\t\t$('#myPreviewPoModal').modal('hide');\n\n\t\tif (finalData.length != 0) {\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', JSON.stringify(finalData));\n\t\t\tc.data.finalObject = c.copyArr;\n\t\t\t//alert('Preview Data : ' + JSON.stringify(c.previewData));\n\t\t\t//c.previewOBJ += JSON.parse(JSON.stringify(c.previewData));\n\t\t} else {\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', '');\n\t\t}\n\t};\n\n\tc.fetchObjectValue = function () {\n\t\tvar mrv = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\tvar po = $scope.page.g_form.getValue('u_so_po_no_');\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\n\t\tif (mrv != '') {\n\t\t\tmrv = JSON.parse(mrv);\n\t\t}\n\t\tc.server\n\t\t\t.get({\n\t\t\t\taction: 'referencepreviewvalue',\n\t\t\t\tmrv: mrv,\n\t\t\t\tpo: po,\n\t\t\t\tref: ref,\n\t\t\t})\n\t\t\t.then(function (item) {\n\t\t\t\tif (item.data) {\n\t\t\t\t\tc.data.finalPreviewObject = item.data.finalPreviewObject;\n\n\t\t\t\t\tif (c.copyObjectArr.length == 0) {\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\n\t\t\t\t\t\tc.total_display = item.data.grand_price\n\t\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\n\t\t\t\t\t\tc.total_display = item.data.grand_price\n\t\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\n\t\t\t\t\t}\n\t\t\t\t\tc.previewOBJ = c.copyObjectArr;\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\n\t\t\t\t}\n\t\t\t});\n\t};\n\t// ShowImage //\n\n\t$scope.showLargeImage = function (imgUrl) {\n\t\tvar html = '<div align=\"center\">';\n\t\tif (imgUrl == '') {\n\t\t\thtml += '<img ng-src=\"No%20Image.png\" height=\"500\" />';\n\t\t} else {\n\t\t\thtml +=\n\t\t\t\t'<img ng-src=\"' +\n\t\t\t\timgUrl +\n\t\t\t\t'\" height=\"500\" onclick=\"window.open(' +\n\t\t\t\timgUrl +\n\t\t\t\t', _blank);\"/>';\n\t\t}\n\t\thtml += '</div>';\n\t\tc.largeImage = $uibModal\n\t\t\t.open({\n\t\t\t\ttemplate: html,\n\t\t\t})\n\t\t\t.then(function () {});\n\t};\n\n\t// Update Price //\n\n\t$scope.updatePrice = function (item) {\n\t\t//--- Dynamic Po Rem ---//\n\t\tvar price = item.unit_price.toString();\n\t\tvar actualPrice = 0;\n\t\tc.total = 0;\n\t\t//--- cal change in preview ---\n\t\t// console.log(c.total_display + ' : ' + typeof(c.total_display));\n\t\tif (c.total_display == '0' || c.total_display == undefined) {\n\t\t\tc.total_display = 0;\n\t\t} else {\n\t\t\tif (item.totalPrice == '0' || item.totalPrice == undefined) {\n\t\t\t\t// console.log('if');\n\t\t\t\titem.totalPrice = 0;\n\t\t\t} else {\n\t\t\t\titem.totalPrice = item.totalPrice.replaceAll(',', '');\n\t\t\t\titem.totalPrice = parseFloat(item.totalPrice);\n\t\t\t}\n\t\t\tc.total_display = c.total_display.toString();\n\t\t\tc.total_display = c.total_display.replaceAll(',', '');\n\t\t\tc.total_display = parseFloat(c.total_display);\n\t\t\tc.total_display = c.total_display - item.totalPrice;\n\t\t\t// console.log('base : ' + c.total_display);\n\t\t}\n\t\tvar summary = '';\n\t\tvar orderSummary = '';\n\t\tif (parseFloat(item.qty) == 0 || parseFloat(item.qty) == '0' || item.qty == '') {\n\t\t\titem.totalPrice = 0.0;\n\t\t\t//--- Dynamic Po Rem ---//\n\t\t\titem.remaining_qty = item.po_remaining_qty;\n\t\t\t//console.log('if rem : ' + item.remaining_qty)\n\t\t} else {\n\t\t\t// console.log('else')\n\t\t\tactualPrice = price.replace(/[^0-9.-]+/g, '');\n\t\t\titem.totalPrice = parseFloat(item.qty) * parseFloat(actualPrice);\n\t\t\tvar item_total_price = item.totalPrice;\n\t\t\t// console.log('plus : ' + item_total_price);\n\t\t\titem.totalPrice = item.totalPrice\n\t\t\t\t.toFixed(2)\n\t\t\t\t.toString()\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\tvar new_total = c.total_display + parseFloat(item_total_price);\n\t\t\tc.total_display = new_total\n\t\t\t\t.toFixed(2)\n\t\t\t\t.toString()\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t// console.log('final : ' + c.total_display);\n\t\t\t//--- Dynamic Po Rem ---//\n\t\t\titem.remaining_qty = parseFloat(item.po_remaining_qty) - parseFloat(item.qty);\n\t\t\titem.remaining_qty = item.remaining_qty.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t//console.log('else rem : ' + item.remaining_qty)\n\t\t}\n\t};\n\n\tc.updateCart = function () {\n\t\tc.finalData = [];\n\t\tc.previewData = [];\n\t\tc.newArr = [];\n\t\tc.olddataArr = [];\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\tc.oldData = JSON.parse(oldDataStr);\n\t\tfor (var y = 0; y < c.previewOBJ.length; y++) {\n\t\t\t//console.log('Preview old-pack : '+JSON.stringify(c.previewOBJ[y]));\n\t\t\tvar newData = {\n\t\t\t\tu_description_sin: c.previewOBJ[y].item_id,\n\t\t\t\tu_unit_type: c.previewOBJ[y].unit_type,\n\t\t\t\tu_unit_price: c.previewOBJ[y].unit_price,\n\t\t\t\tu_qty: c.previewOBJ[y].qty.toString(),\n\t\t\t\tu_total_price: c.previewOBJ[y].totalPrice,\n\t\t\t};\n\t\t\t//console.log('Preview re-pack : '+JSON.stringify(newData));\n\t\t\tc.newArr.push(newData);\n\t\t}\n\n\t\tc.server\n\t\t\t.get({\n\t\t\t\taction: 'previewUpdate',\n\t\t\t\tnewArr: c.newArr,\n\t\t\t\toldArr: c.oldData,\n\t\t\t})\n\t\t\t.then(function (r) {\n\t\t\t\t// //console.log(r.data.oldArr);\n\t\t\t\t// c.olddataArr = r.data.oldArr;\n\t\t\t\t// c.newDataArr = c.olddataArr;\n\t\t\t\t// c.updatMRV(c.newDataArr);\n\t\t\t\t// //console.log(c.newDataArr);\n\t\t\t\tconst oldArr = (r.data.oldArr || []).map((oldItem) => {\n\t\t\t\t\tconst match = c.previewOBJ.find((p) => p.item_id === oldItem.u_description_sin);\n\n\t\t\t\t\t// Convert string to number before comparing\n\t\t\t\t\tconst oldPriceNum = parseNumber(oldItem.u_unit_price);\n\t\t\t\t\tconst newPriceNum = match ? parseNumber(match.unit_price) : oldPriceNum;\n\n\t\t\t\t\tif (oldPriceNum !== newPriceNum) {\n\t\t\t\t\t\treturn { ...oldItem, u_unit_price: formatCurrency(newPriceNum) };\n\t\t\t\t\t}\n\n\t\t\t\t\treturn { ...oldItem, u_unit_price: formatCurrency(oldItem.u_unit_price) };\n\t\t\t\t});\n\n\t\t\t\t// Save the processed array\n\t\t\t\tc.olddataArr = oldArr;\n\t\t\t\tc.newDataArr = c.olddataArr;\n\n\t\t\t\t// Call functions to update UC Code and MRV\n\t\t\t\tc.updateUCCode(c.newDataArr);\n\t\t\t\tc.updatMRV(c.newDataArr);\n\t\t\t});\n\t};\n};\n",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "api.controller = function ($scope, $rootScope) {\n\tvar c = this;\n\tc.searchText = '';\n\tc.currentPage = 1;\n\tc.copyArr = [];\n\tc.previewOBJ = [];\n\tc.orderedItems = [];\n\tc.copyObjectArr = [];\n\tc.oldData = [];\n\tc.checkObj = [];\n\tc.tempData = [];\n\tc.newArrData = [];\n\t$scope.status = $scope.data.status;\n\n\t// c.filterResult = {\n\t//     'category': '',\n\t//     'sub_category': ''\n\t// };\n\tc.filterResult = '';\n\tc.oldResult = null;\n\n\t// ===== Update UC Code Table =====\n\tc.updateUCCode = function (items) {\n\t\tconsole.log('items :', items);\n\n\t\t// --- 1. Validate input ---\n\t\tif (!Array.isArray(items) || items.length === 0) {\n\t\t\t// แสดงข้อความ default ถ้าไม่มีข้อมูลใน items\n\t\t\t$scope.page.g_form.setValue(\n\t\t\t\t'u_ticket_summary',\n\t\t\t\t'<div style=\"background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px 14px; font-family: Segoe UI, Arial, sans-serif; font-size: 14px; color: #374151; line-height: 1.5; box-shadow: 0 1px 4px rgba(0,0,0,0.05);\">This field is used to store the <strong style=\"color: #2563eb;\">UC Code</strong>, which indicates the system’s behavior under different conditions. Use the table below as a quick reference.</div>',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// --- 2. Initialize HTML structure ---\n\t\tlet tableHTML =\n\t\t\t'<table style=\"width:100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;\">' +\n\t\t\t'<thead>' +\n\t\t\t'<tr style=\"background-color: #297bd8; color:#ffffff;\">' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:35%;\">Description</th>' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">Use Case</th>' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">User Edit Price</th>' +\n\t\t\t'<th style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">Stock-In Unit Cost (Excl. VAT)</th>' +\n\t\t\t'</tr>' +\n\t\t\t'</thead><tbody>';\n\n\t\t// --- 3. Loop through each item to build rows ---\n\t\titems.forEach((item) => {\n\t\t\tconst description = item.description;\n\t\t\tconst ucCode = item.uc_code;\n\t\t\tconst userEditPrice = item.u_unit_price;\n\t\t\tconst stockInUnitCost = item.oldPrice;\n\n\t\t\ttableHTML +=\n\t\t\t\t`<tr>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; width:35%;\">` +\n\t\t\t\tdescription +\n\t\t\t\t`</td>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:15%;\">` +\n\t\t\t\tucCode +\n\t\t\t\t`</td>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\n\t\t\t\tuserEditPrice +\n\t\t\t\t`</td>` +\n\t\t\t\t`<td style=\"border: 1px solid #ddd; padding: 8px; text-align:center; width:25%;\">` +\n\t\t\t\tstockInUnitCost +\n\t\t\t\t`</td>` +\n\t\t\t\t`</tr>`;\n\t\t});\n\n\t\t// --- 4. Close table and set value back to form field ---\n\t\ttableHTML += '</tbody></table>';\n\n\t\t$scope.page.g_form.setValue('u_ticket_summary', tableHTML);\n\t};\n\n\t// Copy Array //\n\n\tc.copyArray = function () {\n\t\t// c.filterResult.category = $scope.page.g_form.getValue('u_category');\n\t\t// c.filterResult.sub_category = $scope.page.g_form.getValue('u_sub_category');\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\n\t\tc.filterResult = $scope.page.g_form.getValue('u_so_po_no_');\n\t\t//alert(c.filterResult.category);\n\t\t// if (c.oldResult == null) {\n\t\tc.oldResult = c.filterResult;\n\t\tc.fetchValue(ref);\n\t\t// } else {\n\t\t//     c.oldResult = c.filterResult;\n\t\t//     c.fetchValue();\n\t\t// }\n\t};\n\n\t// Fetch Value //\n\n\tc.fetchValue = function (ref) {\n\t\t//alert(c.filterResult.category);\n\t\tvar reference = '';\n\t\tvar checkmvrs = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\tif (checkmvrs != '' && ref == '') {\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\n\t\t\treference = 'referenceoldvalue';\n\t\t} else if (checkmvrs != '' && ref != '') {\n\t\t\tcheckmvrs = JSON.parse(checkmvrs);\n\t\t\treference = 'checkreferencevalue';\n\t\t} else {\n\t\t\treference = 'referencevalue';\n\t\t}\n\t\tc.server\n\t\t\t.get({\n\t\t\t\taction: reference,\n\t\t\t\tfilterData: c.filterResult,\n\t\t\t\tpreviewData: c.previewData,\n\t\t\t\tmrvsvalue: checkmvrs,\n\t\t\t\tref: ref,\n\t\t\t})\n\t\t\t.then(function (r) {\n\t\t\t\t//alert(JSON.stringify(r.data));\n\t\t\t\tif (r.data) {\n\t\t\t\t\tc.data.finalSubObject = r.data.finalSubObject;\n\t\t\t\t\tc.data.finalObject = r.data.finalObject;\n\t\t\t\t\tc.data.finalReSubObject = r.data.finalReSubObject;\n\t\t\t\t\t//c.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\n\t\t\t\t\tif (reference == 'referencevalue') {\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalObject));\n\t\t\t\t\t} else if (reference == 'checkreferencevalue') {\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalReSubObject));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.copyArr = JSON.parse(JSON.stringify(c.data.finalSubObject));\n\t\t\t\t\t}\n\t\t\t\t\t//console.log(JSON.stringify(c.copyArr));\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\n\t\t\t\t}\n\t\t\t});\n\t};\n\n\t// Generate Array //\n\n\tc.generateArray = function () {\n\t\tc.finalData = [];\n\t\tc.previewData = [];\n\t\tc.newArr = [];\n\t\tc.olddataArr = [];\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\t// console.log('oldata : ' + oldDataStr + ' ; type : ' + typeof(oldDataStr));\n\t\tif (oldDataStr != '') {\n\t\t\tc.oldData = JSON.parse(oldDataStr);\n\t\t}\n\t\tfor (var y = 0; y < c.copyArr.length; y++) {\n\t\t\tif (oldDataStr == '') {\n\t\t\t\t// console.log('if = empty');\n\t\t\t\tif (c.copyArr[y].qty != 0) {\n\t\t\t\t\tvar newData = {\n\t\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\n\t\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\n\t\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\n\t\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\n\t\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\n\t\t\t\t\t};\n\t\t\t\t\tc.newArr.push(newData);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// console.log('else != empty');\n\t\t\t\tvar newData = {\n\t\t\t\t\tu_description_sin: c.copyArr[y].item_id,\n\t\t\t\t\tu_unit_type: c.copyArr[y].unit_type,\n\t\t\t\t\tu_unit_price: c.copyArr[y].unit_price,\n\t\t\t\t\tu_qty: c.copyArr[y].qty.toString(),\n\t\t\t\t\tu_total_price: c.copyArr[y].totalPrice,\n\t\t\t\t};\n\t\t\t\tc.newArr.push(newData);\n\t\t\t}\n\t\t}\n\t\tif (oldDataStr != '') {\n\t\t\t// console.log('if oldDataStr != empty')\n\t\t\tc.server\n\t\t\t\t.get({\n\t\t\t\t\taction: 'checkmultirow',\n\t\t\t\t\tnewArr: c.newArr,\n\t\t\t\t\toldArr: c.oldData,\n\t\t\t\t})\n\t\t\t\t.then(function (r) {\n\t\t\t\t\t// console.log(r.data.oldArr);\n\t\t\t\t\tc.olddataArr = r.data.oldArr;\n\t\t\t\t\tc.newDataArr = c.olddataArr;\n\n\t\t\t\t\t// Prepare items for UC code table\n\t\t\t\t\tconst itemsForUC = oldArr.map((item) => {\n\t\t\t\t\t\t// console.log('**** oldArr =>: ' + JSON.stringify(item) + '****');\n\t\t\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tu_description_sin: item.u_description_sin,\n\t\t\t\t\t\t\tdescription: copyItem\n\t\t\t\t\t\t\t\t? copyItem.description\n\t\t\t\t\t\t\t\t: item.description || item.u_description_sin,\n\t\t\t\t\t\t\tu_unit_price: item.u_unit_price,\n\t\t\t\t\t\t\toldPrice: '-',\n\t\t\t\t\t\t\tuc_code: '-',\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tc.updateUCCode(itemsForUC);\n\n\t\t\t\t\tc.updatMRV(c.newDataArr);\n\t\t\t\t\t//console.log(c.newDataArr);\n\t\t\t\t});\n\t\t} else {\n\t\t\t// console.log('else oldDataStr == empty')\n\t\t\tc.olddataArr = c.newArr;\n\t\t\tc.newDataArr = c.olddataArr;\n\t\t\tc.finalData = c.newDataArr;\n\n\t\t\tconst itemsForUC = c.newArr.map((item) => {\n\t\t\t\tconst copyItem = c.copyArr.find((ci) => ci.item_id === item.u_description_sin);\n\t\t\t\treturn {\n\t\t\t\t\tu_description_sin: item.u_description_sin,\n\t\t\t\t\tdescription: copyItem ? copyItem.description : item.description || item.u_description_sin,\n\t\t\t\t\tu_unit_price: item.u_unit_price,\n\t\t\t\t\toldPrice: '-',\n\t\t\t\t\tuc_code: '-',\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// console.log('✅ itemsForUC (from backend oldPrice):', JSON.stringify(itemsForUC, null, 2));\n\n\t\t\tc.updateUCCode(itemsForUC);\n\t\t\tc.updatMRV(c.newDataArr);\n\t\t}\n\t};\n\n\tc.updatMRV = function (finalData) {\n\t\t//console.log('updateMRV : ' + finalData);\n\t\tc.total = 0;\n\t\tfor (var v = 0; v < finalData.length; v++) {\n\t\t\tif (parseFloat(finalData[v].u_qty) > 0) {\n\t\t\t\tc.total = c.total + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\n\t\t\t\t$scope.data.sumPrice =\n\t\t\t\t\t$scope.data.sumPrice + parseFloat(finalData[v].u_total_price.replace(/,/g, ''));\n\t\t\t}\n\t\t\tc.total_display = c.total\n\t\t\t\t.toFixed(2)\n\t\t\t\t.toString()\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\n\t\t\t// console.log('updateMRV c.total_display : ' + c.total_display);\n\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total);\n\t\t\t// console.log('updateMRV c.total : ' + c.total);\n\t\t}\n\n\t\t$('#myPoModal').modal('hide');\n\t\t$('#myPreviewPoModal').modal('hide');\n\n\t\tif (finalData.length != 0) {\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', JSON.stringify(finalData));\n\t\t\tc.data.finalObject = c.copyArr;\n\t\t\t//alert('Preview Data : ' + JSON.stringify(c.previewData));\n\t\t\t//c.previewOBJ += JSON.parse(JSON.stringify(c.previewData));\n\t\t} else {\n\t\t\t$scope.page.g_form.setValue('istationary_stock_in_item_list_cart', '');\n\t\t}\n\t};\n\n\tc.fetchObjectValue = function () {\n\t\tvar mrv = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\tvar po = $scope.page.g_form.getValue('u_so_po_no_');\n\t\tvar ref = $scope.page.g_form.getValue('reference_to_stock_in_request');\n\t\tif (mrv != '') {\n\t\t\tmrv = JSON.parse(mrv);\n\t\t}\n\t\tc.server\n\t\t\t.get({\n\t\t\t\taction: 'referencepreviewvalue',\n\t\t\t\tmrv: mrv,\n\t\t\t\tpo: po,\n\t\t\t\tref: ref,\n\t\t\t})\n\t\t\t.then(function (item) {\n\t\t\t\tif (item.data) {\n\t\t\t\t\tc.data.finalPreviewObject = item.data.finalPreviewObject;\n\n\t\t\t\t\tif (c.copyObjectArr.length == 0) {\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\n\t\t\t\t\t\tc.total_display = item.data.grand_price\n\t\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc.copyObjectArr = JSON.parse(JSON.stringify(c.data.finalPreviewObject));\n\t\t\t\t\t\t// c.updatMRV(c.data.finalPreviewObject);\n\t\t\t\t\t\tc.total_display = item.data.grand_price\n\t\t\t\t\t\t\t.toFixed(2)\n\t\t\t\t\t\t\t.toString()\n\t\t\t\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price', c.total_display);\n\t\t\t\t\t\t$scope.page.g_form.setValue('u_grand_price_display', '฿' + c.total_display);\n\t\t\t\t\t}\n\t\t\t\t\tc.previewOBJ = c.copyObjectArr;\n\t\t\t\t\t// alert(JSON.stringify(c.copyArr));\n\t\t\t\t}\n\t\t\t});\n\t};\n\t// ShowImage //\n\n\t$scope.showLargeImage = function (imgUrl) {\n\t\tvar html = '<div align=\"center\">';\n\t\tif (imgUrl == '') {\n\t\t\thtml += '<img ng-src=\"No%20Image.png\" height=\"500\" />';\n\t\t} else {\n\t\t\thtml +=\n\t\t\t\t'<img ng-src=\"' +\n\t\t\t\timgUrl +\n\t\t\t\t'\" height=\"500\" onclick=\"window.open(' +\n\t\t\t\timgUrl +\n\t\t\t\t', _blank);\"/>';\n\t\t}\n\t\thtml += '</div>';\n\t\tc.largeImage = $uibModal\n\t\t\t.open({\n\t\t\t\ttemplate: html,\n\t\t\t})\n\t\t\t.then(function () {});\n\t};\n\n\t// Update Price //\n\n\t$scope.updatePrice = function (item) {\n\t\t//--- Dynamic Po Rem ---//\n\t\tvar price = item.unit_price.toString();\n\t\tvar actualPrice = 0;\n\t\tc.total = 0;\n\t\t//--- cal change in preview ---\n\t\t// console.log(c.total_display + ' : ' + typeof(c.total_display));\n\t\tif (c.total_display == '0' || c.total_display == undefined) {\n\t\t\tc.total_display = 0;\n\t\t} else {\n\t\t\tif (item.totalPrice == '0' || item.totalPrice == undefined) {\n\t\t\t\t// console.log('if');\n\t\t\t\titem.totalPrice = 0;\n\t\t\t} else {\n\t\t\t\titem.totalPrice = item.totalPrice.replaceAll(',', '');\n\t\t\t\titem.totalPrice = parseFloat(item.totalPrice);\n\t\t\t}\n\t\t\tc.total_display = c.total_display.toString();\n\t\t\tc.total_display = c.total_display.replaceAll(',', '');\n\t\t\tc.total_display = parseFloat(c.total_display);\n\t\t\tc.total_display = c.total_display - item.totalPrice;\n\t\t\t// console.log('base : ' + c.total_display);\n\t\t}\n\t\tvar summary = '';\n\t\tvar orderSummary = '';\n\t\tif (parseFloat(item.qty) == 0 || parseFloat(item.qty) == '0' || item.qty == '') {\n\t\t\titem.totalPrice = 0.0;\n\t\t\t//--- Dynamic Po Rem ---//\n\t\t\titem.remaining_qty = item.po_remaining_qty;\n\t\t\t//console.log('if rem : ' + item.remaining_qty)\n\t\t} else {\n\t\t\t// console.log('else')\n\t\t\tactualPrice = price.replace(/[^0-9.-]+/g, '');\n\t\t\titem.totalPrice = parseFloat(item.qty) * parseFloat(actualPrice);\n\t\t\tvar item_total_price = item.totalPrice;\n\t\t\t// console.log('plus : ' + item_total_price);\n\t\t\titem.totalPrice = item.totalPrice\n\t\t\t\t.toFixed(2)\n\t\t\t\t.toString()\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\tvar new_total = c.total_display + parseFloat(item_total_price);\n\t\t\tc.total_display = new_total\n\t\t\t\t.toFixed(2)\n\t\t\t\t.toString()\n\t\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t// console.log('final : ' + c.total_display);\n\t\t\t//--- Dynamic Po Rem ---//\n\t\t\titem.remaining_qty = parseFloat(item.po_remaining_qty) - parseFloat(item.qty);\n\t\t\titem.remaining_qty = item.remaining_qty.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\t\t\t//console.log('else rem : ' + item.remaining_qty)\n\t\t}\n\t};\n\n\tc.updateCart = function () {\n\t\tc.finalData = [];\n\t\tc.previewData = [];\n\t\tc.newArr = [];\n\t\tc.olddataArr = [];\n\t\tvar oldDataStr = $scope.page.g_form.getValue('istationary_stock_in_item_list_cart');\n\t\tc.oldData = JSON.parse(oldDataStr);\n\t\tfor (var y = 0; y < c.previewOBJ.length; y++) {\n\t\t\t//console.log('Preview old-pack : '+JSON.stringify(c.previewOBJ[y]));\n\t\t\tvar newData = {\n\t\t\t\tu_description_sin: c.previewOBJ[y].item_id,\n\t\t\t\tu_unit_type: c.previewOBJ[y].unit_type,\n\t\t\t\tu_unit_price: c.previewOBJ[y].unit_price,\n\t\t\t\tu_qty: c.previewOBJ[y].qty.toString(),\n\t\t\t\tu_total_price: c.previewOBJ[y].totalPrice,\n\t\t\t};\n\t\t\t//console.log('Preview re-pack : '+JSON.stringify(newData));\n\t\t\tc.newArr.push(newData);\n\t\t}\n\n\t\tc.server\n\t\t\t.get({\n\t\t\t\taction: 'previewUpdate',\n\t\t\t\tnewArr: c.newArr,\n\t\t\t\toldArr: c.oldData,\n\t\t\t})\n\t\t\t.then(function (r) {\n\t\t\t\t// //console.log(r.data.oldArr);\n\t\t\t\t// c.olddataArr = r.data.oldArr;\n\t\t\t\t// c.newDataArr = c.olddataArr;\n\t\t\t\t// c.updatMRV(c.newDataArr);\n\t\t\t\t// //console.log(c.newDataArr);\n\t\t\t\tconst oldArr = (r.data.oldArr || []).map((oldItem) => {\n\t\t\t\t\tconst match = c.previewOBJ.find((p) => p.item_id === oldItem.u_description_sin);\n\n\t\t\t\t\t// Convert string to number before comparing\n\t\t\t\t\tconst oldPriceNum = parseNumber(oldItem.u_unit_price);\n\t\t\t\t\tconst newPriceNum = match ? parseNumber(match.unit_price) : oldPriceNum;\n\n\t\t\t\t\tif (oldPriceNum !== newPriceNum) {\n\t\t\t\t\t\treturn { ...oldItem, u_unit_price: formatCurrency(newPriceNum) };\n\t\t\t\t\t}\n\n\t\t\t\t\treturn { ...oldItem, u_unit_price: formatCurrency(oldItem.u_unit_price) };\n\t\t\t\t});\n\n\t\t\t\t// Save the processed array\n\t\t\t\tc.olddataArr = oldArr;\n\t\t\t\tc.newDataArr = c.olddataArr;\n\n\t\t\t\t// Call functions to update UC Code and MRV\n\t\t\t\tc.updateUCCode(c.newDataArr);\n\t\t\t\tc.updatMRV(c.newDataArr);\n\t\t\t});\n\t};\n};\n",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "IStationery Stock-In PO Order NOW",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "IStationery Stock-In PO Order NOW",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_scope",
            "reference_type": "table",
            "displayValue": "Global",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "global",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "istationery_stock_in_po_order_now",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "istationery_stock_in_po_order_now",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}